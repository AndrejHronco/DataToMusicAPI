(function(){function a(a,b,c){c=(c||0)-1;for(var d=a?a.length:0;++c<d;)if(a[c]===b)return c;return-1}function b(b,c){var d=typeof c;if(b=b.l,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:r+c;return b=(b=b[d])&&b[e],"object"==d?b&&-1<a(b,c)?0:-1:b?0:-1}function c(a){var b=this.l,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:r+a,b=b[c]||(b[c]={});"object"==c?(b[d]||(b[d]=[])).push(a):b[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){for(var c=a.m,d=b.m,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.n-b.n}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;for(e=i(),e["false"]=e["null"]=e["true"]=e.undefined=!1,f=i(),f.k=a,f.l=e,f.push=c;++b<d;)f.push(a[b]);return f}function g(a){return"\\"+U[a]}function h(){return o.pop()||[]}function i(){return p.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,o:null}}function j(a){a.length=0,o.length<t&&o.push(a)}function k(a){var b=a.l;b&&k(b),a.k=a.l=a.m=a.object=a.number=a.string=a.o=null,p.length<t&&p.push(a)}function l(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);var d=-1;c=c-b||0;for(var e=Array(0>c?0:c);++d<c;)e[d]=a[b+d];return e}function m(c){function o(a,b,c){if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(var d=-1,e=T[typeof a]&&Kc(a),f=e?e.length:0;++d<f&&(c=e[d],!1!==b(a[c],c,a)););return a}function p(a,b,c){var d;if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(d in a)if(!1===b(a[d],d,a))break;return a}function t(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if((e=g[h])&&T[typeof e])for(var j=-1,k=T[typeof e]&&Kc(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f}function U(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=bb(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if((e=g[h])&&T[typeof e])for(var k=-1,l=T[typeof e]&&Kc(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f}function W(a){var b,c=[];if(!a||!T[typeof a])return c;for(b in a)rc.call(a,b)&&c.push(b);return c}function X(a){return a&&"object"==typeof a&&!Jc(a)&&rc.call(a,"__wrapped__")?a:new Y(a)}function Y(a,b){this.__chain__=!!b,this.__wrapped__=a}function Z(a){function b(){if(d){var a=l(d);sc.apply(a,arguments)}if(this instanceof b){var f=ab(c.prototype),a=c.apply(f,a||arguments);return vb(a)?a:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Ic(b,a),b}function _(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}if(!vb(a))return a;var g=kc.call(a);if(!Q[g])return a;var i=Gc[g];switch(g){case J:case K:return new i(+a);case M:case P:return new i(a);case O:return f=i(a.source,z.exec(a)),f.lastIndex=a.lastIndex,f}if(g=Jc(a),b){var k=!d;d||(d=h()),e||(e=h());for(var m=d.length;m--;)if(d[m]==a)return e[m];f=g?i(a.length):{}}else f=g?l(a):U({},a);return g&&(rc.call(a,"index")&&(f.index=a.index),rc.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(g?Db:o)(a,function(a,g){f[g]=_(a,b,c,d,e)}),k&&(j(d),j(e)),f):f}function ab(a){return vb(a)?xc(a):{}}function bb(a,b,c){if("function"!=typeof a)return Ub;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Hc.funcNames&&(d=!a.name),d=d||!Hc.funcDecomp,!d)){var e=pc.call(a);Hc.funcNames||(d=!A.test(e)),d||(d=E.test(e),Ic(a,d))}if(!1===d||!0!==d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Sb(a,b)}function cb(a){function b(){var a=i?g:this;if(e){var o=l(e);sc.apply(o,arguments)}return(f||k)&&(o||(o=l(arguments)),f&&sc.apply(o,f),k&&o.length<h)?(d|=16,cb([c,m?d:-4&d,o,null,g,h])):(o||(o=arguments),j&&(c=a[n]),this instanceof b?(a=ab(c.prototype),o=c.apply(a,o),vb(o)?o:a):c.apply(a,o))}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,m=8&d,n=c;return Ic(b,a),b}function db(c,d){var e=-1,g=mb(),h=c?c.length:0,i=h>=s&&g===a,j=[];if(i){var l=f(d);l?(g=b,d=l):i=!1}for(;++e<h;)l=c[e],0>g(d,l)&&j.push(l);return i&&k(d),j}function eb(a,b,c,d){d=(d||0)-1;for(var e=a?a.length:0,f=[];++d<e;){var g=a[d];if(g&&"object"==typeof g&&"number"==typeof g.length&&(Jc(g)||qb(g))){b||(g=eb(g,b,c));var h=-1,i=g.length,j=f.length;for(f.length+=i;++h<i;)f[j++]=g[h]}else c||f.push(g)}return f}function fb(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;if(a===a&&!(a&&T[typeof a]||b&&T[typeof b]))return!1;if(null==a||null==b)return a===b;var i=kc.call(a),k=kc.call(b);if(i==H&&(i=N),k==H&&(k=N),i!=k)return!1;switch(i){case J:case K:return+a==+b;case M:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case O:case P:return a==fc(b)}if(k=i==I,!k){var l=rc.call(a,"__wrapped__"),m=rc.call(b,"__wrapped__");if(l||m)return fb(l?a.__wrapped__:a,m?b.__wrapped__:b,c,d,e,f);if(i!=N)return!1;if(i=a.constructor,l=b.constructor,i!=l&&!(ub(i)&&i instanceof i&&ub(l)&&l instanceof l)&&"constructor"in a&&"constructor"in b)return!1}for(i=!e,e||(e=h()),f||(f=h()),l=e.length;l--;)if(e[l]==a)return f[l]==b;var n=0,g=!0;if(e.push(a),f.push(b),k){if(l=a.length,n=b.length,(g=n==l)||d)for(;n--;)if(k=l,m=b[n],d)for(;k--&&!(g=fb(a[k],m,c,d,e,f)););else if(!(g=fb(a[n],m,c,d,e,f)))break}else p(b,function(b,h,i){return rc.call(i,h)?(n++,g=rc.call(a,h)&&fb(a[h],b,c,d,e,f)):void 0}),g&&!d&&p(a,function(a,b,c){return rc.call(c,b)?g=-1<--n:void 0});return e.pop(),f.pop(),i&&(j(e),j(f)),g}function gb(a,b,c,d,e){(Jc(b)?Db:o)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Jc(b))||Pc(b))){for(i=d.length;i--;)if(g=d[i]==b){j=e[i];break}if(!g){var k;c&&(i=c(j,b),k="undefined"!=typeof i)&&(j=i),k||(j=h?Jc(j)?j:[]:Pc(j)?j:{}),d.push(b),e.push(j),k||gb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function hb(a,b){return a+oc(Fc()*(b-a+1))}function ib(c,d,e){var g=-1,i=mb(),l=c?c.length:0,m=[],n=!d&&l>=s&&i===a,o=e||n?h():m;for(n&&(o=f(o),i=b);++g<l;){var p=c[g],q=e?e(p,g,c):p;(d?!g||o[o.length-1]!==q:0>i(o,q))&&((e||n)&&o.push(q),m.push(p))}return n?(j(o.k),k(o)):e&&j(o),m}function jb(a){return function(b,c,d){var e={};c=X.createCallback(c,d,3),d=-1;var f=b?b.length:0;if("number"==typeof f)for(;++d<f;){var g=b[d];a(e,g,c(g,d,b),b)}else o(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function kb(a,b,c,d,e,f){var g=1&b,h=4&b,i=16&b,j=32&b;if(!(2&b||ub(a)))throw new gc;i&&!c.length&&(b&=-17,i=c=!1),j&&!d.length&&(b&=-33,j=d=!1);var k=a&&a.__bindData__;return k&&!0!==k?(k=l(k),k[2]&&(k[2]=l(k[2])),k[3]&&(k[3]=l(k[3])),!g||1&k[1]||(k[4]=e),!g&&1&k[1]&&(b|=8),!h||4&k[1]||(k[5]=f),i&&sc.apply(k[2]||(k[2]=[]),c),j&&vc.apply(k[3]||(k[3]=[]),d),k[1]|=b,kb.apply(null,k)):(1==b||17===b?Z:cb)([a,b,c,d,e,f])}function lb(a){return Lc[a]}function mb(){var b=(b=X.indexOf)===Mb?a:b;return b}function nb(a){return"function"==typeof a&&lc.test(a)}function ob(a){var b,c;return a&&kc.call(a)==N&&(b=a.constructor,!ub(b)||b instanceof b)?(p(a,function(a,b){c=b}),"undefined"==typeof c||rc.call(a,c)):!1}function pb(a){return Mc[a]}function qb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==H||!1}function rb(a,b,c){var d=Kc(a),e=d.length;for(b=bb(b,c,3);e--&&(c=d[e],!1!==b(a[c],c,a)););return a}function sb(a){var b=[];return p(a,function(a,c){ub(a)&&b.push(c)}),b.sort()}function tb(a){for(var b=-1,c=Kc(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function ub(a){return"function"==typeof a}function vb(a){return!(!a||!T[typeof a])}function wb(a){return"number"==typeof a||a&&"object"==typeof a&&kc.call(a)==M||!1}function xb(a){return"string"==typeof a||a&&"object"==typeof a&&kc.call(a)==P||!1}function yb(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;)e[b]=a[c[b]];return e}function zb(a,b,c){var d=-1,e=mb(),f=a?a.length:0,g=!1;return c=(0>c?Cc(0,f+c):c)||0,Jc(a)?g=-1<e(a,b,c):"number"==typeof f?g=-1<(xb(a)?a.indexOf(b,c):e(a,b,c)):o(a,function(a){return++d<c?void 0:!(g=a===b)}),g}function Ab(a,b,c){var d=!0;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&(d=!!b(a[c],c,a)););else o(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Bb(a,b,c){var d=[];b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e;){var f=a[c];b(f,c,a)&&d.push(f)}else o(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Cb(a,b,c){b=X.createCallback(b,c,3),c=-1;var d=a?a.length:0;if("number"!=typeof d){var e;return o(a,function(a,c,d){return b(a,c,d)?(e=a,!1):void 0}),e}for(;++c<d;){var f=a[c];if(b(f,c,a))return f}}function Db(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof e)for(;++d<e&&!1!==b(a[d],d,a););else o(a,b);return a}function Eb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof d)for(;d--&&!1!==b(a[d],d,a););else{var e=Kc(a),d=e.length;o(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function Fb(a,b,c){var d=-1,e=a?a.length:0;if(b=X.createCallback(b,c,3),"number"==typeof e)for(var f=Zb(e);++d<e;)f[d]=b(a[d],d,a);else f=[],o(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Gb(a,b,c){var e=-1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];h>f&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),c>e&&(e=c,f=a)});return f}function Hb(a,b,c,d){if(!a)return c;var e=3>arguments.length;b=X.createCallback(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else o(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function Ib(a,b,c,d){var e=3>arguments.length;return b=X.createCallback(b,d,4),Eb(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function Jb(a){var b=-1,c=a?a.length:0,d=Zb("number"==typeof c?c:0);return Db(a,function(a){var c=hb(0,++b);d[b]=d[c],d[c]=a}),d}function Kb(a,b,c){var d;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&!(d=b(a[c],c,a)););else o(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function Lb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=X.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:n;return l(a,0,Dc(Cc(0,d),e))}function Mb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Cc(0,e+d):d||0}else if(d)return d=Ob(b,c),b[d]===c?d:-1;return a(b,c,d)}function Nb(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=X.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Cc(0,b);return l(a,d)}function Ob(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?X.createCallback(c,d,1):Ub,b=c(b);f>e;)d=e+f>>>1,c(a[d])<b?e=d+1:f=d;return e}function Pb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=X.createCallback(c,d,3)),ib(a,b,c)}function Qb(){for(var a=1<arguments.length?arguments:arguments[0],b=-1,c=a?Gb(Tc(a,"length")):0,d=Zb(0>c?0:c);++b<c;)d[b]=Tc(a,b);return d}function Rb(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Jc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Sb(a,b){return 2<arguments.length?kb(a,17,l(arguments,2),null,b):kb(a,1,null,null,b)}function Tb(a,b,c){function d(){k&&nc(k),g=k=l=n,(p||o!==b)&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null))}function e(){var c=b-(Uc()-i);c>0?k=tc(e,c):(g&&nc(g),c=l,g=k=l=n,c&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null)))}var f,g,h,i,j,k,l,m=0,o=!1,p=!0;if(!ub(a))throw new gc;if(b=Cc(0,b)||0,!0===c)var q=!0,p=!1;else vb(c)&&(q=c.leading,o="maxWait"in c&&(Cc(b,c.maxWait)||0),p="trailing"in c?c.trailing:p);return function(){if(f=arguments,i=Uc(),j=this,l=p&&(k||!q),!1===o)var c=q&&!k;else{g||q||(m=i);var n=o-(i-m),r=0>=n;r?(g&&(g=nc(g)),m=i,h=a.apply(j,f)):g||(g=tc(d,n))}return r&&k?k=nc(k):k||b===o||(k=tc(e,b)),c&&(r=!0,h=a.apply(j,f)),!r||k||g||(f=j=null),h}}function Ub(a){return a}function Vb(a,b,c){var d=!0,e=b&&sb(b);b&&(c||e.length)||(null==c&&(c=b),f=Y,b=a,a=X,e=sb(b)),!1===c?d=!1:vb(c)&&"chain"in c&&(d=c.chain);var f=a,g=ub(f);Db(e,function(c){var e=a[c]=b[c];g&&(f.prototype[c]=function(){var b=this.__chain__,c=this.__wrapped__,g=[c];if(sc.apply(g,arguments),g=e.apply(a,g),d||b){if(c===g&&vb(g))return this;g=new f(g),g.__chain__=b}return g})})}function Wb(){}function Xb(a){return function(b){return b[a]}}function Yb(){return this.__wrapped__}c=c?$.defaults(V.Object(),c,$.pick(V,G)):V;var Zb=c.Array,$b=c.Boolean,_b=c.Date,ac=c.Function,bc=c.Math,cc=c.Number,dc=c.Object,ec=c.RegExp,fc=c.String,gc=c.TypeError,hc=[],ic=dc.prototype,jc=c._,kc=ic.toString,lc=ec("^"+fc(kc).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),mc=bc.ceil,nc=c.clearTimeout,oc=bc.floor,pc=ac.prototype.toString,qc=nb(qc=dc.getPrototypeOf)&&qc,rc=ic.hasOwnProperty,sc=hc.push,tc=c.setTimeout,uc=hc.splice,vc=hc.unshift,wc=function(){try{var a={},b=nb(b=dc.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),xc=nb(xc=dc.create)&&xc,yc=nb(yc=Zb.isArray)&&yc,zc=c.isFinite,Ac=c.isNaN,Bc=nb(Bc=dc.keys)&&Bc,Cc=bc.max,Dc=bc.min,Ec=c.parseInt,Fc=bc.random,Gc={};Gc[I]=Zb,Gc[J]=$b,Gc[K]=_b,Gc[L]=ac,Gc[N]=dc,Gc[M]=cc,Gc[O]=ec,Gc[P]=fc,Y.prototype=X.prototype;var Hc=X.support={};Hc.funcDecomp=!nb(c.a)&&E.test(m),Hc.funcNames="string"==typeof ac.name,X.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:B,variable:"",imports:{_:X}},xc||(ab=function(){function a(){}return function(b){if(vb(b)){a.prototype=b;var d=new a;a.prototype=null}return d||c.Object()}}());var Ic=wc?function(a,b){S.value=b,wc(a,"__bindData__",S)}:Wb,Jc=yc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==I||!1},Kc=Bc?function(a){return vb(a)?Bc(a):[]}:W,Lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Mc=tb(Lc),Nc=ec("("+Kc(Mc).join("|")+")","g"),Oc=ec("["+Kc(Lc).join("")+"]","g"),Pc=qc?function(a){if(!a||kc.call(a)!=N)return!1;var b=a.valueOf,c=nb(b)&&(c=qc(b))&&qc(c);return c?a==c||qc(a)==c:ob(a)}:ob,Qc=jb(function(a,b,c){rc.call(a,c)?a[c]++:a[c]=1}),Rc=jb(function(a,b,c){(rc.call(a,c)?a[c]:a[c]=[]).push(b)}),Sc=jb(function(a,b,c){a[c]=b}),Tc=Fb,Uc=nb(Uc=_b.now)&&Uc||function(){return(new _b).getTime()},Vc=8==Ec(u+"08")?Ec:function(a,b){return Ec(xb(a)?a.replace(C,""):a,b||0)};return X.after=function(a,b){if(!ub(b))throw new gc;return function(){return 1>--a?b.apply(this,arguments):void 0}},X.assign=U,X.at=function(a){for(var b=arguments,c=-1,d=eb(b,!0,!1,1),b=b[2]&&b[2][b[1]]===a?1:d.length,e=Zb(b);++c<b;)e[c]=a[d[c]];return e},X.bind=Sb,X.bindAll=function(a){for(var b=1<arguments.length?eb(arguments,!0,!1,1):sb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=kb(a[e],1,null,null,a)}return a},X.bindKey=function(a,b){return 2<arguments.length?kb(b,19,l(arguments,2),null,a):kb(b,3,null,null,a)},X.chain=function(a){return a=new Y(a),a.__chain__=!0,a},X.compact=function(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d},X.compose=function(){for(var a=arguments,b=a.length;b--;)if(!ub(a[b]))throw new gc;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}},X.constant=function(a){return function(){return a}},X.countBy=Qc,X.create=function(a,b){var c=ab(a);return b?U(c,b):c},X.createCallback=function(a,b,c){var d=typeof a;if(null==a||"function"==d)return bb(a,b,c);if("object"!=d)return Xb(a);var e=Kc(a),f=e[0],g=a[f];return 1!=e.length||g!==g||vb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=fb(b[e[c]],a[e[c]],null,!0)););return d}:function(a){return a=a[f],g===a&&(0!==g||1/g==1/a)}},X.curry=function(a,b){return b="number"==typeof b?b:+b||a.length,kb(a,4,null,null,null,b)},X.debounce=Tb,X.defaults=t,X.defer=function(a){if(!ub(a))throw new gc;var b=l(arguments,1);return tc(function(){a.apply(n,b)},1)},X.delay=function(a,b){if(!ub(a))throw new gc;var c=l(arguments,2);return tc(function(){a.apply(n,c)},b)},X.difference=function(a){return db(a,eb(arguments,!0,!0,1))},X.filter=Bb,X.flatten=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=Fb(a,c,d)),eb(a,b)},X.forEach=Db,X.forEachRight=Eb,X.forIn=p,X.forInRight=function(a,b,c){var d=[];p(a,function(a,b){d.push(b,a)});var e=d.length;for(b=bb(b,c,3);e--&&!1!==b(d[e--],d[e],a););return a},X.forOwn=o,X.forOwnRight=rb,X.functions=sb,X.groupBy=Rc,X.indexBy=Sc,X.initial=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return l(a,0,Dc(Cc(0,e-d),e))},X.intersection=function(){for(var c=[],d=-1,e=arguments.length,g=h(),i=mb(),l=i===a,m=h();++d<e;){var n=arguments[d];(Jc(n)||qb(n))&&(c.push(n),g.push(l&&n.length>=s&&f(d?c[d]:m)))}var l=c[0],o=-1,p=l?l.length:0,q=[];a:for(;++o<p;){var r=g[0],n=l[o];if(0>(r?b(r,n):i(m,n))){for(d=e,(r||m).push(n);--d;)if(r=g[d],0>(r?b(r,n):i(c[d],n)))continue a;q.push(n)}}for(;e--;)(r=g[e])&&k(r);return j(g),j(m),q},X.invert=tb,X.invoke=function(a,b){var c=l(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Zb("number"==typeof f?f:0);return Db(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g},X.keys=Kc,X.map=Fb,X.mapValues=function(a,b,c){var d={};return b=X.createCallback(b,c,3),o(a,function(a,c,e){d[c]=b(a,c,e)}),d},X.max=Gb,X.memoize=function(a,b){function c(){var d=c.cache,e=b?b.apply(this,arguments):r+arguments[0];return rc.call(d,e)?d[e]:d[e]=a.apply(this,arguments)}if(!ub(a))throw new gc;return c.cache={},c},X.merge=function(a){var b=arguments,c=2;if(!vb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=bb(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var b=l(arguments,1,c),e=-1,f=h(),g=h();++e<c;)gb(a,b[e],d,f,g);return j(f),j(g),a},X.min=function(a,b,c){var e=1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];f>h&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),e>c&&(e=c,f=a)});return f},X.omit=function(a,b,c){var d={};if("function"!=typeof b){var e=[];p(a,function(a,b){e.push(b)});for(var e=db(e,eb(arguments,!0,!1,1)),f=-1,g=e.length;++f<g;){var h=e[f];d[h]=a[h]}}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)||(d[c]=a)});return d},X.once=function(a){var b,c;if(!ub(a))throw new gc;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},X.pairs=function(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e},X.partial=function(a){return kb(a,16,l(arguments,1))},X.partialRight=function(a){return kb(a,32,null,l(arguments,1))},X.pick=function(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=eb(arguments,!0,!1,1),g=vb(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d},X.pluck=Tc,X.property=Xb,X.pull=function(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(uc.call(a,f--,1),e--);return a},X.range=function(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);var d=-1;b=Cc(0,mc((b-a)/(c||1)));for(var e=Zb(b);++d<b;)e[d]=a,a+=c;return e},X.reject=function(a,b,c){return b=X.createCallback(b,c,3),Bb(a,function(a,c,d){return!b(a,c,d)})},X.remove=function(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=X.createCallback(b,c,3);++d<e;)c=a[d],b(c,d,a)&&(f.push(c),uc.call(a,d--,1),e--);return f},X.rest=Nb,X.shuffle=Jb,X.sortBy=function(a,b,c){var d=-1,f=Jc(b),g=a?a.length:0,l=Zb("number"==typeof g?g:0);for(f||(b=X.createCallback(b,c,3)),Db(a,function(a,c,e){var g=l[++d]=i();f?g.m=Fb(b,function(b){return a[b]}):(g.m=h())[0]=b(a,c,e),g.n=d,g.o=a}),g=l.length,l.sort(e);g--;)a=l[g],l[g]=a.o,f||j(a.m),k(a);return l},X.tap=function(a,b){return b(a),a},X.throttle=function(a,b,c){var d=!0,e=!0;if(!ub(a))throw new gc;return!1===c?d=!1:vb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),R.leading=d,R.maxWait=b,R.trailing=e,Tb(a,b,R)},X.times=function(a,b,c){a=-1<(a=+a)?a:0;var d=-1,e=Zb(a);for(b=bb(b,c,1);++d<a;)e[d]=b(d);return e},X.toArray=function(a){return a&&"number"==typeof a.length?l(a):yb(a)},X.transform=function(a,b,c,d){var e=Jc(a);if(null==c)if(e)c=[];else{var f=a&&a.constructor;c=ab(f&&f.prototype)}return b&&(b=X.createCallback(b,d,4),(e?Db:o)(a,function(a,d,e){return b(c,a,d,e)})),c},X.union=function(){return ib(eb(arguments,!0,!0))},X.uniq=Pb,X.values=yb,X.where=Bb,X.without=function(a){return db(a,l(arguments,1))},X.wrap=function(a,b){return kb(b,16,[a])},X.xor=function(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Jc(c)||qb(c))var d=d?ib(db(d,c).concat(db(c,d))):c}return d||[]},X.zip=Qb,X.zipObject=Rb,X.collect=Fb,X.drop=Nb,X.each=Db,X.eachRight=Eb,X.extend=U,X.methods=sb,X.object=Rb,X.select=Bb,X.tail=Nb,X.unique=Pb,X.unzip=Qb,Vb(X),X.clone=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),_(a,b,"function"==typeof c&&bb(c,d,1))},X.cloneDeep=function(a,b,c){return _(a,!0,"function"==typeof b&&bb(b,c,1))},X.contains=zb,X.escape=function(a){return null==a?"":fc(a).replace(Oc,lb)},X.every=Ab,X.find=Cb,X.findIndex=function(a,b,c){var d=-1,e=a?a.length:0;for(b=X.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1},X.findKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),o(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.findLast=function(a,b,c){var d;return b=X.createCallback(b,c,3),Eb(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d},X.findLastIndex=function(a,b,c){var d=a?a.length:0;for(b=X.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1},X.findLastKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),rb(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.has=function(a,b){return a?rc.call(a,b):!1},X.identity=Ub,X.indexOf=Mb,X.isArguments=qb,X.isArray=Jc,X.isBoolean=function(a){return!0===a||!1===a||a&&"object"==typeof a&&kc.call(a)==J||!1},X.isDate=function(a){return a&&"object"==typeof a&&kc.call(a)==K||!1},X.isElement=function(a){return a&&1===a.nodeType||!1},X.isEmpty=function(a){var b=!0;if(!a)return b;var c=kc.call(a),d=a.length;return c==I||c==P||c==H||c==N&&"number"==typeof d&&ub(a.splice)?!d:(o(a,function(){return b=!1}),b)},X.isEqual=function(a,b,c,d){return fb(a,b,"function"==typeof c&&bb(c,d,2))},X.isFinite=function(a){return zc(a)&&!Ac(parseFloat(a))},X.isFunction=ub,X.isNaN=function(a){return wb(a)&&a!=+a},X.isNull=function(a){return null===a},X.isNumber=wb,X.isObject=vb,X.isPlainObject=Pc,X.isRegExp=function(a){return a&&"object"==typeof a&&kc.call(a)==O||!1},X.isString=xb,X.isUndefined=function(a){return"undefined"==typeof a},X.lastIndexOf=function(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Cc(0,d+c):Dc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1},X.mixin=Vb,X.noConflict=function(){return c._=jc,this},X.noop=Wb,X.now=Uc,X.parseInt=Vc,X.random=function(a,b,c){var d=null==a,e=null==b;return null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1?(c=Fc(),Dc(a+c*(b-a+parseFloat("1e-"+((c+"").length-1))),b)):hb(a,b)},X.reduce=Hb,X.reduceRight=Ib,X.result=function(a,b){if(a){var c=a[b];return ub(c)?a[b]():c}},X.runInContext=m,X.size=function(a){var b=a?a.length:0;return"number"==typeof b?b:Kc(a).length},X.some=Kb,X.sortedIndex=Ob,X.template=function(a,b,c){var d=X.templateSettings;a=fc(a||""),c=t({},c,d);var e,f=t({},c.imports,d.imports),d=Kc(f),f=yb(f),h=0,i=c.interpolate||D,j="__p+='",i=ec((c.escape||D).source+"|"+i.source+"|"+(i===B?y:D).source+"|"+(c.evaluate||D).source+"|$","g");a.replace(i,function(b,c,d,f,i,k){return d||(d=f),j+=a.slice(h,k).replace(F,g),c&&(j+="'+__e("+c+")+'"),i&&(e=!0,j+="';"+i+";\n__p+='"),d&&(j+="'+((__t=("+d+"))==null?'':__t)+'"),h=k+b.length,b}),j+="';",i=c=c.variable,i||(c="obj",j="with("+c+"){"+j+"}"),j=(e?j.replace(v,""):j).replace(w,"$1").replace(x,"$1;"),j="function("+c+"){"+(i?"":c+"||("+c+"={});")+"var __t,__p='',__e=_.escape"+(e?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+j+"return __p}";try{var k=ac(d,"return "+j).apply(n,f)}catch(l){throw l.source=j,l}return b?k(b):(k.source=j,k)},X.unescape=function(a){return null==a?"":fc(a).replace(Nc,pb)},X.uniqueId=function(a){var b=++q;return fc(null==a?"":a)+b},X.all=Ab,X.any=Kb,X.detect=Cb,X.findWhere=Cb,X.foldl=Hb,X.foldr=Ib,X.include=zb,X.inject=Hb,Vb(function(){var a={};return o(X,function(b,c){X.prototype[c]||(a[c]=b)}),a}(),!1),X.first=Lb,X.last=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:n;return l(a,Cc(0,e-d))},X.sample=function(a,b,c){return a&&"number"!=typeof a.length&&(a=yb(a)),null==b||c?a?a[hb(0,a.length-1)]:n:(a=Jb(a),a.length=Dc(Cc(0,b),a.length),a)},X.take=Lb,X.head=Lb,o(X,function(a,b){var c="sample"!==b;X.prototype[b]||(X.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new Y(f,e):f})}),X.VERSION="2.4.1",X.prototype.chain=function(){return this.__chain__=!0,this},X.prototype.toString=function(){return fc(this.__wrapped__)},X.prototype.value=Yb,X.prototype.valueOf=Yb,Db(["join","pop","shift"],function(a){var b=hc[a];X.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new Y(c,a):c}}),Db(["push","reverse","sort","unshift"],function(a){var b=hc[a];X.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Db(["concat","slice","splice"],function(a){var b=hc[a];X.prototype[a]=function(){return new Y(b.apply(this.__wrapped__,arguments),this.__chain__)}}),X}var n,o=[],p=[],q=0,r=+new Date+"",s=75,t=40,u=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",v=/\b__p\+='';/g,w=/\b(__p\+=)''\+/g,x=/(__e\(.*?\)|\b__t\))\+'';/g,y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,z=/\w*$/,A=/^\s*function[ \n\r\t]+\w/,B=/<%=([\s\S]+?)%>/g,C=RegExp("^["+u+"]*0+(?=.$)"),D=/($^)/,E=/\bthis\b/,F=/['\n\r\t\u2028\u2029\\]/g,G="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),H="[object Arguments]",I="[object Array]",J="[object Boolean]",K="[object Date]",L="[object Function]",M="[object Number]",N="[object Object]",O="[object RegExp]",P="[object String]",Q={};Q[L]=!1,Q[H]=Q[I]=Q[J]=Q[K]=Q[M]=Q[N]=Q[O]=Q[P]=!0;var R={leading:!1,maxWait:0,trailing:!1},S={configurable:!1,enumerable:!1,value:null,writable:!1},T={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},V=T[typeof window]&&window||this,W=T[typeof exports]&&exports&&!exports.nodeType&&exports,X=T[typeof module]&&module&&!module.nodeType&&module,Y=X&&X.exports===W&&W,Z=T[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(V=Z);var $=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(V._=$,define(function(){return $})):W&&X?Y?(X.exports=$)._=$:W._=$:V._=$}).call(this),function(){function jsonp(a){var b="jsonp_callback_"+Math.round(1e5*Math.random());window[b]=function(a){delete window[b],document.body.removeChild(c);var d=_.keys(a);_.forEach(d,function(b){"response"!==b&&console.log(a[b])})};var c=document.createElement("script");c.src=a+(a.indexOf("?")>=0?"&":"?")+"callback="+b,document.body.appendChild(c)}function ajaxGet(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.setRequestHeader("Accept","text/xml"),b.setRequestHeader("Content-Type","application/html"),b.setRequestHeader("Access-Control-Allow-Origin","*"),b.setRequestHeader("Access-Control-Allow-Methods","GET, POST, PUT"),b.setRequestHeader("Access-Control-Allow-Headers","X-Requested-With");var c=a.split(".").pop();switch(c){case"txt":case"csv":break;case"json":break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":b.responseType="arraybuffer";break;case"html":b.responseType="document";break;default:b.responseType="blob"}b.onreadystatechange=function(){4==b.readyState&&200==b.status&&console.log(b.response)},b.send()}function loadBuffer(a){var b={};return actx.decodeAudioData(a,function(a){b=a}),b}function clone(a){var b;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,d=a.length;d>c;c++)b[c]=clone(a[c]);return b}if(a instanceof Object){if("dtm.array"==a.type)return a.clone();b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")}function append(){}function appendNoDupes(){}function blockWise(){return{}}function morphFixed(a,b,c){"undefined"==typeof c&&(c=.5);var d=[];return _.forEach(a,function(a,e){d[e]=(b[e]-a)*c+a}),d}function runningAvg(){}function capture(){}var params={isLogging:!1},dtm={version:"0.0.3",log:function(a){params.isLogging&&console.log(arguments.callee.caller.name?arguments.callee.caller.name+": "+a:a)},modelColl:[],modelCallers:{},clocks:[],params:{},get:function(a){switch(a){case"models":return dtm.modelColl;case"modelNames":var b=[];return _.forEach(dtm.modelColl,function(a){b.push(a.get("name"))}),b;default:return null}},wa:{isOn:!1},startWebAudio:function(){dtm.wa.isOn=!0,dtm.wa.actx=new(window.AudioContext||window.webkitAudioContext),dtm.wa.now=function(){return dtm.wa.actx.currentTime},dtm.wa.out=function(){return dtm.wa.actx.destination},dtm.wa.clMult=.01,dtm.wa.clockBuf=dtm.wa.actx.createBuffer(1,Math.round(dtm.wa.actx.sampleRate*dtm.wa.clMult),dtm.wa.actx.sampleRate),dtm.wa.makeNoise=function(a){var b=dtm.wa.actx;a=a||4192;var c=b.createBuffer(1,a,dtm.wa.actx.sampleRate),d=c.getChannelData(0);return _.forEach(_.range(a),function(a){d[a]=_.random(-1,1,!0)}),c},dtm.wa.makeIr=function(a){var b=dtm.wa.actx,c=Math.round(a*dtm.wa.actx.sampleRate)||dtm.wa.actx.sampleRate,d=b.createBuffer(2,c,dtm.wa.actx.sampleRate),e=d.getChannelData(0),f=d.getChannelData(1),g=10;return _.forEach(_.range(c),function(a){e[a]=dtm.val.rescale(dtm.val.expCurve(_.random(0,1,!0)*(c-a)/c,g),-1,1),f[a]=dtm.val.rescale(dtm.val.expCurve(_.random(0,1,!0)*(c-a)/c,g),-1,1)}),d},dtm.wa.buffs={verbIr:dtm.wa.makeIr(2)}},oscParams:{isOpen:!1,port:null},startOsc:function(){dtm.osc.isOn=!0,dtm.osc.start()}};this.dtm=dtm,dtm.loadData=function(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.open("GET",a,!0);var f=a.split(".").pop();switch(f){case"txt":case"csv":break;case"json":e.responseType="json";break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":e.responseType="arraybuffer";break;default:e.responseType="blob"}e.onreadystatechange=function(){4==e.readyState&&200==e.status?("undefined"!=typeof b&&b(e.response),c(e.response)):d(e.status)},e.send()})},dtm.loadAudio=function(a,b){return new Promise(function(c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onreadystatechange=function(){4==d.readyState&&200==d.status&&actx.decodeAudioData(d.response,function(a){c(a),"undefined"!=typeof b&&b(a)})},d.send()})},dtm.scales={Major:[0,4,7],minor:[0,3,7],Maj7:[0,4,7,11],"-7":[0,3,7,10],7:[0,4,7,10],"7sus4":[0,5,7,10]},dtm.osc={type:"dtm.osc",oscPort:null,isOn:!1,isOpen:!1,callbacks:[],start:function(){return"undefined"==typeof osc||dtm.osc.isOpen?dtm.osc.isOpen&&dtm.log("OSC port is already open"):(dtm.osc.isOpen=!0,dtm.log("opening OSC port"),dtm.osc.oscPort=new osc.WebSocketPort({url:"ws://localhost:8081"}),dtm.osc.oscPort.open(),dtm.osc.oscPort.listen(),dtm.osc.oscPort.on("ready",function(){dtm.osc.oscPort.on("message",function(a){switch(a.address){case"/test":}}),dtm.osc.oscPort.on("error",function(a){throw new Error(a)
})})),dtm.osc},stop:function(){return dtm.osc.oscPort&&dtm.osc.oscPort.close(1e3),dtm.osc.isOpen=!1,dtm.osc},on:function(a,b){return dtm.osc.oscPort.on("message",function(c){"/"!==a[0]&&(a="/".concat(a)),c.address==a&&b(c.args)}),dtm.osc},send:function(a,b){return"/"!==a[0]&&a.unshift("/"),b.constructor!==Array&&(b=[b]),dtm.osc.oscPort.send({address:a,args:b}),dtm.osc},clear:function(){dtm.osc.callbacks=[]}},dtm.osc.close=dtm.osc.stop,dtm.analyzer={type:"dtm.analyzer",checkType:function(a){var b=_.reduce(a,function(a,b){return a+b});return isNaN(b)||"string"==typeof b?"string":b.toString().indexOf(".")>-1?"float":"int"},min:function(a){return"string"===dtm.analyzer.checkType(a)?(dtm.log("cannot get the min value of a string array"),null):_.min(a)},max:function(a){return"string"===dtm.analyzer.checkType(a)?(dtm.log("cannot get the max value of a string array"),null):_.max(a)},mean:function(a){var b=dtm.anal.checkType(a);if("string"===b)return dtm.log("cannot get the mean value of a string array"),null;var c=_.reduce(a,function(a,b){return a+b});return c/_.size(a)},mode:function(a){var b=_.uniq(a),c=0,d=0,e=null,f=_.countBy(a);return _.forEach(b,function(a){d=f[a],d>c&&(e=a,c=d)}),e},median:function(a){var b=a.sort(),c=a.length;return c%2===0?(b[c/2-1]+b[c/2])/2:b[Math.floor(c/2)]},midrange:function(a){var b=dtm.analyzer.max(a),c=dtm.analyzer.min(a);return(b+c)/2},sum:function(a){var b=_.reduce(a,function(a,b){return a+b});return b},"var":function(a){var b=dtm.analyzer.mean(a),c=[];return _.forEach(a,function(a,d){c[d]=Math.pow(b-a,2)}),dtm.analyzer.sum(c)/(a.length-1)},std:function(a){return Math.sqrt(dtm.analyzer["var"](a))},pvar:function(a){var b=dtm.analyzer.mean(a),c=[];return _.forEach(a,function(a,d){c[d]=Math.pow(b-a,2)}),dtm.analyzer.mean(c)},pstd:function(a){return Math.sqrt(dtm.analyzer.pvar(a))},rms:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.pow(a,2)}),Math.sqrt(dtm.analyzer.mean(b))},histo:function(a){var b=[],c=_.clone(a),d=_.countBy(a);return _.forEach(c,function(a,c){b[c]=d[a]}),b},classes:function(a){return _.uniq(a).sort()},uniformity:function(a){return dtm.analyzer.classes(a).length/a.length},autoCorr:null},dtm.anal=dtm.analyzer,dtm.transform={type:"dtm.transform",generate:function(a,b,c,d){"undefined"==typeof b&&(b=8),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1);var e=[];switch(a){case"line":for(var f=(d-c)/(b-1),g=0;b>g;g++)e[g]=c+f*g;break;case"seq":case"sequence":c||(c=0),d=d||1;for(var g=0;b>g;g++)e[g]=g*d+c;break;case"range":c||(c=0),c=Math.round(c),d=Math.round(d);for(var g=0;d-c>g;g++)e[g]=g+c;break;case"noise":case"random":case"rand":for(var g=0;b>g;g++)e[g]=_.random(c,d,!0);break;case"randi":for(var g=0;b>g;g++)e[g]=_.random(c,d);break;case"gaussian":case"gauss":case"normal":for(var g=0;b>g;g++){var h=-Math.PI+2*Math.PI/b*g;e[g]=Math.pow(Math.E,-.5*Math.pow(h,2))/Math.sqrt(2*Math.PI)/.4*(d-c)+c}break;case"sin":case"sine":for(var g=0;b>g;g++){var f=2*Math.PI/(b-1),i=Math.sin(f*g);i=(i+1)/2*(d-c)+c,e[g]=i}break;case"cos":case"cosine":for(var g=0;b>g;g++){var f=2*Math.PI/(b-1),i=Math.cos(f*g);i=(i+1)/2*(d-c)+c,e[g]=i}break;case"zeros":case"zeroes":for(var g=0;b>g;g++)e[g]=0;break;case"ones":for(var g=0;b>g;g++)e[g]=1;break;case"constant":case"constants":case"const":case"consts":c=c||0;for(var g=0;b>g;g++)e[g]=c;break;case"string":case"str":case"s":case"characters":case"character":case"chars":case"char":case"c":e=arguments[1].split("")}return e},normalize:function(a,b,c){"undefined"==typeof b&&(b=_.min(a)),"undefined"==typeof c&&(c=_.max(a));var d=1;c==b?b>0&&1>=b?b=0:b>1&&(b-=1):d=c-b;var e=_.map(a,function(a){return(a-b)/d});return e},rescale:function(a,b,c,d,e){var f=dtm.transform.normalize(a,d,e),g=[];return _.forEach(f,function(a,d){g[d]=dtm.value.rescale(a,b,c)}),g},expCurve:function(a,b){b=b||1;var c=[];return _.forEach(a,function(a,d){c[d]=dtm.value.expCurve(a,b)}),c},logCurve:function(a,b){b=b||1;var c=[];return _.forEach(a,function(a,d){c[d]=dtm.value.logCurve(a,b)}),c},fit:function(a,b,c){c=c||"linear",b=1>b?1:Math.round(b);var d=[];d.length=b;var e=b/a.length;if("linear"===c){inNumItv=a.length-1,outNumItv=b-1,intermLen=inNumItv*outNumItv+1,intermArr=[],intermArr.length=intermLen;for(var f=0,g=0;g<inNumItv;g++)for(var h=0;h<outNumItv;h++)intermArr[f]=a[g]+(a[g+1]-a[g])*(h/outNumItv),f++;intermArr[f]=a[g];for(var i=0;i<outNumItv;i++)d[i]=intermArr[i*inNumItv];d[i]=intermArr[intermLen-1]}else if("step"===c)for(var h=0;b>h;h++)d[h]=a[Math.floor(h/e)];else if("zeros"===c)for(var j=-1,h=0;b>h;h++)j!==Math.floor(h/e)?(j=Math.floor(h/e),d[h]=a[j]):d[h]=0;return d},stretch:function(a,b,c){c=c||"linear";var d=Math.round(a.length*b);return 0==d&&(d=1),dtm.transform.fit(a,d,c)},limit:function(a,b,c){var d=[];return _.forEach(a,function(a,e){var f=a;b>f&&(f=b),f>c&&(f=c),d[e]=f}),d},fitSum:function(a,b,c){"undefined"==typeof c&&(c=!1);var d=dtm.analyzer.sum(a);0===d&&(a=dtm.transform.add(a,1e-6),d=dtm.analyzer.sum(a)),c&&(b=Math.round(b));var e=dtm.transform.mult(a,1/d*b);if(c&&(e=dtm.transform.round(e),dtm.analyzer.sum(e)!==b)){var f=1,g=dtm.analyzer.sum(e)-b,h=0>g;if(h)for(;0>g;)e[dtm.val.mod(a.length-f,a.length)]++,g++,f++;else for(;g>0;)e[a.length-f]>0?(e[dtm.val.mod(a.length-f,a.length)]--,g--,f++):f++}return e},add:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=a+b});else if(b.constructor===Array){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=a[e]+b[e]}return d},mult:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=a*b});else if(b.constructor===Array){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=a[e]*b[e]}return d},pow:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=Math.pow(a,b)});else if(b.constructor===Array){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=Math.pow(a[e],b[e])}return d},powof:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=Math.pow(b,a)});else if(b.constructor===Array){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=Math.pow(b[e],a[e])}return d},round:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.round(a)}),b},floor:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.floor(a)}),b},ceil:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.floor(a)}),b},hwr:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=0>a?0:a}),b},fwr:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=0>a?Math.abs(a):a}),b},removeZeros:function(a){for(var b=[],c=0;c<a.length;c++)0!==a[c]&&b.push(a[c]);return b},diff:function(a){for(var b=[],c=1;c<a.length;c++)b.push(a[c]-a[c-1]);return b},mirror:function(a){for(var b=[],c=a.length-1;c>=0;--c)b.push(a[c]);return b},invert:function(a,b){"undefined"==typeof b&&(b=dtm.analyzer.mean(a));var c=[];return _.forEach(a,function(a,d){c[d]=b-(a-b)}),c},shuffle:function(a){return _.shuffle(a)},sort:function(a){return _.sortBy(a,function(a){return a})},repeat:function(a,b){var c=[];b||(b=1);for(var d=0;b>d;d++)c=c.concat(a);return c},truncate:function(a,b,c){var d=[];if("undefined"!=typeof c)for(var e=0;e<a.length-(b+c);e++)d[e]=a[b+e];else for(var f=0;f<a.length-b;f++)d[f]=a[f];return d},getBlock:function(a,b,c){for(var d=[],e=0,f=0;c>f;f++)e=dtm.val.mod(f+b,a.length),d[f]=a[e];return d},shift:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=dtm.value.mod(d+b,a.length);c[d]=a[e]}return c},morph:function(a,b,c,d){"undefined"==typeof c&&(c=.5);var e=a.length,f=b.length,g=Math.round((f-e)*c+e);return morphFixed(dtm.transform.fit(a,g,d),dtm.transform.fit(b,g),c)},interleave:function(){},notesToBeats:function(a,b){var c=[],d=0;return _.forEach(a,function(a){for(var e=b/a,f=0;e>f;f++)c[d]=0===f?1:0,d++}),c},beatsToNotes:function(a,b){for(var c=[],d=1,e=0;e<a.length-1;e++)0!==a[e+1]?(c.push(b/d),d=1):d++;return c.push(b/d),c},intervalsToBeats:function(a){var b=[],c=0;return _.forEach(a,function(a){for(var d=a,e=0;d>e;e++)b[c]=0===e?1:0,c++}),b},beatsToIntervals:function(a){for(var b=[],c=1,d=0;d<a.length-1;d++)0!==a[d+1]?(b.push(c),c=1):c++;return b.push(c),b},beatsToIndices:function(a){for(var b=[],c=0;c<a.length;c++)0!==a[c]&&b.push(c);return b},indicesToBeats:function(a,b){if(a=dtm.transform.sort(a),"undefined"==typeof b)for(var c=0,d=1;a[a.length-1]>=d;)d=Math.pow(2,++c);else d=b;for(var e=e=dtm.transform.generate("zeros",d),f=0;f<a.length&&!(a[f]>=b);f++)e[a[f]]=1;return e},calcBeatsOffset:function(a,b){for(var c=[],d=0,e=!1,f=!1,g=0;g<a.length;g++)1!==a[g]||f?1!==b[g]||e||(f=!0):e=!0,e?1===b[g]?(c.push(d),e=f=!1,d=0):d++:f&&(1===a[g]?(c.push(d),e=f=!1,d=0):d--);return c},applyOffsetToBeats:function(a,b){for(var c=dtm.array().fill("zeroes",a.length).get(),d=0,e=0;e<a.length;e++)1===a[e]&&(c[e+b[d]]=1,d++);return c},lreModulation:function(a,b){for(var c=[],d=0,e=0,f=0;f<a.length;f++)c[f]=0,0!==a[f]&&d++;for(var g=a.length/d,h=[],i=0;i<a.length;i++)if(0!==a[i]){var j=i-g*e;h.push(Math.round(g*e+j*(b-.5)*2)),e++}for(var k=0;k<h.length;k++){var l=h[k];0>l?l=0:l>=a.length&&(l=a.length-1),c[l]=1}return c},pq:function(a,b,c){var d=[];return _.forEach(a,function(a,e){d[e]=dtm.value.pq(a,b,c)}),d},unique:function(a){return _.uniq(a)},classId:function(a){var b=[],c=dtm.analyzer.classes(a).sort(),d={};return _.forEach(c,function(a,b){d[a]=b}),_.forEach(a,function(a,c){b[c]=d[a]}),b},stringify:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=a.toString()}),b},tonumber:function(a){var b=[];return a.forEach(function(a,c){b[c]=Number.parseFloat(a)}),b}},dtm.transform.ntob=dtm.transform.notesToBeats,dtm.transform.bton=dtm.transform.beatsToNotes,dtm.transform.itob=dtm.transform.intervalsToBeats,dtm.transform.btoi=dtm.transform.beatsToIntervals,dtm.transform.fill=dtm.transform.generate,dtm.transform.abs=dtm.transform.fwr,dtm.transform.randomize=dtm.transform.shuffle,dtm.tr=dtm.transform,dtm.array=function(){function a(a){b.type=isNaN(a[0])?"object"==typeof a[0]?"collection":typeof a[0]:"number"}var b={name:"",type:null,length:null,min:null,max:null,mean:null,std:null,mode:null,value:[],original:null,normalized:[],classes:null,histogram:null,numClasses:null,index:0,step:1},c={type:"dtm.array"};return c.get=function(a){if("number"==typeof a)return 0>a||a>=b.length?(dtm.log("Index out of range"),b.value[dtm.value.mod(a,b.length)]):b.value[a];switch(a){case"name":case"key":return b.name;case"type":return b.type;case"len":case"length":return b.length;case"minimum":case"min":return dtm.analyzer.min(b.value);case"maximum":case"max":return dtm.analyzer.max(b.value);case"minmax":case"range":return[dtm.analyzer.min(b.value),dtm.analyzer.max(b.value)];case"mean":case"average":case"avg":return dtm.analyzer.mean(b.value);case"mode":return dtm.analyzer.mode(b.value);case"median":return dtm.analyzer.median(b.value);case"midrange":return dtm.analyzer.midrange(b.value);case"standardDeviation":case"std":return dtm.analyzer.std(b.value);case"pstd":return dtm.analyzer.pstd(b.value);case"variance":case"var":return dtm.analyzer["var"](b.value);case"populationVariance":case"pvar":return dtm.analyzer.pvar(b.value);case"sumAll":case"sum":return dtm.analyzer.sum(b.value);case"rms":return dtm.analyzer.rms(b.value);case"pdf":break;case"current":case"curr":case"cur":case"now":case"moment":return b.value[b.index];case"next":return b.index=dtm.value.mod(b.index+b.step,b.length),b.value[b.index];case"prev":case"previous":return b.index=dtm.value.mod(b.index-b.step,b.length),b.value[b.index];case"palindrome":break;case"rand":case"random":return b.index=_.random(0,b.length-1),b.value[b.index];case"urn":break;case"index":case"idx":return b.index;case"hop":case"hopSize":case"step":case"stepSize":return b.step;case"relative":case"location":case"loc":break;case"block":case"window":var c,d;return arguments[1].constructor===Array?(c=arguments[1][0],d=arguments[1][1],dtm.transform.getBlock(b.value,c,d)):"number"==typeof arguments[1]&&"number"==typeof arguments[2]?(c=arguments[1],d=arguments[2],dtm.transform.getBlock(b.value,c,d)):b.value;case"blockNext":return b.index=dtm.value.mod(b.index+b.step,b.length),dtm.transform.getBlock(b.value,b.index,arguments[1]);case"original":return b.original;case"normal":case"normalize":case"normalized":return dtm.transform.normalize(b.value);case"sorted":case"sort":return dtm.transform.sort(b.value);case"uniques":case"unique":case"uniq":return dtm.transform.unique(b.value);case"classes":return dtm.analyzer.classes(b.value);case"classID":case"classId":return dtm.transform.classId(b.value);case"string":case"stringify":return dtm.transform.stringify(b.value);case"numClasses":case"numUniques":case"numUniqs":return dtm.analyzer.classes(b.value).length;case"unif":case"uniformity":return dtm.analyzer.uniformity(b.value);case"histogram":case"histo":return dtm.analyzer.histo(b.value);default:return b.value}},c.set=function(d){return"undefined"==typeof d&&(d=[]),"number"==typeof d?b.value=[d]:d.constructor===Array?b.value=d:"dtm.array"===d.type?b.value=d.get():"string"==typeof d&&(b.value=dtm.transform.fill.apply(this,arguments)),null===b.original&&(b.original=b.value),a(b.value),b.length=b.value.length,b.index=b.length-1,c},c.name=function(a){return a||(a=""),b.name=a.toString(),c},c.setType=function(a){return b.type=a.toString(),c},c.set.apply(this,arguments),a(b.value),c.step=function(a){return b.step=Math.round(a),c},c.stepSize=c.step,c.index=function(a){return b.index=dtm.value.mod(Math.round(a),b.length),c},c.setIndex=c.index,c.fill=function(){return b.value=dtm.transform.generate.apply(this,arguments),c.set(b.value),c},c.gen=c.generate=c.fill,c.clone=function(){var a=dtm.array(b.value).name(b.name);return a.index(b.index),a.step(b.step),"string"===b.type&&(a.classes=b.classes,a.histogram=_.clone(b.histogram),a.setType("string")),a},c.d=c.dup=c.duplicate=c.c=c.copy=c.clone,c.morph=function(a,d,e){return"array"!=typeof a&&"dtm.array"===a.type&&(a=a.get()),"undefined"==typeof d&&(d=.5),b.value=dtm.transform.morph(b.value,a,d,e),c.set(b.value),c},c.reset=function(){return c.set(b.original),c},c.original=c.reset,c.flush=function(){return c.set([])},c.clear=c.flush,c.normalize=function(a,d){return b.value=dtm.transform.normalize(b.value,a,d),c.set(b.value),c},c.nml=c.normal=c.normalize,c.rescale=function(a,d,e,f){return b.value=dtm.transform.rescale(b.value,a,d,e,f),c.set(b.value),c},c.range=c.scale=c.rescale,c.limit=function(a,d){return"number"===b.type?(a=a||0,d=d||1,c.set(dtm.transform.limit(c.get(),a,d))):c},c.clip=c.limit,c.expCurve=function(a,b,d){"undefined"==typeof b&&(b=c.get("min")),"undefined"==typeof d&&(d=c.get("max"));var e=dtm.transform.expCurve(c.get("normalized"),a);return c.set(dtm.transform.rescale(e,b,d)),c},c.exp=c.expCurve,c.logCurve=function(a,b,d){"undefined"==typeof b&&(b=c.get("min")),"undefined"==typeof d&&(d=c.get("max"));var e=dtm.transform.logCurve(c.get("normalized"),a);return c.set(dtm.transform.rescale(e,b,d)),c},c.log=c.logCurve,c.fit=function(a,d){return b.value=dtm.transform.fit(b.value,a,d),c.set(b.value),c},c.fitLen=c.fit,c.stretch=function(a,d){return b.value=dtm.transform.stretch(b.value,a,d),c.set(b.value),c},c.summarize=function(){return c},c.fitSum=function(a,d){return c.set(dtm.transform.fitSum(b.value,a,d))},c.fitsum=c.fitSum,c.add=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(dtm.transform.add(b.value,a,d)),c},c.mult=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(dtm.transform.mult(b.value,a,d)),c},c.pow=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(dtm.transform.pow(b.value,a,d)),c},c.powof=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(dtm.transform.powof(b.value,a,d))},c.sort=function(){return b.value=dtm.transform.sort(b.value),c.set(b.value),c},c.concat=function(a){"undefined"==typeof a&&(a=[]);var d=b.value;return a.constructor===Array||"number"==typeof a?d=d.concat(a):"dtm.array"===a.type&&(d=d.concat(a.get())),c.set(d),c},c.append=c.concat,c.repeat=function(a){return b.value=dtm.transform.repeat(b.value,a),c.set(b.value),c},c.rep=c.repeat,c.truncate=function(a,d){return b.value=dtm.transform.truncate(b.value,a,d),c.set(b.value),c},c.slice=c.truncate,c.getBlock=function(a,d){return a=a||0,d=d||b.length,c.set(dtm.transform.getBlock(b.value,a,d))},c.block=c.getBlock,c.shift=function(a){return b.value=dtm.transform.shift(b.value,a),c.set(b.value),c},c.mirror=function(){return b.value=dtm.transform.mirror(b.value),c.set(b.value),c},c.rev=c.reverse=c.mirror,c.invert=function(a){return b.value=dtm.transform.invert(b.value,a),c.set(b.value),c},c.flip=c.inv=c.invert,c.shuffle=function(){return b.value=dtm.transform.shuffle(b.value),c.set(b.value),c},c.rand=c.random=c.randomize=c.shuffle,c.queue=function(a){return"number"==typeof a?(b.value.push(a),b.value.shift()):a.constructor===Array?(b.value=b.value.concat(a),b.value=b.value.splice(a.length)):"dtm.array"===a.type&&(b.value=b.value.concat(a.get()),b.value=b.value.splice(a.get("len"))),c.set(b.value)},c.fifo=c.queue,c.round=function(){return b.value=dtm.transform.round(b.value),c.set(b.value),c},c.floor=function(){return c.set(dtm.transform.floor(b.value))},c.ceil=function(){return c.set(dtm.transform.ceil(b.value))},c.hwr=function(){return c.set(dtm.transform.hwr(b.value)),c},c.fwr=function(){return c.set(dtm.transform.fwr(b.value)),c},c.abs=c.fwr,c.derivative=function(){return c},c.diff=function(){return c.set(dtm.transform.diff(b.value))},c.removeZeros=function(){return c.set(dtm.transform.removeZeros(b.value))},c.histo=function(){return c.set(dtm.analyzer.histo(b.value)),b.type="string",c},c.histogram=c.hist=c.histo,c.unique=function(){return c.set(dtm.transform.unique(b.value)),c},c.uniq=c.unique,c.classId=function(){return c.set(dtm.transform.classId(b.value))},c["class"]=c.classify=c.classId,c.stringify=function(){return c.set(dtm.transform.stringify(b.value))},c.tostring=c.stringify,c.tonumber=function(){return c.set(dtm.transform.tonumber(b.value))},c.toNumber=c.tonumber,c.morethan=function(){return c},c.mt=c.morethan,c.lessthan=function(){return c},c.lt=c.lessthan,c.pq=function(a,d){return 0===arguments.length?a=_.range(12):a.constructor===Array||"string"==typeof a&&(a=dtm.scales[a.toLowerCase()]),c.set(dtm.transform.pq(b.value,a,d))},c.pitchScale=c.pitchQuantize=c.pq,c.transpose=function(){return c},c.notesToBeats=function(a){return a=a||4,b.value=dtm.transform.notesToBeats(b.value,a),c.set(b.value),c},c.ntob=c.notesToBeats,c.beatsToNotes=function(a){return a=a||4,b.value=dtm.transform.beatsToNotes(b.value,a),c.set(b.value),c},c.bton=c.beatsToNotes,c.intervalsToBeats=function(){return b.value=dtm.transform.intervalsToBeats(b.value),c.set(b.value),c},c.itob=c.intervalsToBeats,c.beatsToIntervals=function(){return b.value=dtm.transform.beatsToIntervals(b.value),c.set(b.value),c},c.btoi=c.beatsToIntervals,c.beatsToIndices=function(){return b.value=dtm.transform.beatsToIndices(b.value),c.set(b.value),c},c.btoid=c.beatsToIndices,c.indicesToBeats=function(a){return c.set(dtm.transform.indicesToBeats(b.value,a))},c.idtob=c.indicesToBeats,c},dtm.a=dtm.arr=dtm.array,dtm.collection=function(){var a={type:"dtm.collection"};return a.get=function(){var a=null;return a},a.set=function(){return a},a.update=function(){return a},a.map=function(){return a},a},dtm.coll=dtm.collection,dtm.value={type:"dtm.value",rescale:function(a,b,c,d){d=d||!1;var e=a*(c-b)+b;return d&&(e=Math.round(e)),e},expCurve:function(a,b){return b=1>=b?1.000001:b,(Math.exp(a*Math.log(b))-1)/(b-1)},logCurve:function(a,b){return b=1>=b?1.000001:b,Math.log(a*(b-1)+1)/Math.log(b)},mtof:function(a){return 440*Math.pow(2,(a-69)/12)},pq:function(a,b,c){"undefined"==typeof b&&(b=[0,1,2,3,4,5,6,7,8,9,10,11]),"undefined"==typeof c&&(c=!1);var d=a%12,e=a-d,f=Math.floor(d/12*b.length),g=0;return c||(g=a%1),e+b[f]+g},mod:function(a,b){return(a%b+b)%b},incr:function(){},randi:function(a,b){return _.random(a,b)},random:function(a,b){return"undefined"==typeof a&&"undefined"==typeof b&&(a=0,b=1),_.random(a,b,!0)}},dtm.value.rand=dtm.value.random,dtm.v=dtm.val=dtm.value,dtm.iterator=function(a){var b={type:"dtm.iterator",array:null,idx:0,len:0,order:null,range:{},modIdx:[]};return b.set=function(a){return"undefined"!=typeof a&&(b.len=a.length,b.array="dtm.array"===a.type?a:dtm.array(a)),b},b.set(a),b.next=function(a){"undefined"==typeof a&&(a="value");var c=b.array[a][b.idx];return b.idx=dtm.value.mod(b.idx+1,b.array.length),c},b.prev=function(a){"undefined"==typeof a&&(a="value");var c=b.array[a][b.idx];return b.idx=dtm.value.mod(b.idx-1,b.array.length),c},b.jump=function(a,c){"undefined"==typeof c&&(c="value");var d=b.array[c][b.idx];return b.idx=dtm.value.mod(a,b.array.length),d},b.random=function(a){return"undefined"==typeof a&&(a="value"),b.idx=Math.floor(Math.random()*b.array.length),b.array[a][b.idx]},b.urn=function(){var a=_.range(b.array.length-1);b.modIdx=dtm.transform.shuffle(a)},b.drunk=function(a,c,d){"undefined"==typeof a&&(a=1),"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d="value");var e=1;c&&(e=0);var f=_.random(e,a);return _.random(0,1)&&(f=-f),b.idx=dtm.value.mod(b.idx+f,b.array.length),b.array[d][b.idx]},b.setRange=function(){},b.previous=b.prev,b},dtm.it=dtm.iter=dtm.iterator,dtm.parser={type:"dtm.parser",parseCsv:function(){return parser},csvToJson:function(a){for(var b=a.split("\r"),c=[],d=b[0].split(","),e=1;e<b.length;e++){var f={},g=b[e].split(",");if(g.length>1){for(var h=0;h<d.length;h++){var i=g[h];isNaN(i)||(i=Number.parseFloat(i)),f[d[h]]=i}c.push(f)}}return c},valueTypes:function(a){var b=[];return _.forEach(a,function(a){var c=parseFloat(a);b.push(isNaN(c)?"string":a.indexOf(".")>-1?"float":"int")}),b},getSize:function(a){var b=_.size(a[0]),c=_.size(a);return[b,c]}},dtm.data=function(arg,cb,type){function setArrays(){_.forEach(params.keys,function(a){var b=dtm.array(_.pluck(params.coll,a)).name(a);params.arrays[a]=b})}function setTypes(){_.forEach(params.keys,function(a){params.types[a]=params.arrays[a].get("type")})}function setSize(){params.size.col=params.keys.length,params.size.row=params.coll.length}var params={arrays:{},coll:[],keys:[],types:{},size:{}},data={type:"dtm.data",name:"dtm.data",promise:null,callback:null};return data.get=function(a,b){if("string"!=typeof a)return"number"==typeof a?a>=0&&a<params.size.col?params.arrays[params.keys[a]].clone():(dtm.log("data.get(): index out of range"),data):data;switch(a){case"a":case"arr":case"array":case"arrays":case"column":return"number"==typeof b?b>=0&&b<params.size.col?params.arrays[params.keys[b]].clone():(dtm.log("data.get(): index out of range"),data):"string"==typeof b?params.keys.indexOf(b)>-1?params.arrays[b].clone():(dtm.log("data.get(): key does not exist"),data):(dtm.log("data.get(): please specify array with index or name"),params.arrays);case"c":case"col":case"coll":case"collection":return params.coll;case"row":case"r":return params.coll[b];case"size":case"dim":case"dimension":return params.size;case"len":case"length":return params.size.row;case"k":case"key":case"keys":case"name":case"names":case"list":return params.keys.slice();case"t":case"type":case"types":return params.types;default:return data}},data.set=function(a){params.coll=a,params.keys=_.keys(params.coll[0]),setArrays(),setTypes(),setSize()},data.load=function(url,cb){return"undefined"!=typeof cb&&(data.callback=cb),data.promise=new Promise(function(resolve,reject){var ext=url.split(".").pop();if("jsonp"===ext){var cbName="jsonp_callback_"+Math.round(1e5*Math.random());window[cbName]=function(a){delete window[cbName],document.body.removeChild(script);var b=_.keys(a);_.forEach(b,function(b){"response"!==b&&(params.coll=a[b],params.keys=_.keys(params.coll[0]),setArrays(),setTypes(),setSize(),resolve(data))}),"undefined"!=typeof cb&&cb(data)};var script=document.createElement("script");script.src=url+(url.indexOf("?")>=0?"&":"?")+"callback="+cbName,document.body.appendChild(script)}else{var xhr=new XMLHttpRequest;switch(xhr.open("GET",url,!0),xhr.withCredentials="true",console.log(xhr.withCredentials),ext){case"txt":case"csv":break;case"json":break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":xhr.responseType="arraybuffer"}xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status)if("arraybuffer"===xhr.responseType)dtm.wa.actx.decodeAudioData(xhr.response,function(a){for(var b=0;b<a.numberOfChannels;b++){var c=a.getChannelData(b);params.arrays["ch_"+b]=dtm.array(Array.prototype.slice.call(c)).name("ch_"+b)}"undefined"!=typeof cb&&cb(data),resolve(data)});else{var keys=[];if("csv"===ext)params.coll=dtm.parser.csvToJson(xhr.response),keys=_.keys(params.coll[0]);else if("json"===ext){var res=xhr.responseText;try{res=JSON.parse(res)}catch(e){try{res=eval(res)}catch(e){console.log("Could not parse the JSON file. Maybe the format is not right.")}}var second=res[Object.keys(res)[0]];keys=Object.keys(second.constructor===Array?second[0]:second),params.coll=res}else params.coll=second;params.keys=keys,setArrays(),setTypes(),setSize(),"undefined"!=typeof cb&&cb(data),resolve(data)}},xhr.send()}}),data.promise.get=function(a){data.promise.then(function(b){return data=b,b.get(a)})},"dtm.data"===data.name?data:"dtm.load"===data.name?data.promise:void 0},data.clone=function(){return dtm.clone(data)},data.map=function(){return data},data.stream=function(){return data},data.init=function(a){if(1===arguments.length){if("number"==typeof a)for(var b=0;a>b;b++)params.arrays[b]=dtm.array(),params.keys[b]=b.toString(),params.size.col=a,params.size.row=0;else if("object"==typeof a)for(var b=0;b<a.num;b++)params.arrays[b]=dtm.array().fill("zeros",a.len),params.keys[b]=b.toString(),params.size.col=a.num,params.size.row=a.len}else if(2===arguments.length)for(var b=0;b<arguments[0];b++)params.arrays[b]=dtm.array().fill("zeros",arguments[1]),params.keys[b]=b.toString(),params.size.col=arguments[0],params.size.row=arguments[1];else if(3===arguments.length)for(var b=0;b<arguments[0];b++)params.arrays[arguments[2][b]]=dtm.array().fill("zeros",arguments[1]).name(arguments[2][b]),params.keys[b]=arguments[2][b],params.size.col=arguments[0],params.size.row=arguments[1];return data},data.append=function(a){if(a.constructor===Array){for(var b=0;b<a.length;b++)"undefined"!=typeof params.arrays[params.keys[b]]&&params.arrays[params.keys[b]].append(a[b]);params.size.row++}return data},data.queue=function(a){if(a.constructor===Array)for(var b=0;b<a.length;b++)"undefined"!=typeof params.arrays[params.keys[b]]&&params.arrays[params.keys[b]].queue(a[b]);return data},data.flush=function(){return _.forEach(params.arrays,function(a){a.flush()}),params.size.row=0,data},"undefined"==typeof arg?data:"string"==typeof arg?data.load(arg,cb):void 0},dtm.load=dtm.d=dtm.data,dtm.load.name="dtm.load",dtm.clock=function(a,b,c){var d={source:"animationFrame",name:null,isOn:!1,sync:!0,isMaster:!1,bpm:120,subDiv:16,random:0,swing:.5,current:0,previous:0,reported:0,resolution:480,beat:0,prevBeat:-1,offset:0,requestId:null,autoStart:!0},e={type:"dtm.clock",interval:1,time:[4,4],beat:0,list:[],prev:0,callbacks:[]},f=0;e.get=function(a){switch(a){case"bpm":case"tempo":return d.bpm;case"subdiv":case"subDiv":case"div":return d.subDiv;case"sync":case"synced":return d.sync;case"isOn":case"isPlaying":return d.isOn;case"source":return d.source;case"beat":return d.beat;case"cur":case"current":return d.current;case"prev":case"previous":return d.previous;case"rep":case"reported":return d.reported;default:return e}},e.set=function(a,b,c){return"number"==typeof a?(d.bpm=a,d.sync=!1):"boolean"==typeof a?d.sync=a:"sync"==a&&(d.sync=!0),"undefined"!=typeof b&&(d.subDiv=b),"undefined"!=typeof c&&(d.autoStart=c),e},e.sync=function(a){return"undefined"==typeof a&&(a=!0),d.sync=a,e},e.bpm=function(a){return arguments&&a?(d.bpm=a,d.sync=!1,e):e},e.tempo=e.bpm,e.subDiv=function(a){return a=a||4,d.subDiv=a,e},e.div=e.subdiv=e.subDiv,e.interval=function(){return e},e.setTime=function(a){return"Array"==typeof a?e.time=a:"string"==typeof a&&(e.time=a.split("/")),e},e.setMaster=function(a){return d.isMaster=a,e},e.add=function(a,b){var c=!1;return"string"==typeof b?(_.forEach(e.callbacks,function(a){a.name==b&&(dtm.log("clock.add(): identical function exists in the callback list"),c=!0)}),c||(dtm.log("adding a new callback function to clock"),e.callbacks.push(a))):(_.forEach(e.callbacks,function(b){_.isEqual(b,a)&&(dtm.log("clock.add(): identical function exists in the callback list"),c=!0)}),c||(dtm.log("adding a new callback function to clock"),e.callbacks.push(a))),e},e.call=e.register=e.reg=e.add,e.remove=function(a){return"function"==typeof a?(dtm.log("removing a calblack function"),_.remove(e.callbacks,function(b){return _.isEqual(b,a)})):"string"==typeof a&&(dtm.log("removing a calblack function: "+a),_.remove(e.callbacks,function(b){return b.name==a})),e},e.del=e["delete"]=e.rem=e.remove,e.modify=function(a,b){if("function"==typeof a)dtm.log("modifying the callback: "+a.name),e.remove(a.name),e.add(a);else if("string"==typeof a)if(dtm.log("modifying the callback: "+a),e.remove(a),""==b.name){var c=new Function("return function "+a+b.toString().slice(8))();e.add(c)}else e.add(b);return e},e.replace=e.mod=e.modify,e.start=function(){return"animationFrame"===d.source&&window.requestAnimationFrame(e.tick),dtm.log(d.isMaster?"starting the master clock":"starting a clock"),d.isOn!==!0&&(d.isOn=!0,e.tick(),d.isMaster||dtm.clocks.push(e)),e},e.run=e.play=e.start;var g;return e.tick=function(a){if(d.isOn)if(d.sync||d.isMaster){if(d.sync&&!d.isMaster);else if(d.isMaster)if("webAudio"===d.source){g=actx.createBufferSource(),g.buffer=clockBuf,g.connect(out());var b=d.bpm/60*(d.subDiv/4);g.playbackRate.value=b*clMult,g.playbackRate.value+=g.playbackRate.value*d.random*_.sample([1,-1]),g.playbackRate.value*=e.beat%2==0?(1-d.swing)/.5:d.swing/.5,g.start(now()+1e-7),g.onended=function(){f+=1/b;var a=now()-f;e.tick(a)},_.forEach(e.callbacks,function(a){a(e)}),e.beat=(e.beat+1)%(d.subDiv*e.time[0]/e.time[1])}else"animationFrame"===d.source&&(d.reported=Math.round(a/1e3*d.bpm/60*d.resolution),d.reported!==d.current&&(d.current%d.resolution>d.reported%d.resolution&&(d.beat=Math.round((d.current-d.offset)/d.resolution)),_.forEach(e.callbacks,function(a){a(e)}),d.current=d.reported),d.requestId=window.requestAnimationFrame(e.tick))}else if("webAudio"===d.source){g=actx.createBufferSource(),g.buffer=clockBuf,g.connect(out());var b=d.bpm/60*(d.subDiv/4);g.playbackRate.value=b*clMult,g.playbackRate.value+=g.playbackRate.value*d.random*_.sample([1,-1]),g.playbackRate.value*=e.beat%2==0?(1-d.swing)/.5:d.swing/.5,g.start(now()+1e-7),g.onended=function(){f+=1/b;now()-f;e.tick()},_.forEach(e.callbacks,function(a){a(e)}),e.beat=(e.beat+1)%(d.subDiv*e.time[0]/e.time[1])}else"animationFrame"===d.source&&(d.reported=Math.round(a/1e3*d.bpm/60*d.resolution*d.subDiv/4),d.reported!==d.current&&(d.current%d.resolution>d.reported%d.resolution&&(d.beat=Math.round(d.current/d.resolution),_.forEach(e.callbacks,function(a){a(e)})),d.current=d.reported),window.requestAnimationFrame(e.tick));return e},e.tickSynced=function(){return d.sync&&d.isOn&&("webAudio"===dtm.master.clock.get("source")?dtm.master.clock.beat%Math.round(d.resolution/d.subDiv)===0&&_.forEach(e.callbacks,function(a){a(e)}):"animationFrame"===dtm.master.clock.get("source")&&(dtm.master.clock.get("cur")%(d.resolution/d.subDiv*4)<d.prev&&(d.beat=Math.round((dtm.master.clock.get("cur")-d.offset)/d.resolution*d.subDiv/4),_.forEach(e.callbacks,function(a){a(e)}),d.prevBeat=d.beat),d.prev=dtm.master.clock.get("cur")%(d.resolution/d.subDiv*4))),e},e.stop=function(){return dtm.log(d.isMaster?"stopping the master clock":"stopping a clock"),d.isOn===!0&&(d.isOn=!1),e},e.clear=function(){return e.callbacks=[],e},e.swing=function(a){return d.swing=a||.5,e},e.shuffle=e.swing,e.randomize=function(a){return d.random=a||0,e},e.random=e.randomize,e.rand=e.randomize,e.reset=function(){return d.offset=d.isMaster?d.current:dtm.master.clock.get("cur"),d.beat=0,e
},e.flush=function(){return e},e.when=function(a,b){return"undefined"!=typeof a&&a.indexOf(e.beat)>-1&&"undefined"!=typeof b&&b(e),e},e.notWhen=function(a,b){return"undefined"!=typeof a&&-1==a.indexOf(e.beat)&&"undefined"!=typeof b&&b(e),e},e.on=function(a){switch(a){case"every":e.callbacks.push(function(a){a.get("beat")%arguments[1]===0&&arguments[2](a)})}return e},e.delayEvent=function(){return e},e.delay=e.delayEvent,d.isMaster||"undefined"==typeof dtm.master||(dtm.master.clock.add(e.tickSynced),d.autoStart&&e.start()),e.set(a,b,c),e},dtm.c=dtm.clock,dtm.instr=function(a){var b={name:"default",isPlaying:!1,poly:!1,modDest:[],modList:[],sync:!0,clock:dtm.clock(!0,8),instrModel:null,callbacks:[],defInstr:function(){var a=b.models.voice,c=b.models.volume.get("next"),d=b.models.dur.get("next"),e=b.models.rhythm.get("next"),f=b.models.pitch.get("next"),g=b.models.scale.get(),h=b.models.transp.get("next"),i=b.models.chord.get(),j=b.models.subdiv.get("next");b.clock.subDiv(j);var k=b.models.wavetable,l=b.models.lpf,m=b.models.comb,n=b.models.delay;b.sync===!1&&b.clock.bpm(b.models.bpm.get("next")),_.forEach(b.callbacks,function(a){a(b.clock)}),e&&_.forEach(i,function(e){k&&a.wt(k.get()),l&&a.lpf(l.get("next"),b.models.res.get("next")),m&&a.comb(.5,b.models.comb.get("next")),n&&a.delay(b.models.delay.get("next")),a.dur(d).decay(d),a.nn(dtm.val.pq(f+e,g,b.pqRound)+h).amp(c).play()})}},c={type:"dtm.instrument",params:[]};return c.get=function(a){switch(a){case"name":return b.name;case"isplaying":case"isPlaying":return b.isPlaying;case"c":case"clock":return b.clock;case"beat":return b.clock.get("beat");case"m":case"mod":case"model":case"models":case"modList":return c.params;case"param":case"params":}},c.set=function(a,d){switch("number"==typeof d?b.models[a]=dtm.array(d):d.constructor===Array?b.models[a]=dtm.array(d):"dtm.array"===d.type?b.models[a]=d.clone():"dtm.model"===d.type||"dtm.synth"===d.type&&(b.models[a]=d),a){case"bpm":case"tempo":break;case"div":case"subdiv":case"subDiv":}return c},c.clone=function(){return c},c.model=function(){var a=arguments[0],d="none";if("string"==typeof arguments[1]&&(d=arguments[1]),a.constructor===Array)d?b.models[d]=dtm.array(a):b.models.none=dtm.array(a);else if("object"==typeof a)"dtm.model"===a.type?"instr"===a.get("categ")?(dtm.log('assigning model "'+a.params.name+'" to category "'+d+'"'),b.models[d]=a,b.modDest.push(a)):a.get("categ")?(dtm.log('assigning model "'+a.params.name+'" to category "'+a.params.categ+'"'),b.models[a.params.categ]=a,b.modDest.push(a)):d&&(dtm.log('assigning model "'+a.params.name+'" to category "'+d+'"'),b.models[d]=a,b.modDest.push(a)):"dtm.array"===a.type&&(b.models[d]=a);else if("string"==typeof a){var e=_.find(dtm.modelColl,{params:{name:a}});"undefined"!=typeof e&&(d||(d=e.params.categ),dtm.log('assigning model "'+e.params.name+'" to category "'+d+'"'),b.models[d]=e,b.modDest.push(e))}return c},c.map=function(a,d){return a.constructor===Array?b.models[d]=dtm.array(a).normalize():"dtm.array"===a.type?b.models[d]=a.normalize():"dtm.model"===a.type,c},c.play=function(){return b.isPlaying!==!0?(b.isPlaying=!0,dtm.log("playing instr: "+b.name),!b.instrModel,b.instrModel&&"instr"===b.instrModel.get("categ")&&b.instrModel.output&&b.clock.add(b.instrModel.output).start(),dtm.master.activeInstrs.push(c)):dtm.log("instrument "+b.name+" is already playing!"),c},c.start=c.print=c.run=c.play,c.stop=function(){return b.isPlaying===!0&&(b.isPlaying=!1,dtm.log("stopping: "+b.name),b.instrModel&&"instr"===b.instrModel.params.categ&&b.instrModel.stop(),b.clock.stop(),b.clock.clear(),b.callbacks=[]),c},c.mod=function(a,b,d){var e="";return"string"==typeof a?e=a:"number"==typeof a&&(e=c.params[a]),c[e](b,d),c},c.modulate=c.mod,c.load=function(a){var d;return"string"==typeof a?d=dtm.modelCallers[a]():"dtm.model"===a.type&&(d=a),"undefined"!=typeof d&&(d.parent=c,d.map(c),b.instrModel=d),c},a=a||"default",c.load(a),c},dtm.i=dtm.instrument=dtm.instr,dtm.voice=dtm.instr,dtm.model=function(a,b){var c={name:null,categ:"none",categories:[],output:null},d={type:"dtm.model",parent:{},mod:{},param:{},params:{},models:{},modes:{literal:["literal","lit","l"],adapt:["adapt","adapted","adaptive","a"],preserve:["preserve","preserved","p"]}};return d.get=function(a){switch(a){case"name":return c.name;case"category":case"categ":return c.categ;default:return c.output}},d.set=function(a,b){return c.value=b,d},d.categ=function(a){return c.categ=a,d},d.load=function(a){if("string"==typeof a){var e=_.find(dtm.modelColl,{params:{name:a}});"undefined"!=typeof e?(dtm.log("overriding an existing model: "+a),d=e):("string"==typeof b&&(c.categ=b),dtm.log("registering a new model: "+a),c.name=a,dtm.modelColl.push(d))}return d},d.start=function(){return d},d.stop=function(){return d},d.morphArrays=function(){return d},d.clone=function(){return clone(d)},d.assignMethods=function(a){return _.forEach(d.mod,function(b,c){a[c]=b,a.params.push(c)}),_.forEach(d.param,function(b,c){a[c]=b,a.params.push(c)}),d},d.map=d.assignMethods,d.register=function(){return dtm.modelCallers[d.get("name")]=arguments.callee.caller,d},d.load(a),d},dtm.m=dtm.model,dtm.synth=function(a,b){var c={type:"sine",note:{delay:0,duration:1},output:{gain:.5},buffer:null,amp:{gain:.5,adsr:[.001,.2,0,.001]},pitch:{freq:440,noteNum:69},wt:{isOn:!1,wt:null},lpf:{isOn:!1,cof:4e3,res:1},detune:{isOn:!1,amount:0,spread:0},delay:{isOn:!1,amount:0,time:.3,sync:!1,note:6,feedback:.3,stereo:!1},verb:{isOn:!1,amount:0},comb:{isOn:!1,amount:0,nn:69}},d=null;dtm.wa.isOn&&(d=dtm.wa.makeNoise(8192));var e={type:"dtm.synth",promise:null};return e.get=function(a){var b=null;switch(a){case"amp":b=c.amp.gain;break;case"volume":case"gain":b=c.output.gain;break;case"frequency":case"freq":case"cps":b=c.pitch.freq;break;case"noteNum":case"notenum":case"note":case"nn":b=c.pitch.noteNum;break;case"buffer":b=c.buffer}return b},e.set=function(a){switch(a){case"sin":case"sine":c.type="sine";break;case"saw":case"sawtooth":c.type="saw";break;case"sq":case"square":c.type="square";break;case"tri":case"triangle":c.type="triangle";break;case"wn":case"noise":case"rand":case"random":c.type="noise";break;case"click":case"impulse":c.type="click";break;case"wt":case"wavetable":c.type="wavetable",e.wt(arguments[1]);break;case"sampler":c.type="sampler"}return e},e.wt=function(a){c.wt.isOn=!0,"undefined"==typeof a&&(a=[0]);for(var b=[0,1],d=0;d<a.length;d++)b.push(a[d]);var f=new Float32Array(b),g=f;return c.wt.wt=dtm.wa.actx.createPeriodicWave(f,g),e},e.adsr=function(){return"undefeined"!=typeof arguments&&(c.amp.adsr[0]=arguments[0]||.001,c.amp.adsr[1]=arguments[1]||.001,c.amp.adsr[2]=arguments[2],c.amp.adsr[3]=arguments[3]||.001),e},e.load=function(a,b){var d=dtm.wa.actx;if(c.type="sampler","AudioBuffer"===a.constructor.name)return c.buffer=a,e;var f=new Promise(function(f){if("string"==typeof a){var g=new XMLHttpRequest;g.open("GET",a,!0),g.responseType="arraybuffer",g.onreadystatechange=function(){4==g.readyState&&200==g.status&&d.decodeAudioData(g.response,function(a){c.buffer=a,f(e),"undefined"!=typeof b&&b(a)})},g.send()}else if("ArrayBuffer"===a.constructor.name)d.decodeAudioData(a,function(a){c.buffer=a,f(e),"undefined"!=typeof b&&b(e)});else if(a.constructor===Array){var h=d.createBuffer(1,a.length,dtm.wa.actx.sampleRate),i=h.getChannelData(0);_.forEach(i,function(b,c){i[c]=a[c]}),c.buffer=h,f(e),"undefined"!=typeof b&&b(e)}});return f.play=function(){f.then(function(a){a.play()})},e.promise=f,f},e.play=function(a,b){var f=dtm.wa.actx,g=dtm.wa.now,h=dtm.wa.out;a=a||0,b=b||c.note.duration;var i,j=g()+a;if("noise"===c.type)i=f.createBufferSource(),d||(d=dtm.wa.makeNoise(8192)),i.buffer=d,i.loop=!0;else if("sampler"===c.type)i=f.createBufferSource(),i.buffer=c.buffer,i.playbackRate=1,i.loop=!1;else if("click"===c.type){i=f.createBufferSource();var k=f.createBuffer(1,2,dtm.sr),l=k.getChannelData(0);l[1]=1,i.buffer=k,i.playbackRate=1,i.loop=!1}else i=f.createOscillator(),i.frequency.setValueAtTime(c.pitch.freq,j);switch(c.type){case"sine":i.type="sine";break;case"saw":i.type="sawtooth";break;case"square":i.type="square";break;case"triange":i.type="triangle"}c.wt.isOn&&i.setPeriodicWave(c.wt.wt);var m=f.createGain();if(c.lpf.isOn){var n=f.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(c.lpf.cof,j),n.Q.setValueAtTime(c.lpf.res,j),i.connect(n),n.connect(m)}else i.connect(m);if(c.comb.isOn){var o=f.createDelay();o.delayTime.setValueAtTime(1/dtm.val.mtof(c.comb.nn),j);var p=f.createGain();p.gain.setValueAtTime(c.comb.amount,j);var q=f.createGain();q.gain.setValueAtTime(.95,j),m.connect(o),o.connect(p),o.connect(q),q.connect(o),p.connect(h())}if(c.delay.isOn){var r=f.createDelay();r.delayTime.setValueAtTime(c.delay.time,j);var s=f.createGain();s.gain.setValueAtTime(c.delay.amount,j);var t=f.createGain();t.gain.setValueAtTime(c.delay.feedback,j),m.connect(r),r.connect(s),r.connect(t),t.connect(r),s.connect(h())}if(c.verb.isOn){var u=f.createConvolver();u.buffer=dtm.wa.buffs.verbIr;var v=f.createGain();v.gain.setValueAtTime(c.verb.amount,j),m.connect(u),u.connect(v),v.connect(h())}var w=f.createGain();w.gain.setValueAtTime(c.output.gain,j),m.connect(w),w.connect(h());var x=c.amp.adsr[2]*c.amp.gain;m.gain.setValueAtTime(0,g()),m.gain.setTargetAtTime(c.amp.gain,j,c.amp.adsr[0]),m.gain.setTargetAtTime(x,j+c.amp.adsr[0],c.amp.adsr[1]);var y=j+c.amp.adsr[0]+c.amp.adsr[1]+b;return m.gain.setTargetAtTime(0,y,c.amp.adsr[3]),i.start(j),i.stop(y+c.amp.adsr[3]+.3),e},e.run=function(){return e},e.stop=function(a){return a=a||0,e},e.nn=function(a){return a=a||69,c.pitch.noteNum=a,c.pitch.freq=dtm.value.mtof(a),e},e.freq=function(a){return c.pitch.freq=a,e},e.amp=function(a){return c.amp.gain=a,e},e.dur=function(a){return c.note.duration=a,e},e.attr=function(a){var b=_.keys(a);return _.forEach(b,function(b){"undefined"!=typeof e[b]&&(e[b]=a[b])}),e},e.attack=function(a){return c.amp.adsr[0]=a,e},e.decay=function(a){return c.amp.adsr[1]=a,e},e.sustain=function(a){return c.amp.adsr[2]=a,e},e.release=function(a){return c.amp.adsr[3]=a,e},e.atk=e.attack,e.dcy=e.decay,e.sus=e.sustain,e.rel=e.release,e.lpf=function(a,b){return c.lpf.isOn=!0,c.lpf.cof=a||4e3,c.lpf.res=b||1,e},e.verb=function(a){return c.verb.isOn=!0,c.verb.amount=a,e},e.reverb=e.verb,e.delay=function(a,b,d,f){return c.delay.isOn=!0,c.delay.amount=a||0,c.delay.time=b||.3,c.delay.feedback=d||.3,c.delay.stereo=f||!1,e},e.comb=function(a,b){return c.comb.isOn=!0,c.comb.amount=a||0,c.comb.nn=b||69,e},e.set(a,b),e},dtm.s=dtm.syn=dtm.synth,dtm.stream=function(){var a={type:"dtm.stream"};return a.query=function(a,b){ajaxGet(a,function(a){b(),console.log(a)})},a.connect=function(){return a},a.disconnect=function(){return a},a},dtm.str=dtm.stream,dtm.master={type:"dtm.master",params:{data:null,index:0,level:.5,mute:!1,tempo:120,time:[4,4],beat:0,measure:0,section:0,scale:[0,1,2,3,4,5,6,7,8,9,10,11],cummulatedRhythm:null,transposition:0,chord:null,tonalFunc:null,numSynthVoices:0},totalComplexity:0,complexityLimit:10,numActiveModels:0,activeInstrs:[],voices:[],numVoices:0,models:[],clock:dtm.clock(120,480).sync(!1),start:function(){return dtm.master},stop:function(){_.forEach(dtm.clocks,function(a){a.stop(),a.clear()}),_.forEach(dtm.master.activeInstrs,function(a){a.stop()}),dtm.clocks=[],dtm.master.voices=[],dtm.master.activeInstrs=[]},transpose:function(a){return dtm.master.transposition=a,dtm.master},pq:function(){var a;return a=0===arguments.length?_.range(12):"array"==typeof arguments[0]?arguments[0]:"string"==typeof arguments[0]?dtm.scales[arguments[0].toLowerCase()]:arguments,dtm.master.scale=a,dtm.master},data:function(a){return"undefined"!=typeof a&&(dtm.master.params.data=a),dtm.master},form:function(){},model:function(){return dtm.master},get:function(a){switch(a){case"index":return dtm.master.params.index;case"clock":return dtm.master.clock;default:return null}},set:function(){return dtm.master},state:null,reset:null},dtm.master.clock.setMaster(!0),dtm.master.clock.start(),dtm.guido={pitchClass:{"-1":"_",r:"_",0:"c",1:"d&",2:"d",3:"e&",4:"e",5:"f",6:"f#",7:"g",8:"a&",9:"a",10:"b&",11:"b"},diatonic:{c:0,d:2,e:4,f:5,g:7,a:9,b:11,_:null},nnToPitch:function(a){var b=dtm.guido.pitchClass[dtm.val.mod(a,12)],c=(a-dtm.val.mod(a,12))/12-4;return b+c.toString()},pitchToNn:function(a){var b=a.split(""),c=0,d=0,e=dtm.guido.diatonic[b[0]];return 2===b.length?d=12*(parseInt(b[1])+4):b.length>2&&("#"==b[1]?c=1:"&"==b[1]&&(c=-1),3===b.length?d="-"==b[1]?12*(parseInt(b[1]+b[2])+4):12*(parseInt(b[2])+4):4===b.length&&(d=12*(parseInt(b[2]+b[3])+4))),e+c+d}},dtm.inscore=function(){var a={type:"dtm.inscore",oscPort:{}};return a.setup=function(){return a.oscPort=new osc.WebSocketPort({url:"ws://localhost:8081"}),a.oscPort.open(),a},a.test=function(b){for(var c=[],d=[],e=0;e<b.length;e++){if(0===dtm.value.mod(e,2)){var f,g;f=b[e]}else switch(g=b[e],d=[f,g].join(", ")){case"1, 0":c.push("a/4");break;case"1, 1":c.push("a/8"),c.push("a/8");break;case"0, 0":c.push("_/4");break;case"0, 1":c.push("_/8"),c.push("a/8")}}return c=c.join(" "),a.oscPort.send({address:"/ITL/scene/score",args:["write",c]}),a},a.write=function(b){return a.oscPort.send({address:"/ITL/scene/score",args:["write",b]}),a},a},function(){function a(a,b){"number"==typeof a?c.modules[b]=dtm.array(a):"string"==typeof a?c.modules[b]=dtm.array("str",a).classify():a.constructor===Array?c.modules[b]=dtm.array(a):"dtm.array"===a.type?c.modules[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(c.modules[b]=a)}var b=dtm.model("clave","instr").register(),c={modules:{voice:dtm.synth(),base:dtm.array([3,3,4,2,4]).itob(),target:dtm.array([2,1,2,1]).itob(),res:dtm.array([3,3,4,2,4]).itob(),morph:dtm.array(0)}};return b.output=function(a){a.div(16);var b=c.modules.voice,d=(c.modules.morph.get("next"),c.modules.res.get("next"));d&&b.play()},b.mod.morph=function(d,e){a(d,"morph"),b.modes.literal.indexOf(e)>-1||(b.modes.preserve.indexOf(e)>-1?c.modules.morph.normalize(0,1):c.modules.morph.normalize())},b.mod.target=function(c,d){a(c,"target"),b.modes.literal.indexOf(d)>-1||b.modes.preserve.indexOf(d)>-1},b}(),function(){function a(a,b){"number"==typeof a?c.modules[b]=dtm.array(a):"string"==typeof a?c.modules[b]=dtm.array("str",a).classify():a.constructor===Array?c.modules[b]=dtm.array(a):"dtm.array"===a.type?c.modules[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(c.modules[b]=a)}var b=dtm.model("default","instr").register(),c={clock:dtm.clock(!0,8),sync:!0,callbacks:[],modules:{voice:dtm.synth(),wavetable:null,volume:dtm.array(1),scale:dtm.array().fill("seq",12),rhythm:dtm.array(1),pitch:dtm.array(69),transp:dtm.array(0),chord:dtm.array(0),bpm:dtm.array(120),subdiv:dtm.array(8),repeats:null,step:null,atk:null,dur:dtm.array(.25),lpf:null,res:dtm.array(0),comb:null,delay:null},pqRound:!1};return b.output=function(a){var b=c.modules.voice,d=c.modules.volume.get("next"),e=c.modules.dur.get("next"),f=c.modules.rhythm.get("next"),g=c.modules.pitch.get("next"),h=c.modules.scale.get(),i=c.modules.transp.get("next"),j=c.modules.chord.get(),k=c.modules.subdiv.get("next");a.subDiv(k);var l=c.modules.wavetable,m=c.modules.lpf,n=c.modules.comb,o=c.modules.delay;c.sync===!1&&a.bpm(c.modules.bpm.get("next")),_.forEach(c.callbacks,function(a){a(c.clock)}),f&&_.forEach(j,function(a){l&&b.wt(l.get()),m&&b.lpf(m.get("next"),c.modules.res.get("next")),n&&b.comb(.5,c.modules.comb.get("next")),o&&b.delay(c.modules.delay.get("next")),b.dur(e).decay(e),b.nn(dtm.val.pq(g+a,h,c.pqRound)+i).amp(d).play()})},b.param.voice=function(a){return"string"==typeof a?c.modules.voice.set(a):"dtm.synth"===a.type&&(c.modules.voice=a),b.parent},b.mod.syn=b.mod.synth=b.mod.voice,b.mod.wt=function(d,e){return a(d,"wavetable"),b.modes.literal.indexOf(e)>-1||(b.modes.preserve.indexOf(e)>-1?c.modules.wavetable.range(0,1,0,1):c.modules.wavetable.normalize()),b.parent},b.mod.wf=b.mod.wavetable=b.mod.wt,b.mod.at=function(c){return a(c,"at"),b.parent},b.mod.rhythm=function(d,e){return a(d,"rhythm"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.rhythm.normalize().round(),b.parent},b.mod.beats=b.mod.rhythm,b.mod.volume=function(d,e){return a(d,"volume"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.volume.logCurve(5,0,1).rescale(.1,1),b.parent},b.mod.amp=b.mod.level=b.mod.vol=b.mod.volume,b.mod.pitch=function(d,e,f){return a(d,"pitch"),b.modes.literal.indexOf(e)>-1||(b.modes.preserve.indexOf(e)>-1?c.modules.pitch.rescale(60,90,0,1):c.modules.pitch.rescale(60,90)),f&&c.modules.pitch.round(),b.parent},b.mod.nn=b.mod.noteNum=b.mod.pitch,b.mod.transpose=function(d,e,f){return a(d,"transp"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.transp.normalize().scale(-12,12),f&&c.modules.transp.round(),b.parent},b.mod.tr=b.mod.transp=b.mod.transpose,b.mod.scale=function(d,e,f){return c.pqRound="undefined"==typeof f?!1:f,a(d,"scale"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.scale.normalize().scale(0,11).round().unique().sort(),b.parent},b.mod.pq=b.mod.scale,b.mod.chord=function(d,e){return a(d,"chord"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||(c.modules.chord.normalize().scale(0,12).round().unique().sort(),c.modules.chord.get("len")>4&&c.modules.chord.fit(4).round().unique().sort()),b.parent},b.param.clock=function(a,c){return b.parent.get("clock").bpm(a),b.parent.get("clock").subDiv(c),b.parent},b.mod.bpm=function(d,e){return c.sync=!1,a(d,"bpm"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.bpm.normalize().scale(60,180),b.parent},b.mod.tempo=b.mod.bpm,b.mod.subDiv=function(d,e){return a(d,"subdiv"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.subdiv.normalize().scale(1,5).round().powof(2),b.parent},b.mod.len=b.mod.note=b.mod.div=b.mod.subdiv=b.mod.subDiv,b.param.sync=function(a){return"undefined"==typeof a&&(a=!0),c.clock.sync(a),c.sync=a,b.parent},b.mod.lpf=function(d,e){return a(d,"lpf"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.lpf.normalize().exp(3,0,1).scale(500,5e3),b.parent},b.mod.res=function(d,e){return a(d,"res"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.res.normalize().scale(0,50),b.parent},b.mod.comb=function(d,e){return a("comb",d),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.comb.normalize().rescale(60,90),b.parent},b.mod.delay=function(d,e){return a(d,"delay"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.delay.normalize(),b.parent},b.mod.dur=function(d,e){return a(d,"dur"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.dur.normalize().exp(10,0,1).scale(.01,.5),b.parent},b.mod.on=function(a){switch(a){case"note":c.callbacks.push(arguments[1]);break;case"every":case"beat":var d=arguments[1],e=arguments[2];c.callbacks.push(function(a){a.get("beat")%d===0&&e(a)});break;case"subDiv":case"subdiv":case"div":}return b.parent},b.mod.when=b.mod.on,b}(),function(){var a=dtm.model("testInstr","instr").register();return a.mod.doThis=function(){return console.log("doing this"),a.parent},a.mod.testSetter=function(b,c){return console.log("testing"),"undefined"==typeof c&&(c=!0),a.parent},a}(),function(){function a(a,c){"number"==typeof c?b.modules[a]=dtm.array(c):"string"==typeof c?b.modules[a]=dtm.array(c).classify():c.constructor===Array?b.modules[a]=dtm.array(c):"dtm.array"===c.type?b.modules[a]="string"===c.get("type")?c.clone().classify():c.clone():"dtm.model"===c.type||"dtm.synth"===c.type&&(b.modules[a]=c)}var b={clock:dtm.clock(!0,16),sync:!0,callbacks:[],measures:4,time:"4/4",modules:{voice:dtm.synth(),wavetable:null,volume:dtm.array(1),scale:dtm.array().fill("seq",12),rhythm:dtm.array(1),pitch:dtm.array().fill("line",8,60,72).round(),transp:dtm.array(0),chord:dtm.array(0),repeats:null,step:null,dur:dtm.array().fill("consts",8,16),bpm:dtm.array(120),subdiv:dtm.array(16)}},c=dtm.model("testNotation","instr").register(),d=dtm.guido,e=dtm.osc;return c.output=function(){e.start();for(var a=b.time.split("/"),f=(a[0]/a[1]*b.measures,[]),g=[],h=[],i=b.modules.subdiv.get(),j=b.modules.pitch.get(),k=b.modules.dur.get(),l=0;8>l;l++)g[l]=d.pitchClass[dtm.val.mod(j[l],12)],h[l]=(j[l]-dtm.val.mod(j[l],12))/12-4,f[l]=g[l]+h[l].toString()+"*"+k[l]+"/"+i[0];return f=f.join(" "),e.send('[\\instr<"Flute", dx=-1.65cm, dy=-0.5cm>\\meter<"4/4"> \\clef<"f"> '+f+"]"),c.parent},c.param.measures=function(a){return b.measures=a,c.parent},c.mod.pitch=function(d,e){return a("pitch",d),e?b.modules.pitch.round():b.modules.pitch.normalize().rescale(60,90).round(),c.parent},c.mod.subDiv=function(d,e){return a("subdiv",d),e?b.modules.subdiv.round():b.modules.subdiv.normalize().scale(1,5).round().powof(2),c.parent},c.mod.dur=function(d,e){return a("dur",d),e?b.modules.dur.round():(b.modules.dur.normalize(),b.modules.dur.mult(b.measures*b.modules.subdiv.get(0)/b.modules.dur.get("sum")).round()),c.parent},c.mod.len=c.mod.note=c.mod.div=c.mod.subdiv=c.mod.subDiv,c}(),function(){function a(a,b){"number"==typeof a?e[b]=dtm.array(a):"string"==typeof a?e[b]=dtm.array("str",a).classify():a.constructor===Array?e[b]=dtm.array(a):"dtm.array"===a.type?e[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(e[b]=a)}function b(a,b,c){for(var d=0;d<a.length;d++)if(a[d].indexOf("*")>-1&&-1===a[d].indexOf("_")){var e=dtm.guido.pitchToNn(a[d].split("*")[0]);a[d]="{"+a[d];for(var f=0;f<b.length;f++)if(0!==b[f]){var g=e+b[f];c&&(g=dtm.val.pq(g,c,!0)),a[d]+=", ",a[d]+=dtm.guido.nnToPitch(g)}a[d]+="}"}return a}var c=dtm.model("decatur","instr").register(),d={name:"Flute",score:!0,midi:!0,staves:1,clef:"g",durFx:["rest","stacc","half","normal","tenuto","slur"],dynFx:["pp","p","mp","mf","f","ff"],bpm:dtm.master.clock.get("bpm"),voice:"mono",measures:4,time:"4/4",div:16,update:1,repeat:2,repMap:[2,3,3,3,4,5,5,6,6,6,7,7,8,9],divMap:[16,8,16,8,16],range:{Flute:[60,75,91],Cello:[36,48,72],Piano:[60,72,84],PianoL:[36,48,60],Pad:[36,54,72],Bass:[48,54,60]},scale:[[0,2,7,9],[2,5,7],[0,2,5,7,10],[0,2,5,7],[0,2,4,7,9],[0,2,4,6,7],[2,4,6,7,9]],celloFx:["arc","pizz"],callbacks:[]},e={pitch:dtm.array().fill("random",8,60,72).round(),range:dtm.array(.3),scale:dtm.array(d.scale[d.scale.length-1]),scaleSel:dtm.array(2),transp:dtm.array(0),chord:dtm.array(0),pos:dtm.array(0),div:dtm.a(Math.round(d.divMap.length/2)),repeat:dtm.array(1),note:dtm.array().fill("ones",8),dur:dtm.array().fill("ones",8),dyn:dtm.array().fill("zeros",8),activity:dtm.array(0)},f=(dtm.guido,dtm.osc);return c.output=function(a){a.div(d.div);var g=d.repeat,h=d.div*d.measures;a.get("beat")%(h*d.update)===0&&_.forEach(d.callbacks,function(b){b(a)});var i=e.scale.get(),j=e.chord.get(),k=Math.round(h/g),l=e.pitch.clone().fit(k,"linear").log(10).round(),m=e.note.clone().scale(.1,1).fit(k,"linear").fitSum(k,!0),n=e.activity.clone().fit(k,"linear").round(),o=e.transp.clone().fit(k,"linear").round();if(d.score&&("Flute"===d.name||"Piano"===d.name||"PianoL"===d.name||"Cello"===d.name)&&a.get("beat")%(h*d.update)===0){var p,q,r=[],s=!1,t=0,u=0,v=!1,w=e.dur.clone().fit(k,"step").scale(0,5).round(),x=e.dyn.clone().fit(k,"step");d.durFx[2]=d.div<=16?"stacc":"half";for(var y=0;h>y;y++){r[y]="";var z=l.get("next"),A=m.get("next"),B=w.get("next"),C=(x.get("current"),x.get("next"),n.get("next")),D=o.get("next");A>1&&A+t%4>4&&(v=!0,q=(A+t)%4,0==q&&(q=4),p=A-q),t+=A,y==h-1&&(u=h-t,v?q+=u:A+=u),0==q&&(A=p,v=!1);var E="";E+=dtm.guido.nnToPitch(dtm.val.pq(z+D,i,!0)),("rest"==d.durFx[B]||0===C)&&(E="_",s&&(r[y-1]+=" \\slurEnd",s=!1)),"slur"==d.durFx[B]&&0!==C&&(s||y===h-1||(r[y]+="\\slurBegin ",s=!0)),"half"==d.durFx[B]&&0!==C?v?(r[y]+=E+"*"+p+"/"+2*d.div+"_*"+p+"/"+2*d.div,r[y]+=",",r[y]+=E+"*"+q+"/"+2*d.div+"_*"+q+"/"+2*d.div):0!==A&&(r[y]+=E+"*"+A+"/"+2*d.div+"_*"+A+"/"+2*d.div):v&&"rest"!=d.durFx[B]&&0!==C?(r[y]+="\\tieBegin \\space<4> "+E+"*"+p+"/"+d.div,r[y]+=" , ",r[y]+=E+"*"+q+"/"+d.div+" \\tieEnd"):0!==A&&(r[y]+=E+"*"+A+"/"+d.div),0!==C&&!s&&d.div>=4&&""!=r[y]&&"PianoL"!==d.name&&("stacc"==d.durFx[B]?r[y]="\\stacc( "+r[y]+" )":"tenuto"==d.durFx[B]&&(r[y]="\\ten( "+r[y]+" )")),"rest"!==d.durFx[B]&&"stacc"!==d.durFx[B]&&"tenuto"!==d.durFx[B]&&2===C&&1===j.length&&""!=r[y]&&"PianoL"!==d.name&&(r[y]="\\accent( "+r[y]+" )"),("slur"!=d.durFx[B]&&s||y==h-1&&s)&&(r[y]+=" \\slurEnd",s=!1),v=!1}for(var y=r.length-1;y>=0;y--)""===r[y]&&r.splice(y,1);for(var y=r.length-1;y>0;y--)r[y].indexOf("_")>-1&&r[y-1].indexOf("_")>-1&&(r[y-1]="_*"+(parseInt(r[y].substr(r[y].indexOf("*")+1,r[y].indexOf("/")-r[y].indexOf("*")-1))+parseInt(r[y-1].substr(r[y-1].indexOf("*")+1,r[y-1].indexOf("/")-r[y-1].indexOf("*")-1)))+"/"+d.div,r[y]="");for(var y=0;y<r.length;y++)if(r[y].indexOf(",")>-1){var F=r[y].split(",");r[y]=F[0],r.splice(y+1,0,F[1])}for(var y=r.length-1;y>0;y--)""===r[y]&&r.splice(y,1);for(var y=0;y<r.length;y++)if(r[y].indexOf(" ")>-1)for(var F=r[y].split(" "),G=0;G<F.length-1;G++)r[y+G]=F[G],r.splice(y+1+G,0,F[G+1]);e.chord.get("len")>1&&(r=b(r,j,i));var H='\\staffFormat<"5-line",';H+=1===r.length?"size=1.3pt>":r.length<50?"size=1.3pt>":r.length<100?"size=2pt>":"size=3pt>";var I="\\staff<";switch(d.name){case"Flute":I+="1";break;case"Cello":I+="2";break;case"Piano":I+="3";break;case"PianoL":I+="4"}if(1===r.length)I+=",5mm>";else switch(d.name){case"Flute":I+=",14mm>";break;case"Cello":I+=",14mm>";break;case"Piano":I+=",10mm>";break;case"PianoL":I+=",10mm>"}r=r.join(" ");var J="";"Flute"===d.name||"Cello"===d.name?J+='\\instr<"'+d.name+'", dx=-1.65cm, dy=-0.5cm>':"Piano"===d.name&&(J+='\\instr<"'+d.name+'", dx=-1.65cm, dy=-1.3cm>');var K='\\clef<"'+d.clef+'">';"PianoL"===d.name&&(K="");var L='\\meter<"'+d.time+'">',M="",N="";"Flute"===d.name&&(M='\\set<autoSystemBreak="off">',N="\\pageFormat<30cm, 10cm, 2cm, 5cm, 2cm, 5cm>"),f.send("/decatur/score",[d.name,"["+N+M+J+K+L+r+" \\space<6> \\repeatEnd]"])}if(d.midi&&a.get("beat")%(h*d.update)===0){d.bpm=dtm.master.clock.get("bpm");for(var O=[],P=60/d.bpm*4/d.div,B=e.dur.clone().fit(k,"step").scale(0,5).round().normalize(),Q=0,G=0;G<d.update;G++){l.index(k-1),m.index(k-1),B.index(k-1),n.index(k-1),Q=h*G;for(var y=0;h>y;y++){var R=m.get("next"),z=l.get("next"),S=B.get("next"),C=n.get("next"),D=o.get("next");if(0!==R){if(0!==S&&0!==C){var T=Q*P+dtm.val.rand(0,.01),U=R*S*P*.95;if(e.chord.get("len")>1)for(var V=0;V<j.length;V++){var W=dtm.val.pq(z+D,i,!0);O.push([T,U,dtm.val.pq(W+j[V],i,!0)])}else O.push([T,U,dtm.val.pq(z+D,i,!0)])}Q+=R}}}for(var y=0;y<O.length;y++)"undefined"!=typeof O[y]&&dtm.osc.send("/decatur/midi",[d.name].concat(O[y]))}return c.parent},c.param.get=function(a){switch(a){case"score":break;case"midi":break;case"a":case"array":return e[arguments[1]]}return c.parent},c.param.score=function(a){return d.score=a,c.parent},c.param.midi=function(a){return d.midi=a,c.parent},c.param.name=function(a){switch(d.name=a,d.name){case"Flute":d.clef="g";break;case"Cello":d.clef="f";break;case"Piano":d.clef="g";break;case"PianoL":d.clef="f"}return c.parent},c.param.measures=function(a){return d.measures=a,c.parent},c.param.update=function(a){return d.update=a,c.parent},c.param.clef=function(a){return d.clef=a,c.parent},c.param.staves=function(a){return d.staves=a,c.parent},c.param.onUpdate=function(a){return d.callbacks.push(a),c.parent},c.mod.pitch=function(b,f){return a(b,"pitch"),c.modes.literal.indexOf(f)>-1?e.pitch.round():c.modes.preserve.indexOf(f)>-1?"Flute"===d.name?e.pitch.rescale(60,96,0,1).round():"Cello"===d.name?e.pitch.rescale(36,72,0,1).round():"Piano"===d.name?e.pitch.rescale(60,84,0,1).round():"PianoL"===d.name?e.pitch.rescale(36,60,0,1).round():"Bass"===d.name?e.pitch.rescale(48,65,0,1).round():e.pitch.rescale(60,96,0,1).round():"Flute"===d.name?e.pitch.rescale(60,96).round():"Cello"===d.name?e.pitch.rescale(36,72).round():"Piano"===d.name?e.pitch.rescale(60,84).round():"PianoL"===d.name?e.pitch.rescale(36,60).round():"Bass"===d.name?e.pitch.rescale(48,65).round():e.pitch.rescale(60,96).round(),c.parent},c.mod.range=function(b,d){return a(b,"range"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1||e.range.exp(2,0,1).scale(.2,.8),c.parent},c.mod.transpose=function(b,d){return a(b,"transp"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1,c.parent},c.mod.tr=c.mod.transp=c.mod.transpose,c.mod.scale=function(b,f){return c.modes.literal.indexOf(f)>-1?a(b,"scale"):c.modes.preserve.indexOf(f)>-1?(a(b,"scaleSel"),e.scaleSel.rescale(0,d.scale.length-1,0,1).round(),e.scale.set(d.scale[e.scaleSel.get("mode")])):(a(b,"scaleSel"),e.scaleSel.rescale(0,d.scale.length-1).round(),e.scale.set(d.scale[e.scaleSel.get("mode")])),c.parent},c.mod.chord=function(b,d){return a(b,"chord"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1,c.parent},c.mod.pq=c.mod.scale,c.mod.div=function(b,f){return a(b,"div"),c.modes.literal.indexOf(f)>-1?d.div=e.div.round().get("mode"):c.modes.preserve.indexOf(f)>-1||(e.div.range(0,d.divMap.length-1).round(),d.div=d.divMap[e.div.get("mode")]),c.parent},c.mod.activity=function(b,d){return a(b,"activity"),c.modes.literal.indexOf(d)>-1||(c.modes.preserve.indexOf(d)>-1?e.activity.scale(0,2,0,1).round():e.activity.scale(0,2).round()),c.parent},c.mod.ac=c.mod.activity,c.mod.note=function(b,d){return a(b,"note"),c.modes.literal.indexOf(d)>-1?e.note.round():c.modes.preserve.indexOf(d)>-1,c.parent},c.mod.dur=function(b,d){return a(b,"dur"),c.modes.literal.indexOf(d)>-1||(c.modes.preserve.indexOf(d)>-1?e.dur.normalize(0,1):e.dur.normalize()),c.parent},c.mod.dyn=function(b,d){return a(b,"dyn"),c.modes.literal.indexOf(d)>-1||(c.modes.preserve.indexOf(d)>-1?e.dyn.scale(0,5,0,1).round():e.dyn.scale(0,5).round()),c.parent},c.mod.density=function(b,d){return a(b,"density"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1||e.density.scale(1,32).exp(5,0,1),c.parent},c.mod.repeat=function(b,f){return a(b,"repeat"),c.modes.literal.indexOf(f)>-1?d.repeat=b:c.modes.preserve.indexOf(f)>-1?(e.repeat.rescale(0,d.repMap.length-1,0,1).round(),d.repeat=d.repMap[e.repeat.get("mode")]):(e.repeat.rescale(0,d.repMap.length-1).round(),d.repeat=d.repMap[e.repeat.get("mode")]),c.parent},c.mod.rep=c.mod.repeat,c}(),function(){function a(a,b){"number"==typeof a?c[b]=dtm.array(a):"string"==typeof a?c[b]=dtm.array(a).classify():a.constructor===Array?c[b]=dtm.array(a):"dtm.array"===a.type?c[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(c[b]=a)}var b=dtm.model("csd","instr").register(),c={pitch:dtm.a(60),div:dtm.a(8)},d=null;return"undefined"!=typeof csound&&(d=csound),b.output=function(a){var e=c.pitch.get("next");return a.div(c.div.get("next")),d.Event("i1 0 0.2 "+e),b.parent},b.mod.pitch=function(d,e){return a(d,"pitch"),e||c.pitch.normalize().scale(60,90),b.parent},b.mod.div=function(d,e){return a(d,"div"),e||c.div.normalize().scale(0,5).round().powof(2),b.parent},b.mod.file=function(){return b.parent},b}(),function(){function a(a,c){"number"==typeof a?b.modules[c]=dtm.array(a):"string"==typeof a?b.modules[c]=dtm.array(a).classify():a.constructor===Array?b.modules[c]=dtm.array(a):"dtm.array"===a.type?b.modules[c]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(b.modules[c]=a)}var b=dtm.model("csd-osc","instr").register(),c={iNum:1};return b.modules={pitch:dtm.a(72),div:dtm.a(16)},b.output=function(a){var d=b.modules.pitch.get("next"),e=b.modules.div.get("next");a.div(e);var f=c.iNum;return f="number"==typeof f?"i".concat(f):'i\\"'+f+'\\"',dtm.osc.send("/csd/event",[f,0,.1,d]),b.parent},b.mod.pitch=function(c,d){return a(c,"pitch"),d||b.modules.pitch.normalize().rescale(60,90).round(),b.parent},b.mod.div=function(c,d){return a(c,"div"),d||b.modules.div.normalize().scale(1,5).round().powof(2),b.parent},b.param.name=function(a){return c.iNum=a,b.parent},b}()}();