(function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function b(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function c(a){return"\\"+vc[a]}function d(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function e(a){return a instanceof e?a:new f(a)}function f(a,b){this.__chain__=!!b,this.__wrapped__=a}function g(a){function b(){if(e){var a=d(e);Jc.apply(a,arguments)}if(this instanceof b){var g=h(c.prototype),i=c.apply(g,a||arguments);return J(i)?i:g}return c.apply(f,a||arguments)}var c=a[0],e=a[2],f=a[4];return b}function h(a){return J(a)?Lc(a):{}}function i(a,b,c){if("function"!=typeof a)return Sb;if("undefined"==typeof b||!("prototype"in a))return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Fb(a,b)}function j(a){function b(){var a=l?i:this;if(f){var q=d(f);Jc.apply(q,arguments)}if((g||n)&&(q||(q=d(arguments)),g&&Jc.apply(q,g),n&&q.length<k))return e|=16,j([c,o?e:-4&e,q,null,i,k]);if(q||(q=arguments),m&&(c=a[p]),this instanceof b){a=h(c.prototype);var r=c.apply(a,q);return J(r)?r:a}return c.apply(a,q)}var c=a[0],e=a[1],f=a[2],g=a[3],i=a[4],k=a[5],l=1&e,m=2&e,n=4&e,o=8&e,p=c;return b}function k(a,b){for(var c=-1,d=s(),e=a?a.length:0,f=[];++c<e;){var g=a[c];d(b,g)<0&&f.push(g)}return f}function l(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Uc(h)||v(h))){b||(h=l(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function m(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;var f=typeof a,g=typeof b;if(!(a!==a||a&&uc[f]||b&&uc[g]))return!1;if(null==a||null==b)return a===b;var h=Ec.call(a),i=Ec.call(b);if(h!=i)return!1;switch(h){case nc:case oc:return+a==+b;case qc:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case sc:case tc:return a==String(b)}var j=h==mc;if(!j){var k=a instanceof e,l=b instanceof e;if(k||l)return m(k?a.__wrapped__:a,l?b.__wrapped__:b,c,d);if(h!=rc)return!1;var n=a.constructor,o=b.constructor;if(n!=o&&!(I(n)&&n instanceof n&&I(o)&&o instanceof o)&&"constructor"in a&&"constructor"in b)return!1}c||(c=[]),d||(d=[]);for(var p=c.length;p--;)if(c[p]==a)return d[p]==b;var q=!0,r=0;if(c.push(a),d.push(b),j){if(r=b.length,q=r==a.length)for(;r--&&(q=m(a[r],b[r],c,d)););}else _c(b,function(b,e,f){return Ic.call(f,e)?(r++,!(q=Ic.call(a,e)&&m(a[e],b,c,d))&&gc):void 0}),q&&_c(a,function(a,b,c){return Ic.call(c,b)?!(q=--r>-1)&&gc:void 0});return c.pop(),d.pop(),q}function n(a,b){return a+Hc(Sc()*(b-a+1))}function o(a,b,c){for(var d=-1,e=s(),f=a?a.length:0,g=[],h=c?[]:g;++d<f;){var i=a[d],j=c?c(i,d,a):i;(b?!d||h[h.length-1]!==j:e(h,j)<0)&&(c&&h.push(j),g.push(i))}return g}function p(a){return function(b,c,d){var e={};c=Qb(c,d,3);var f=-1,g=b?b.length:0;if("number"==typeof g)for(;++f<g;){var h=b[f];a(e,h,c(h,f,b),b)}else ad(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function q(a,b,c,d,e,f){var h=2&b,i=16&b,k=32&b;if(!h&&!I(a))throw new TypeError;i&&!c.length&&(b&=-17,i=c=!1),k&&!d.length&&(b&=-33,k=d=!1);var l=1==b||17===b?g:j;return l([a,b,c,d,e,f])}function r(a){return Xc[a]}function s(){var b=(b=e.indexOf)===rb?a:b;return b}function t(a){return"function"==typeof a&&Fc.test(a)}function u(a){return Yc[a]}function v(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ec.call(a)==lc||!1}function w(a){if(!a)return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(d)for(var e in d)a[e]=d[e]}return a}function x(a){return J(a)?Uc(a)?d(a):w({},a):a}function y(a){if(!a)return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(d)for(var e in d)"undefined"==typeof a[e]&&(a[e]=d[e])}return a}function z(a){var b=[];return _c(a,function(a,c){I(a)&&b.push(c)}),b.sort()}function A(a,b){return a?Ic.call(a,b):!1}function B(a){for(var b=-1,c=Wc(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function C(a){return a===!0||a===!1||a&&"object"==typeof a&&Ec.call(a)==nc||!1}function D(a){return a&&"object"==typeof a&&Ec.call(a)==oc||!1}function E(a){return a&&1===a.nodeType||!1}function F(a){if(!a)return!0;if(Uc(a)||O(a))return!a.length;for(var b in a)if(Ic.call(a,b))return!1;return!0}function G(a,b){return m(a,b)}function H(a){return Nc(a)&&!Oc(parseFloat(a))}function I(a){return"function"==typeof a}function J(a){return!(!a||!uc[typeof a])}function K(a){return M(a)&&a!=+a}function L(a){return null===a}function M(a){return"number"==typeof a||a&&"object"==typeof a&&Ec.call(a)==qc||!1}function N(a){return a&&uc[typeof a]&&Ec.call(a)==sc||!1}function O(a){return"string"==typeof a||a&&"object"==typeof a&&Ec.call(a)==tc||!1}function P(a){return"undefined"==typeof a}function Q(a){var b=[];_c(a,function(a,c){b.push(c)}),b=k(b,l(arguments,!0,!1,1));for(var c=-1,d=b.length,e={};++c<d;){var f=b[c];e[f]=a[f]}return e}function R(a){for(var b=-1,c=Wc(a),d=c.length,e=Array(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function S(a){for(var b=-1,c=l(arguments,!0,!1,1),d=c.length,e={};++b<d;){var f=c[b];f in a&&(e[f]=a[f])}return e}function T(a){for(var b=-1,c=Wc(a),d=c.length,e=Array(d);++b<d;)e[b]=a[c[b]];return e}function U(a,b){var c=s(),d=a?a.length:0,e=!1;return d&&"number"==typeof d?e=c(a,b)>-1:ad(a,function(a){return(e=a===b)&&gc}),e}function V(a,b,c){var d=!0;b=Qb(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&(d=!!b(a[e],e,a)););else ad(a,function(a,c,e){return!(d=!!b(a,c,e))&&gc});return d}function W(a,b,c){var d=[];b=Qb(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else ad(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function X(a,b,c){b=Qb(b,c,3);var d=-1,e=a?a.length:0;if("number"!=typeof e){var f;return ad(a,function(a,c,d){return b(a,c,d)?(f=a,gc):void 0}),f}for(;++d<e;){var g=a[d];if(b(g,d,a))return g}}function Y(a,b){return mb(a,b,!0)}function Z(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:i(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==gc;);else ad(a,b)}function $(a,b){var c=a?a.length:0;if("number"==typeof c)for(;c--&&b(a[c],c,a)!==!1;);else{var d=Wc(a);c=d.length,ad(a,function(a,e,f){return e=d?d[--c]:--c,b(f[e],e,f)===!1&&gc})}}function _(a,b){var c=d(arguments,2),e=-1,f="function"==typeof b,g=a?a.length:0,h=Array("number"==typeof g?g:0);return Z(a,function(a){h[++e]=(f?b:a[b]).apply(a,c)}),h}function ab(a,b,c){var d=-1,e=a?a.length:0;if(b=Qb(b,c,3),"number"==typeof e)for(var f=Array(e);++d<e;)f[d]=b(a[d],d,a);else f=[],ad(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function bb(a,b,c){var d=-1/0,e=d;"function"!=typeof b&&c&&c[b]===a&&(b=null);var f=-1,g=a?a.length:0;if(null==b&&"number"==typeof g)for(;++f<g;){var h=a[f];h>e&&(e=h)}else b=Qb(b,c,3),Z(a,function(a,c,f){var g=b(a,c,f);g>d&&(d=g,e=a)});return e}function cb(a,b,c){var d=1/0,e=d;"function"!=typeof b&&c&&c[b]===a&&(b=null);var f=-1,g=a?a.length:0;if(null==b&&"number"==typeof g)for(;++f<g;){var h=a[f];e>h&&(e=h)}else b=Qb(b,c,3),Z(a,function(a,c,f){var g=b(a,c,f);d>g&&(d=g,e=a)});return e}function db(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=Qb(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else ad(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function eb(a,b,c,d){var e=arguments.length<3;return b=Qb(b,d,4),$(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function fb(a,b,c){return b=Qb(b,c,3),W(a,function(a,c,d){return!b(a,c,d)})}function gb(a,b,c){if(a&&"number"!=typeof a.length&&(a=T(a)),null==b||c)return a?a[n(0,a.length-1)]:ec;var d=hb(a);return d.length=Rc(Qc(0,b),d.length),d}function hb(a){var b=-1,c=a?a.length:0,d=Array("number"==typeof c?c:0);return Z(a,function(a){var c=n(0,++b);d[b]=d[c],d[c]=a}),d}function ib(a){var b=a?a.length:0;return"number"==typeof b?b:Wc(a).length}function jb(a,b,c){var d;b=Qb(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&!(d=b(a[e],e,a)););else ad(a,function(a,c,e){return(d=b(a,c,e))&&gc});return!!d}function kb(a,c,d){var e=-1,f=a?a.length:0,g=Array("number"==typeof f?f:0);for(c=Qb(c,d,3),Z(a,function(a,b,d){g[++e]={criteria:[c(a,b,d)],index:e,value:a}}),f=g.length,g.sort(b);f--;)g[f]=g[f].value;return g}function lb(a){return Uc(a)?d(a):a&&"number"==typeof a.length?ab(a):T(a)}function mb(a,b,c){return c&&F(b)?ec:(c?X:W)(a,b)}function nb(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function ob(a){return k(a,l(arguments,!0,!0,1))}function pb(a,b,c){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=-1;for(b=Qb(b,c,3);++g<f&&b(a[g],g,a);)e++}else if(e=b,null==e||c)return a?a[0]:ec;return d(a,0,Rc(Qc(0,e),f))}function qb(a,b){return l(a,b)}function rb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Qc(0,e+d):d||0}else if(d){var f=yb(b,c);return b[f]===c?f:-1}return a(b,c,d)}function sb(a,b,c){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=Qb(b,c,3);g--&&b(a[g],g,a);)e++}else e=null==b||c?1:b||e;return d(a,0,Rc(Qc(0,f-e),f))}function tb(){for(var a=[],b=-1,c=arguments.length;++b<c;){var d=arguments[b];(Uc(d)||v(d))&&a.push(d)}var e=a[0],f=-1,g=s(),h=e?e.length:0,i=[];a:for(;++f<h;)if(d=e[f],g(i,d)<0){for(var b=c;--b;)if(g(a[b],d)<0)continue a;i.push(d)}return i}function ub(a,b,c){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=Qb(b,c,3);g--&&b(a[g],g,a);)e++}else if(e=b,null==e||c)return a?a[f-1]:ec;return d(a,Qc(0,f-e))}function vb(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Qc(0,d+c):Rc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wb(a,b,c){a=+a||0,c=+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Qc(0,Gc((b-a)/c)),f=Array(e);++d<e;)f[d]=a,a+=c;return f}function xb(a,b,c){if("number"!=typeof b&&null!=b){var e=0,f=-1,g=a?a.length:0;for(b=Qb(b,c,3);++f<g&&b(a[f],f,a);)e++}else e=null==b||c?1:Qc(0,b);return d(a,e)}function yb(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?Qb(c,d,1):Sb,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function zb(){return o(l(arguments,!0,!0))}function Ab(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=Qb(c,d,3)),o(a,b,c)}function Bb(a){return k(a,d(arguments,1))}function Cb(){for(var a=-1,b=bb(ed(arguments,"length")),c=Array(0>b?0:b);++a<b;)c[a]=ed(arguments,a);return c}function Db(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Uc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Eb(a,b){if(!I(b))throw new TypeError;return function(){return--a<1?b.apply(this,arguments):void 0}}function Fb(a,b){return arguments.length>2?q(a,17,d(arguments,2),null,b):q(a,1,null,null,b)}function Gb(a){for(var b=arguments.length>1?l(arguments,!0,!1,1):z(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=q(a[e],1,null,null,a)}return a}function Hb(){for(var a=arguments,b=a.length;b--;)if(!I(a[b]))throw new TypeError;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Ib(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!I(a))throw new TypeError;if(b=Qc(0,b)||0,c===!0){var n=!0;m=!1}else J(c)&&(n=c.leading,l="maxWait"in c&&(Qc(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(fd()-g);if(0>=c){e&&clearTimeout(e);var l=j;e=i=j=ec,l&&(k=fd(),f=a.apply(h,d),i||e||(d=h=null))}else i=setTimeout(o,c)},p=function(){i&&clearTimeout(i),e=i=j=ec,(m||l!==b)&&(k=fd(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=fd(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var q=l-(g-k),r=0>=q;r?(e&&(e=clearTimeout(e)),k=g,f=a.apply(h,d)):e||(e=setTimeout(p,q))}return r&&i?i=clearTimeout(i):i||b===l||(i=setTimeout(o,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Jb(a){if(!I(a))throw new TypeError;var b=d(arguments,1);return setTimeout(function(){a.apply(ec,b)},1)}function Kb(a,b){if(!I(a))throw new TypeError;var c=d(arguments,2);return setTimeout(function(){a.apply(ec,c)},b)}function Lb(a,b){var c={};return function(){var d=b?b.apply(this,arguments):hc+arguments[0];return Ic.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}}function Mb(a){var b,c;if(!I(a))throw new TypeError;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Nb(a){return q(a,16,d(arguments,1))}function Ob(a,b,c){var d=!0,e=!0;if(!I(a))throw new TypeError;return c===!1?d=!1:J(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),c={},c.leading=d,c.maxWait=b,c.trailing=e,Ib(a,b,c)}function Pb(a,b){return q(b,16,[a])}function Qb(a,b,c){var d=typeof a;if(null==a||"function"==d)return i(a,b,c);if("object"!=d)return Vb(a);var e=Wc(a);return function(b){for(var c=e.length,d=!1;c--&&(d=b[e[c]]===a[e[c]]););return d}}function Rb(a){return null==a?"":String(a).replace($c,r)}function Sb(a){return a}function Tb(a){Z(z(a),function(b){var c=e[b]=a[b];e.prototype[b]=function(){var a=[this.__wrapped__];Jc.apply(a,arguments);var b=c.apply(e,a);return this.__chain__?new f(b,!0):b}})}function Ub(){return wc._=Dc,this}function Vb(a){return function(b){return b[a]}}function Wb(a,b){return null==a&&null==b&&(b=1),a=+a||0,null==b?(b=a,a=0):b=+b||0,a+Hc(Sc()*(b-a+1))}function Xb(a,b){if(a){var c=a[b];return I(c)?a[b]():c}}function Yb(a,b,d){var f=e,g=f.templateSettings;a=String(a||""),d=y({},d,g);var h=0,i="__p += '",j=d.variable,k=RegExp((d.escape||jc).source+"|"+(d.interpolate||jc).source+"|"+(d.evaluate||jc).source+"|$","g");a.replace(k,function(b,d,e,f,g){return i+=a.slice(h,g).replace(kc,c),d&&(i+="' +\n_.escape("+d+") +\n'"),f&&(i+="';\n"+f+";\n__p += '"),e&&(i+="' +\n((__t = ("+e+")) == null ? '' : __t) +\n'"),h=g+b.length,b}),i+="';\n",j||(j="obj",i="with ("+j+" || {}) {\n"+i+"\n}\n"),i="function("+j+") {\nvar __t, __p = '', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n"+i+"return __p\n}";try{var l=Function("_","return "+i)(f)}catch(m){throw m.source=i,m}return b?l(b):(l.source=i,l)}function Zb(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=Array(a);for(b=i(b,c,1);++d<a;)e[d]=b(d);return e}function $b(a){return null==a?"":String(a).replace(Zc,u)}function _b(a){var b=++fc+"";return a?a+b:b}function ac(a){return a=new f(a),a.__chain__=!0,a}function bc(a,b){return b(a),a}function cc(){return this.__chain__=!0,this}function dc(){return this.__wrapped__}var ec,fc=0,gc={},hc=+new Date+"",ic=/<%=([\s\S]+?)%>/g,jc=/($^)/,kc=/['\n\r\t\u2028\u2029\\]/g,lc="[object Arguments]",mc="[object Array]",nc="[object Boolean]",oc="[object Date]",pc="[object Function]",qc="[object Number]",rc="[object Object]",sc="[object RegExp]",tc="[object String]",uc={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},vc={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},wc=uc[typeof window]&&window||this,xc=uc[typeof exports]&&exports&&!exports.nodeType&&exports,yc=uc[typeof module]&&module&&!module.nodeType&&module,zc=yc&&yc.exports===xc&&xc,Ac=uc[typeof global]&&global;!Ac||Ac.global!==Ac&&Ac.window!==Ac||(wc=Ac);var Bc=[],Cc=Object.prototype,Dc=wc._,Ec=Cc.toString,Fc=RegExp("^"+String(Ec).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Gc=Math.ceil,Hc=Math.floor,Ic=Cc.hasOwnProperty,Jc=Bc.push,Kc=Cc.propertyIsEnumerable,Lc=t(Lc=Object.create)&&Lc,Mc=t(Mc=Array.isArray)&&Mc,Nc=wc.isFinite,Oc=wc.isNaN,Pc=t(Pc=Object.keys)&&Pc,Qc=Math.max,Rc=Math.min,Sc=Math.random;f.prototype=e.prototype;var Tc={};!function(){var a={0:1,length:1};Tc.spliceObjects=(Bc.splice.call(a,0,1),!a[0])}(1),e.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:ic,variable:""},Lc||(h=function(){function a(){}return function(b){if(J(b)){a.prototype=b;var c=new a;a.prototype=null}return c||wc.Object()}}()),v(arguments)||(v=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ic.call(a,"callee")&&!Kc.call(a,"callee")||!1});var Uc=Mc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ec.call(a)==mc||!1},Vc=function(a){var b,c=a,d=[];if(!c)return d;if(!uc[typeof a])return d;for(b in c)Ic.call(c,b)&&d.push(b);return d},Wc=Pc?function(a){return J(a)?Pc(a):[]}:Vc,Xc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},Yc=B(Xc),Zc=RegExp("("+Wc(Yc).join("|")+")","g"),$c=RegExp("["+Wc(Xc).join("")+"]","g"),_c=function(a,b){var c,d=a,e=d;if(!d)return e;if(!uc[typeof d])return e;for(c in d)if(b(d[c],c,a)===gc)return e;return e},ad=function(a,b){var c,d=a,e=d;if(!d)return e;if(!uc[typeof d])return e;for(c in d)if(Ic.call(d,c)&&b(d[c],c,a)===gc)return e;return e};I(/x/)&&(I=function(a){return"function"==typeof a&&Ec.call(a)==pc});var bd=p(function(a,b,c){Ic.call(a,c)?a[c]++:a[c]=1}),cd=p(function(a,b,c){(Ic.call(a,c)?a[c]:a[c]=[]).push(b)}),dd=p(function(a,b,c){a[c]=b}),ed=ab,fd=t(fd=Date.now)&&fd||function(){return(new Date).getTime()};e.after=Eb,e.bind=Fb,e.bindAll=Gb,e.chain=ac,e.compact=nb,e.compose=Hb,e.countBy=bd,e.debounce=Ib,e.defaults=y,e.defer=Jb,e.delay=Kb,e.difference=ob,e.filter=W,e.flatten=qb,e.forEach=Z,e.functions=z,e.groupBy=cd,e.indexBy=dd,e.initial=sb,e.intersection=tb,e.invert=B,e.invoke=_,e.keys=Wc,e.map=ab,e.max=bb,e.memoize=Lb,e.min=cb,e.omit=Q,e.once=Mb,e.pairs=R,e.partial=Nb,e.pick=S,e.pluck=ed,e.range=wb,e.reject=fb,e.rest=xb,e.shuffle=hb,e.sortBy=kb,e.tap=bc,e.throttle=Ob,e.times=Zb,e.toArray=lb,e.union=zb,e.uniq=Ab,e.values=T,e.where=mb,e.without=Bb,e.wrap=Pb,e.zip=Cb,e.collect=ab,e.drop=xb,e.each=Z,e.extend=w,e.methods=z,e.object=Db,e.select=W,e.tail=xb,e.unique=Ab,e.clone=x,e.contains=U,e.escape=Rb,e.every=V,e.find=X,e.has=A,e.identity=Sb,e.indexOf=rb,e.isArguments=v,e.isArray=Uc,e.isBoolean=C,e.isDate=D,e.isElement=E,e.isEmpty=F,e.isEqual=G,e.isFinite=H,e.isFunction=I,e.isNaN=K,e.isNull=L,e.isNumber=M,e.isObject=J,e.isRegExp=N,e.isString=O,e.isUndefined=P,e.lastIndexOf=vb,e.mixin=Tb,e.noConflict=Ub,e.random=Wb,e.reduce=db,e.reduceRight=eb,e.result=Xb,e.size=ib,e.some=jb,e.sortedIndex=yb,e.template=Yb,e.unescape=$b,e.uniqueId=_b,e.all=V,e.any=jb,e.detect=X,e.findWhere=Y,e.foldl=db,e.foldr=eb,e.include=U,e.inject=db,e.first=pb,e.last=ub,e.sample=gb,e.take=pb,e.head=pb,Tb(e),e.VERSION="2.4.1",e.prototype.chain=cc,e.prototype.value=dc,Z(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=Bc[a];e.prototype[a]=function(){var a=this.__wrapped__;return b.apply(a,arguments),Tc.spliceObjects||0!==a.length||delete a[0],this}}),Z(["concat","join","slice"],function(a){var b=Bc[a];e.prototype[a]=function(){var a=this.__wrapped__,c=b.apply(a,arguments);return this.__chain__&&(c=new f(c),c.__chain__=!0),c}}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(wc._=e,define(function(){return e})):xc&&yc?zc?(yc.exports=e)._=e:xc._=e:wc._=e}).call(this),function(){function a(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.setRequestHeader("Accept","text/xml"),b.setRequestHeader("Content-Type","application/html"),b.setRequestHeader("Access-Control-Allow-Origin","*"),b.setRequestHeader("Access-Control-Allow-Methods","GET, POST, PUT"),b.setRequestHeader("Access-Control-Allow-Headers","X-Requested-With");var c=a.split(".").pop();switch(c){case"txt":case"csv":break;case"json":break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":b.responseType="arraybuffer";break;case"html":b.responseType="document";break;default:b.responseType="blob"}b.onreadystatechange=function(){4==b.readyState&&200==b.status&&console.log(b.response)},b.send()}function b(a){var c;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return c=new Date,c.setTime(a.getTime()),c;if(a instanceof Array){c=[];for(var d=0,e=a.length;e>d;d++)c[d]=b(a[d]);return c}if(a instanceof Object){if("dtm.array"==a.type)return a.clone();c={};for(var f in a)a.hasOwnProperty(f)&&(c[f]=b(a[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")}function c(a,b,c){"undefined"==typeof c&&(c=.5);var d=[];return _.forEach(a,function(a,e){d[e]=(b[e]-a)*c+a}),d}var d={isLogging:!1},e={version:"0.0.3",log:function(a){d.isLogging&&console.log(arguments.callee.caller.name?arguments.callee.caller.name+": "+a:a)},modelColl:[],modelCallers:{},clocks:[],params:{},get:function(a){switch(a){case"models":return e.modelColl;case"modelNames":var b=[];return _.forEach(e.modelColl,function(a){b.push(a.get("name"))}),b;default:return null}},wa:{isOn:!1},startWebAudio:function(){e.wa.isOn=!0,e.wa.actx=new(window.AudioContext||window.webkitAudioContext),e.wa.now=function(){return e.wa.actx.currentTime},e.wa.out=function(){return e.wa.actx.destination},e.wa.clMult=.01,e.wa.clockBuf=e.wa.actx.createBuffer(1,Math.round(e.wa.actx.sampleRate*e.wa.clMult),e.wa.actx.sampleRate),e.wa.makeNoise=function(a){var b=e.wa.actx;a=a||4192;var c=b.createBuffer(1,a,e.wa.actx.sampleRate),d=c.getChannelData(0);return _.forEach(_.range(a),function(a){d[a]=_.random(-1,1,!0)}),c},e.wa.makeIr=function(a){var b=e.wa.actx,c=Math.round(a*e.wa.actx.sampleRate)||e.wa.actx.sampleRate,d=b.createBuffer(2,c,e.wa.actx.sampleRate),f=d.getChannelData(0),g=d.getChannelData(1),h=10;return _.forEach(_.range(c),function(a){f[a]=e.val.rescale(e.val.expCurve(_.random(0,1,!0)*(c-a)/c,h),-1,1),g[a]=e.val.rescale(e.val.expCurve(_.random(0,1,!0)*(c-a)/c,h),-1,1)}),d},e.wa.buffs={verbIr:e.wa.makeIr(2)}},oscParams:{isOpen:!1,port:null},startOsc:function(){e.osc.isOn=!0,e.osc.start()}};this.dtm=e,e.loadData=function(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.open("GET",a,!0);var f=a.split(".").pop();switch(f){case"txt":case"csv":break;case"json":e.responseType="json";break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":e.responseType="arraybuffer";break;default:e.responseType="blob"}e.onreadystatechange=function(){4==e.readyState&&200==e.status?("undefined"!=typeof b&&b(e.response),c(e.response)):d(e.status)},e.send()})},e.loadAudio=function(a,b){return new Promise(function(c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onreadystatechange=function(){4==d.readyState&&200==d.status&&actx.decodeAudioData(d.response,function(a){c(a),"undefined"!=typeof b&&b(a)})},d.send()})},e.scales={Major:[0,4,7],minor:[0,3,7],Maj7:[0,4,7,11],"-7":[0,3,7,10],7:[0,4,7,10],"7sus4":[0,5,7,10]},e.osc={type:"dtm.osc",oscPort:null,isOn:!1,isOpen:!1,callbacks:[],start:function(){return"undefined"==typeof osc||e.osc.isOpen?e.osc.isOpen&&e.log("OSC port is already open"):(e.osc.isOpen=!0,e.log("opening OSC port"),e.osc.oscPort=new osc.WebSocketPort({url:"ws://localhost:8081"}),e.osc.oscPort.open(),e.osc.oscPort.listen(),e.osc.oscPort.on("ready",function(){e.osc.oscPort.on("message",function(a){switch(a.address){case"/test":}}),e.osc.oscPort.on("error",function(a){throw new Error(a)})})),e.osc},stop:function(){return e.osc.oscPort&&e.osc.oscPort.close(1e3),e.osc.isOpen=!1,e.osc},on:function(a,b){return e.osc.oscPort.on("message",function(c){"/"!==a[0]&&(a="/".concat(a)),c.address==a&&b(c.args)}),e.osc},send:function(a,b){return"/"!==a[0]&&a.unshift("/"),b.constructor!==Array&&(b=[b]),e.osc.oscPort.send({address:a,args:b}),e.osc},clear:function(){e.osc.callbacks=[]}},e.osc.close=e.osc.stop,e.analyzer={type:"dtm.analyzer",checkType:function(a){var b=_.reduce(a,function(a,b){return a+b});return isNaN(b)||"string"==typeof b?"string":b.toString().indexOf(".")>-1?"float":"int"},min:function(a){return"string"===e.analyzer.checkType(a)?(e.log("cannot get the min value of a string array"),null):_.min(a)},max:function(a){return"string"===e.analyzer.checkType(a)?(e.log("cannot get the max value of a string array"),null):_.max(a)},mean:function(a){var b=e.anal.checkType(a);if("string"===b)return e.log("cannot get the mean value of a string array"),null;var c=_.reduce(a,function(a,b){return a+b});return c/_.size(a)},mode:function(a){var b=_.uniq(a),c=0,d=0,e=null,f=_.countBy(a);return _.forEach(b,function(a){d=f[a],d>c&&(e=a,c=d)}),e},median:function(a){var b=a.sort(),c=a.length;return c%2===0?(b[c/2-1]+b[c/2])/2:b[Math.floor(c/2)]},midrange:function(a){var b=e.analyzer.max(a),c=e.analyzer.min(a);return(b+c)/2},sum:function(a){var b=_.reduce(a,function(a,b){return a+b});return b},"var":function(a){var b=e.analyzer.mean(a),c=[];return _.forEach(a,function(a,d){c[d]=Math.pow(b-a,2)}),e.analyzer.sum(c)/(a.length-1)},std:function(a){return Math.sqrt(e.analyzer["var"](a))},pvar:function(a){var b=e.analyzer.mean(a),c=[];return _.forEach(a,function(a,d){c[d]=Math.pow(b-a,2)}),e.analyzer.mean(c)},pstd:function(a){return Math.sqrt(e.analyzer.pvar(a))},rms:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.pow(a,2)}),Math.sqrt(e.analyzer.mean(b))},histo:function(a){var b=[],c=_.clone(a),d=_.countBy(a);return _.forEach(c,function(a,c){b[c]=d[a]}),b},classes:function(a){return _.uniq(a).sort()},uniformity:function(a){return e.analyzer.classes(a).length/a.length},autoCorr:null},e.anal=e.analyzer,e.transform={type:"dtm.transform",generate:function(a,b,c,d){"undefined"==typeof b&&(b=8),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1);var e=[];switch(a){case"line":for(var f=(d-c)/(b-1),g=0;b>g;g++)e[g]=c+f*g;break;case"seq":case"sequence":c||(c=0),d=d||1;for(var g=0;b>g;g++)e[g]=g*d+c;break;case"range":c||(c=0),c=Math.round(c),d=Math.round(d);for(var g=0;d-c>g;g++)e[g]=g+c;break;case"noise":case"random":case"rand":for(var g=0;b>g;g++)e[g]=_.random(c,d,!0);break;case"randi":for(var g=0;b>g;g++)e[g]=_.random(c,d);break;case"gaussian":case"gauss":case"normal":for(var g=0;b>g;g++){var h=-Math.PI+2*Math.PI/b*g;e[g]=Math.pow(Math.E,-.5*Math.pow(h,2))/Math.sqrt(2*Math.PI)/.4*(d-c)+c}break;case"sin":case"sine":for(var g=0;b>g;g++){var f=2*Math.PI/(b-1),i=Math.sin(f*g);i=(i+1)/2*(d-c)+c,e[g]=i}break;case"cos":case"cosine":for(var g=0;b>g;g++){var f=2*Math.PI/(b-1),i=Math.cos(f*g);i=(i+1)/2*(d-c)+c,e[g]=i}break;case"zeros":case"zeroes":for(var g=0;b>g;g++)e[g]=0;break;case"ones":for(var g=0;b>g;g++)e[g]=1;break;case"constant":case"constants":case"const":case"consts":c=c||0;for(var g=0;b>g;g++)e[g]=c;break;case"string":case"str":case"s":case"characters":case"character":case"chars":case"char":case"c":e=arguments[1].split("")}return e},normalize:function(a,b,c){"undefined"==typeof b&&(b=_.min(a)),"undefined"==typeof c&&(c=_.max(a));var d=1;c==b?b>0&&1>=b?b=0:b>1&&(b-=1):d=c-b;var e=_.map(a,function(a){return(a-b)/d});return e},rescale:function(a,b,c,d,f){var g=e.transform.normalize(a,d,f),h=[];return _.forEach(g,function(a,d){h[d]=e.value.rescale(a,b,c)}),h},expCurve:function(a,b){b=b||1;var c=[];return _.forEach(a,function(a,d){c[d]=e.value.expCurve(a,b)}),c},logCurve:function(a,b){b=b||1;var c=[];return _.forEach(a,function(a,d){c[d]=e.value.logCurve(a,b)}),c},fit:function(a,b,c){c=c||"linear",b=1>b?1:Math.round(b);var d=[];d.length=b;var e=b/a.length;if("linear"===c){inNumItv=a.length-1,outNumItv=b-1,intermLen=inNumItv*outNumItv+1,intermArr=[],intermArr.length=intermLen;for(var f=0,g=0;g<inNumItv;g++)for(var h=0;h<outNumItv;h++)intermArr[f]=a[g]+(a[g+1]-a[g])*(h/outNumItv),f++;intermArr[f]=a[g];for(var i=0;i<outNumItv;i++)d[i]=intermArr[i*inNumItv];d[i]=intermArr[intermLen-1]}else if("step"===c)for(var h=0;b>h;h++)d[h]=a[Math.floor(h/e)];else if("zeros"===c)for(var j=-1,h=0;b>h;h++)j!==Math.floor(h/e)?(j=Math.floor(h/e),d[h]=a[j]):d[h]=0;return d},stretch:function(a,b,c){c=c||"linear";var d=Math.round(a.length*b);return 0==d&&(d=1),e.transform.fit(a,d,c)},limit:function(a,b,c){var d=[];return _.forEach(a,function(a,e){var f=a;b>f&&(f=b),f>c&&(f=c),d[e]=f}),d},fitSum:function(a,b,c){"undefined"==typeof c&&(c=!1);var d=e.analyzer.sum(a);0===d&&(a=e.transform.add(a,1e-6),d=e.analyzer.sum(a)),c&&(b=Math.round(b));var f=e.transform.mult(a,1/d*b);if(c&&(f=e.transform.round(f),e.analyzer.sum(f)!==b)){var g=1,h=e.analyzer.sum(f)-b,i=0>h;if(i)for(;0>h;)f[e.val.mod(a.length-g,a.length)]++,h++,g++;else for(;h>0;)f[a.length-g]>0?(f[e.val.mod(a.length-g,a.length)]--,h--,g++):g++}return f},add:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=a+b});else if(b.constructor===Array){a.length!==b.length&&(b=e.transform.fit(b,a.length,c));for(var f=0;f<a.length;f++)d[f]=a[f]+b[f]}return d},mult:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=a*b});else if(b.constructor===Array){a.length!==b.length&&(b=e.transform.fit(b,a.length,c));for(var f=0;f<a.length;f++)d[f]=a[f]*b[f]}return d},pow:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=Math.pow(a,b)});else if(b.constructor===Array){a.length!==b.length&&(b=e.transform.fit(b,a.length,c));for(var f=0;f<a.length;f++)d[f]=Math.pow(a[f],b[f])}return d},powof:function(a,b,c){var d=[];if("number"==typeof b)_.forEach(a,function(a,c){d[c]=Math.pow(b,a)});else if(b.constructor===Array){a.length!==b.length&&(b=e.transform.fit(b,a.length,c));for(var f=0;f<a.length;f++)d[f]=Math.pow(b[f],a[f])}return d},round:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.round(a)}),b},floor:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.floor(a)}),b},ceil:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.floor(a)}),b},hwr:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=0>a?0:a}),b},fwr:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=0>a?Math.abs(a):a}),b},removeZeros:function(a){for(var b=[],c=0;c<a.length;c++)0!==a[c]&&b.push(a[c]);return b},diff:function(a){for(var b=[],c=1;c<a.length;c++)b.push(a[c]-a[c-1]);return b},mirror:function(a){for(var b=[],c=a.length-1;c>=0;--c)b.push(a[c]);return b},invert:function(a,b){"undefined"==typeof b&&(b=e.analyzer.mean(a));var c=[];return _.forEach(a,function(a,d){c[d]=b-(a-b)}),c},shuffle:function(a){return _.shuffle(a)},sort:function(a){return _.sortBy(a,function(a){return a})},repeat:function(a,b){var c=[];b||(b=1);for(var d=0;b>d;d++)c=c.concat(a);return c},truncate:function(a,b,c){var d=[];if("undefined"!=typeof c)for(var e=0;e<a.length-(b+c);e++)d[e]=a[b+e];else for(var f=0;f<a.length-b;f++)d[f]=a[f];return d},getBlock:function(a,b,c){for(var d=[],f=0,g=0;c>g;g++)f=e.val.mod(g+b,a.length),d[g]=a[f];return d},shift:function(a,b){for(var c=[],d=0;d<a.length;d++){var f=e.value.mod(d+b,a.length);c[d]=a[f]}return c},morph:function(a,b,d,f){"undefined"==typeof d&&(d=.5);var g=a.length,h=b.length,i=Math.round((h-g)*d+g);return c(e.transform.fit(a,i,f),e.transform.fit(b,i),d)},interleave:function(){},notesToBeats:function(a,b){var c=[],d=0;return _.forEach(a,function(a){for(var e=b/a,f=0;e>f;f++)c[d]=0===f?1:0,d++}),c},beatsToNotes:function(a,b){for(var c=[],d=1,e=0;e<a.length-1;e++)0!==a[e+1]?(c.push(b/d),d=1):d++;return c.push(b/d),c},intervalsToBeats:function(a){var b=[],c=0;return _.forEach(a,function(a){for(var d=a,e=0;d>e;e++)b[c]=0===e?1:0,c++}),b},beatsToIntervals:function(a){for(var b=[],c=1,d=0;d<a.length-1;d++)0!==a[d+1]?(b.push(c),c=1):c++;return b.push(c),b},beatsToIndices:function(a){for(var b=[],c=0;c<a.length;c++)0!==a[c]&&b.push(c);return b},indicesToBeats:function(a,b){if(a=e.transform.sort(a),"undefined"==typeof b)for(var c=0,d=1;a[a.length-1]>=d;)d=Math.pow(2,++c);else d=b;for(var f=f=e.transform.generate("zeros",d),g=0;g<a.length&&!(a[g]>=b);g++)f[a[g]]=1;return f},calcBeatsOffset:function(a,b){for(var c=[],d=0,e=!1,f=!1,g=0;g<a.length;g++)1!==a[g]||f?1!==b[g]||e||(f=!0):e=!0,e?1===b[g]?(c.push(d),e=f=!1,d=0):d++:f&&(1===a[g]?(c.push(d),e=f=!1,d=0):d--);return c},applyOffsetToBeats:function(a,b){for(var c=e.array().fill("zeroes",a.length).get(),d=0,f=0;f<a.length;f++)1===a[f]&&(c[f+b[d]]=1,d++);return c},lreModulation:function(a,b){for(var c=[],d=0,e=0,f=0;f<a.length;f++)c[f]=0,0!==a[f]&&d++;for(var g=a.length/d,h=[],i=0;i<a.length;i++)if(0!==a[i]){var j=i-g*e;h.push(Math.round(g*e+j*(b-.5)*2)),e++}for(var k=0;k<h.length;k++){var l=h[k];0>l?l=0:l>=a.length&&(l=a.length-1),c[l]=1}return c},pq:function(a,b,c){var d=[];
return _.forEach(a,function(a,f){d[f]=e.value.pq(a,b,c)}),d},unique:function(a){return _.uniq(a)},classId:function(a){var b=[],c=e.analyzer.classes(a).sort(),d={};return _.forEach(c,function(a,b){d[a]=b}),_.forEach(a,function(a,c){b[c]=d[a]}),b},stringify:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=a.toString()}),b},tonumber:function(a){var b=[];return a.forEach(function(a,c){b[c]=Number.parseFloat(a)}),b}},e.transform.ntob=e.transform.notesToBeats,e.transform.bton=e.transform.beatsToNotes,e.transform.itob=e.transform.intervalsToBeats,e.transform.btoi=e.transform.beatsToIntervals,e.transform.fill=e.transform.generate,e.transform.abs=e.transform.fwr,e.transform.randomize=e.transform.shuffle,e.tr=e.transform,e.array=function(){function a(a){b.type=isNaN(a[0])?"object"==typeof a[0]?"collection":typeof a[0]:"number"}var b={name:"",type:null,length:null,min:null,max:null,mean:null,std:null,mode:null,value:[],original:null,normalized:[],classes:null,histogram:null,numClasses:null,index:0,step:1},c={type:"dtm.array"};return c.get=function(a){if("number"==typeof a)return 0>a||a>=b.length?(e.log("Index out of range"),b.value[e.value.mod(a,b.length)]):b.value[a];switch(a){case"name":case"key":return b.name;case"type":return b.type;case"len":case"length":return b.length;case"minimum":case"min":return e.analyzer.min(b.value);case"maximum":case"max":return e.analyzer.max(b.value);case"minmax":case"range":return[e.analyzer.min(b.value),e.analyzer.max(b.value)];case"mean":case"average":case"avg":return e.analyzer.mean(b.value);case"mode":return e.analyzer.mode(b.value);case"median":return e.analyzer.median(b.value);case"midrange":return e.analyzer.midrange(b.value);case"standardDeviation":case"std":return e.analyzer.std(b.value);case"pstd":return e.analyzer.pstd(b.value);case"variance":case"var":return e.analyzer["var"](b.value);case"populationVariance":case"pvar":return e.analyzer.pvar(b.value);case"sumAll":case"sum":return e.analyzer.sum(b.value);case"rms":return e.analyzer.rms(b.value);case"pdf":break;case"current":case"curr":case"cur":case"now":case"moment":return b.value[b.index];case"next":return b.index=e.value.mod(b.index+b.step,b.length),b.value[b.index];case"prev":case"previous":return b.index=e.value.mod(b.index-b.step,b.length),b.value[b.index];case"palindrome":break;case"rand":case"random":return b.index=_.random(0,b.length-1),b.value[b.index];case"urn":break;case"index":case"idx":return b.index;case"hop":case"hopSize":case"step":case"stepSize":return b.step;case"relative":case"location":case"loc":break;case"block":case"window":var c,d;return arguments[1].constructor===Array?(c=arguments[1][0],d=arguments[1][1],e.transform.getBlock(b.value,c,d)):"number"==typeof arguments[1]&&"number"==typeof arguments[2]?(c=arguments[1],d=arguments[2],e.transform.getBlock(b.value,c,d)):b.value;case"blockNext":return b.index=e.value.mod(b.index+b.step,b.length),e.transform.getBlock(b.value,b.index,arguments[1]);case"original":return b.original;case"normal":case"normalize":case"normalized":return e.transform.normalize(b.value);case"sorted":case"sort":return e.transform.sort(b.value);case"uniques":case"unique":case"uniq":return e.transform.unique(b.value);case"classes":return e.analyzer.classes(b.value);case"classID":case"classId":return e.transform.classId(b.value);case"string":case"stringify":return e.transform.stringify(b.value);case"numClasses":case"numUniques":case"numUniqs":return e.analyzer.classes(b.value).length;case"unif":case"uniformity":return e.analyzer.uniformity(b.value);case"histogram":case"histo":return e.analyzer.histo(b.value);default:return b.value}},c.set=function(d){return"undefined"==typeof d&&(d=[]),"number"==typeof d?b.value=[d]:d.constructor===Array?b.value=d:"dtm.array"===d.type?b.value=d.get():"string"==typeof d&&(b.value=e.transform.fill.apply(this,arguments)),null===b.original&&(b.original=b.value),a(b.value),b.length=b.value.length,b.index=b.length-1,c},c.name=function(a){return a||(a=""),b.name=a.toString(),c},c.setType=function(a){return b.type=a.toString(),c},c.set.apply(this,arguments),a(b.value),c.step=function(a){return b.step=Math.round(a),c},c.stepSize=c.step,c.index=function(a){return b.index=e.value.mod(Math.round(a),b.length),c},c.setIndex=c.index,c.fill=function(){return b.value=e.transform.generate.apply(this,arguments),c.set(b.value),c},c.gen=c.generate=c.fill,c.clone=function(){var a=e.array(b.value).name(b.name);return a.index(b.index),a.step(b.step),"string"===b.type&&(a.classes=b.classes,a.histogram=_.clone(b.histogram),a.setType("string")),a},c.d=c.dup=c.duplicate=c.c=c.copy=c.clone,c.morph=function(a,d,f){return"array"!=typeof a&&"dtm.array"===a.type&&(a=a.get()),"undefined"==typeof d&&(d=.5),b.value=e.transform.morph(b.value,a,d,f),c.set(b.value),c},c.reset=function(){return c.set(b.original),c},c.original=c.reset,c.flush=function(){return c.set([])},c.clear=c.flush,c.normalize=function(a,d){return b.value=e.transform.normalize(b.value,a,d),c.set(b.value),c},c.nml=c.normal=c.normalize,c.rescale=function(a,d,f,g){return b.value=e.transform.rescale(b.value,a,d,f,g),c.set(b.value),c},c.range=c.scale=c.rescale,c.limit=function(a,d){return"number"===b.type?(a=a||0,d=d||1,c.set(e.transform.limit(c.get(),a,d))):c},c.clip=c.limit,c.expCurve=function(a,b,d){"undefined"==typeof b&&(b=c.get("min")),"undefined"==typeof d&&(d=c.get("max"));var f=e.transform.expCurve(c.get("normalized"),a);return c.set(e.transform.rescale(f,b,d)),c},c.exp=c.expCurve,c.logCurve=function(a,b,d){"undefined"==typeof b&&(b=c.get("min")),"undefined"==typeof d&&(d=c.get("max"));var f=e.transform.logCurve(c.get("normalized"),a);return c.set(e.transform.rescale(f,b,d)),c},c.log=c.logCurve,c.fit=function(a,d){return b.value=e.transform.fit(b.value,a,d),c.set(b.value),c},c.fitLen=c.fit,c.stretch=function(a,d){return b.value=e.transform.stretch(b.value,a,d),c.set(b.value),c},c.summarize=function(){return c},c.fitSum=function(a,d){return c.set(e.transform.fitSum(b.value,a,d))},c.fitsum=c.fitSum,c.add=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(e.transform.add(b.value,a,d)),c},c.mult=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(e.transform.mult(b.value,a,d)),c},c.pow=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(e.transform.pow(b.value,a,d)),c},c.powof=function(a,d){return"dtm.array"===a.type&&(a=a.get()),c.set(e.transform.powof(b.value,a,d))},c.sort=function(){return b.value=e.transform.sort(b.value),c.set(b.value),c},c.concat=function(a){"undefined"==typeof a&&(a=[]);var d=b.value;return a.constructor===Array||"number"==typeof a?d=d.concat(a):"dtm.array"===a.type&&(d=d.concat(a.get())),c.set(d),c},c.append=c.concat,c.repeat=function(a){return b.value=e.transform.repeat(b.value,a),c.set(b.value),c},c.rep=c.repeat,c.truncate=function(a,d){return b.value=e.transform.truncate(b.value,a,d),c.set(b.value),c},c.slice=c.truncate,c.getBlock=function(a,d){return a=a||0,d=d||b.length,c.set(e.transform.getBlock(b.value,a,d))},c.block=c.getBlock,c.shift=function(a){return b.value=e.transform.shift(b.value,a),c.set(b.value),c},c.mirror=function(){return b.value=e.transform.mirror(b.value),c.set(b.value),c},c.rev=c.reverse=c.mirror,c.invert=function(a){return b.value=e.transform.invert(b.value,a),c.set(b.value),c},c.flip=c.inv=c.invert,c.shuffle=function(){return b.value=e.transform.shuffle(b.value),c.set(b.value),c},c.rand=c.random=c.randomize=c.shuffle,c.queue=function(a){return"number"==typeof a?(b.value.push(a),b.value.shift()):a.constructor===Array?(b.value=b.value.concat(a),b.value=b.value.splice(a.length)):"dtm.array"===a.type&&(b.value=b.value.concat(a.get()),b.value=b.value.splice(a.get("len"))),c.set(b.value)},c.fifo=c.queue,c.round=function(){return b.value=e.transform.round(b.value),c.set(b.value),c},c.floor=function(){return c.set(e.transform.floor(b.value))},c.ceil=function(){return c.set(e.transform.ceil(b.value))},c.hwr=function(){return c.set(e.transform.hwr(b.value)),c},c.fwr=function(){return c.set(e.transform.fwr(b.value)),c},c.abs=c.fwr,c.derivative=function(){return c},c.diff=function(){return c.set(e.transform.diff(b.value))},c.removeZeros=function(){return c.set(e.transform.removeZeros(b.value))},c.histo=function(){return c.set(e.analyzer.histo(b.value)),b.type="string",c},c.histogram=c.hist=c.histo,c.unique=function(){return c.set(e.transform.unique(b.value)),c},c.uniq=c.unique,c.classId=function(){return c.set(e.transform.classId(b.value))},c["class"]=c.classify=c.classId,c.stringify=function(){return c.set(e.transform.stringify(b.value))},c.tostring=c.stringify,c.tonumber=function(){return c.set(e.transform.tonumber(b.value))},c.toNumber=c.tonumber,c.morethan=function(){return c},c.mt=c.morethan,c.lessthan=function(){return c},c.lt=c.lessthan,c.pq=function(a,d){return 0===arguments.length?a=_.range(12):a.constructor===Array||"string"==typeof a&&(a=e.scales[a.toLowerCase()]),c.set(e.transform.pq(b.value,a,d))},c.pitchScale=c.pitchQuantize=c.pq,c.transpose=function(){return c},c.notesToBeats=function(a){return a=a||4,b.value=e.transform.notesToBeats(b.value,a),c.set(b.value),c},c.ntob=c.notesToBeats,c.beatsToNotes=function(a){return a=a||4,b.value=e.transform.beatsToNotes(b.value,a),c.set(b.value),c},c.bton=c.beatsToNotes,c.intervalsToBeats=function(){return b.value=e.transform.intervalsToBeats(b.value),c.set(b.value),c},c.itob=c.intervalsToBeats,c.beatsToIntervals=function(){return b.value=e.transform.beatsToIntervals(b.value),c.set(b.value),c},c.btoi=c.beatsToIntervals,c.beatsToIndices=function(){return b.value=e.transform.beatsToIndices(b.value),c.set(b.value),c},c.btoid=c.beatsToIndices,c.indicesToBeats=function(a){return c.set(e.transform.indicesToBeats(b.value,a))},c.idtob=c.indicesToBeats,c},e.a=e.arr=e.array,e.collection=function(){var a={type:"dtm.collection"};return a.get=function(){var a=null;return a},a.set=function(){return a},a.update=function(){return a},a.map=function(){return a},a},e.coll=e.collection,e.value={type:"dtm.value",rescale:function(a,b,c,d){d=d||!1;var e=a*(c-b)+b;return d&&(e=Math.round(e)),e},expCurve:function(a,b){return b=1>=b?1.000001:b,(Math.exp(a*Math.log(b))-1)/(b-1)},logCurve:function(a,b){return b=1>=b?1.000001:b,Math.log(a*(b-1)+1)/Math.log(b)},mtof:function(a){return 440*Math.pow(2,(a-69)/12)},pq:function(a,b,c){"undefined"==typeof b&&(b=[0,1,2,3,4,5,6,7,8,9,10,11]),"undefined"==typeof c&&(c=!1);var d=a%12,e=a-d,f=Math.floor(d/12*b.length),g=0;return c||(g=a%1),e+b[f]+g},mod:function(a,b){return(a%b+b)%b},incr:function(){},randi:function(a,b){return _.random(a,b)},random:function(a,b){return"undefined"==typeof a&&"undefined"==typeof b&&(a=0,b=1),_.random(a,b,!0)}},e.value.rand=e.value.random,e.v=e.val=e.value,e.iterator=function(a){var b={type:"dtm.iterator",array:null,idx:0,len:0,order:null,range:{},modIdx:[]};return b.set=function(a){return"undefined"!=typeof a&&(b.len=a.length,b.array="dtm.array"===a.type?a:e.array(a)),b},b.set(a),b.next=function(a){"undefined"==typeof a&&(a="value");var c=b.array[a][b.idx];return b.idx=e.value.mod(b.idx+1,b.array.length),c},b.prev=function(a){"undefined"==typeof a&&(a="value");var c=b.array[a][b.idx];return b.idx=e.value.mod(b.idx-1,b.array.length),c},b.jump=function(a,c){"undefined"==typeof c&&(c="value");var d=b.array[c][b.idx];return b.idx=e.value.mod(a,b.array.length),d},b.random=function(a){return"undefined"==typeof a&&(a="value"),b.idx=Math.floor(Math.random()*b.array.length),b.array[a][b.idx]},b.urn=function(){var a=_.range(b.array.length-1);b.modIdx=e.transform.shuffle(a)},b.drunk=function(a,c,d){"undefined"==typeof a&&(a=1),"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d="value");var f=1;c&&(f=0);var g=_.random(f,a);return _.random(0,1)&&(g=-g),b.idx=e.value.mod(b.idx+g,b.array.length),b.array[d][b.idx]},b.setRange=function(){},b.previous=b.prev,b},e.it=e.iter=e.iterator,e.parser={type:"dtm.parser",parseCsv:function(){return parser},csvToJson:function(a){for(var b=a.split("\r"),c=[],d=b[0].split(","),e=1;e<b.length;e++){var f={},g=b[e].split(",");if(g.length>1){for(var h=0;h<d.length;h++){var i=g[h];isNaN(i)||(i=Number.parseFloat(i)),f[d[h]]=i}c.push(f)}}return c},valueTypes:function(a){var b=[];return _.forEach(a,function(a){var c=parseFloat(a);b.push(isNaN(c)?"string":a.indexOf(".")>-1?"float":"int")}),b},getSize:function(a){var b=_.size(a[0]),c=_.size(a);return[b,c]}},e.data=function(a,b){function c(){_.forEach(g.keys,function(a){var b=e.array(_.pluck(g.coll,a)).name(a);g.arrays[a]=b})}function d(){_.forEach(g.keys,function(a){g.types[a]=g.arrays[a].get("type")})}function f(){g.size.col=g.keys.length,g.size.row=g.coll.length}var g={arrays:{},coll:[],keys:[],types:{},size:{}},h={type:"dtm.data",name:"dtm.data",promise:null,callback:null};return h.get=function(a,b){if("string"!=typeof a)return"number"==typeof a?a>=0&&a<g.size.col?g.arrays[g.keys[a]].clone():(e.log("data.get(): index out of range"),h):h;switch(a){case"a":case"arr":case"array":case"arrays":case"column":return"number"==typeof b?b>=0&&b<g.size.col?g.arrays[g.keys[b]].clone():(e.log("data.get(): index out of range"),h):"string"==typeof b?g.keys.indexOf(b)>-1?g.arrays[b].clone():(e.log("data.get(): key does not exist"),h):(e.log("data.get(): please specify array with index or name"),g.arrays);case"c":case"col":case"coll":case"collection":return g.coll;case"row":case"r":return g.coll[b];case"size":case"dim":case"dimension":return g.size;case"len":case"length":return g.size.row;case"k":case"key":case"keys":case"name":case"names":case"list":return g.keys.slice();case"t":case"type":case"types":return g.types;default:return h}},h.set=function(a){g.coll=a,g.keys=_.keys(g.coll[0]),c(),d(),f()},h.load=function(a,b){return"undefined"!=typeof b&&(h.callback=b),h.promise=new Promise(function(i){var j=a.split(".").pop();if("json"===j){var k="jsonp_callback_"+Math.round(1e5*Math.random());window[k]=function(a){delete window[k],document.body.removeChild(l);var e=_.keys(a);_.forEach(e,function(b){"response"!==b&&(g.coll=a[b],g.keys=_.keys(g.coll[0]),c(),d(),f(),i(h))}),"undefined"!=typeof b&&b(h)};var l=document.createElement("script");l.src=a+(a.indexOf("?")>=0?"&":"?")+"callback="+k,document.body.appendChild(l)}else{var m=new XMLHttpRequest;switch(m.open("GET",a,!0),j){case"txt":case"csv":break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":m.responseType="arraybuffer"}m.onreadystatechange=function(){4==m.readyState&&200==m.status&&("arraybuffer"===m.responseType?e.wa.actx.decodeAudioData(m.response,function(a){for(var c=0;c<a.numberOfChannels;c++){var d=a.getChannelData(c);g.arrays["ch_"+c]=e.array(Array.prototype.slice.call(d)).name("ch_"+c)}"undefined"!=typeof b&&b(h),i(h)}):(g.coll="csv"===j?e.parser.csvToJson(m.response):JSON.parse(m.response).matches,g.keys=_.keys(g.coll[0]),c(),d(),f(),"undefined"!=typeof b&&b(h),i(h)))},m.send()}}),h.promise.get=function(a){h.promise.then(function(b){return h=b,b.get(a)})},"dtm.data"===h.name?h:"dtm.load"===h.name?h.promise:void 0},h.clone=function(){return e.clone(h)},h.map=function(){return h},h.stream=function(){return h},h.init=function(a){if(1===arguments.length){if("number"==typeof a)for(var b=0;a>b;b++)g.arrays[b]=e.array(),g.keys[b]=b.toString(),g.size.col=a,g.size.row=0;else if("object"==typeof a)for(var b=0;b<a.num;b++)g.arrays[b]=e.array().fill("zeros",a.len),g.keys[b]=b.toString(),g.size.col=a.num,g.size.row=a.len}else if(2===arguments.length)for(var b=0;b<arguments[0];b++)g.arrays[b]=e.array().fill("zeros",arguments[1]),g.keys[b]=b.toString(),g.size.col=arguments[0],g.size.row=arguments[1];else if(3===arguments.length)for(var b=0;b<arguments[0];b++)g.arrays[arguments[2][b]]=e.array().fill("zeros",arguments[1]).name(arguments[2][b]),g.keys[b]=arguments[2][b],g.size.col=arguments[0],g.size.row=arguments[1];return h},h.append=function(a){if(a.constructor===Array){for(var b=0;b<a.length;b++)"undefined"!=typeof g.arrays[g.keys[b]]&&g.arrays[g.keys[b]].append(a[b]);g.size.row++}return h},h.queue=function(a){if(a.constructor===Array)for(var b=0;b<a.length;b++)"undefined"!=typeof g.arrays[g.keys[b]]&&g.arrays[g.keys[b]].queue(a[b]);return h},h.flush=function(){return _.forEach(g.arrays,function(a){a.flush()}),g.size.row=0,h},"undefined"==typeof a?h:"string"==typeof a?h.load(a,b):void 0},e.load=e.d=e.data,e.load.name="dtm.load",e.clock=function(a,b,c){var d={source:"animationFrame",name:null,isOn:!1,sync:!0,isMaster:!1,bpm:120,subDiv:16,random:0,swing:.5,current:0,previous:0,reported:0,resolution:480,beat:0,prevBeat:-1,offset:0,requestId:null,autoStart:!0},f={type:"dtm.clock",interval:1,time:[4,4],beat:0,list:[],prev:0,callbacks:[]},g=0;f.get=function(a){switch(a){case"bpm":case"tempo":return d.bpm;case"subdiv":case"subDiv":case"div":return d.subDiv;case"sync":case"synced":return d.sync;case"isOn":case"isPlaying":return d.isOn;case"source":return d.source;case"beat":return d.beat;case"cur":case"current":return d.current;case"prev":case"previous":return d.previous;case"rep":case"reported":return d.reported;default:return f}},f.set=function(a,b,c){return"number"==typeof a?(d.bpm=a,d.sync=!1):"boolean"==typeof a?d.sync=a:"sync"==a&&(d.sync=!0),"undefined"!=typeof b&&(d.subDiv=b),"undefined"!=typeof c&&(d.autoStart=c),f},f.sync=function(a){return"undefined"==typeof a&&(a=!0),d.sync=a,f},f.bpm=function(a){return arguments&&a?(d.bpm=a,d.sync=!1,f):f},f.tempo=f.bpm,f.subDiv=function(a){return a=a||4,d.subDiv=a,f},f.div=f.subdiv=f.subDiv,f.interval=function(){return f},f.setTime=function(a){return"Array"==typeof a?f.time=a:"string"==typeof a&&(f.time=a.split("/")),f},f.setMaster=function(a){return d.isMaster=a,f},f.add=function(a,b){var c=!1;return"string"==typeof b?(_.forEach(f.callbacks,function(a){a.name==b&&(e.log("clock.add(): identical function exists in the callback list"),c=!0)}),c||(e.log("adding a new callback function to clock"),f.callbacks.push(a))):(_.forEach(f.callbacks,function(b){_.isEqual(b,a)&&(e.log("clock.add(): identical function exists in the callback list"),c=!0)}),c||(e.log("adding a new callback function to clock"),f.callbacks.push(a))),f},f.call=f.register=f.reg=f.add,f.remove=function(a){return"function"==typeof a?(e.log("removing a calblack function"),_.remove(f.callbacks,function(b){return _.isEqual(b,a)})):"string"==typeof a&&(e.log("removing a calblack function: "+a),_.remove(f.callbacks,function(b){return b.name==a})),f},f.del=f["delete"]=f.rem=f.remove,f.modify=function(a,b){if("function"==typeof a)e.log("modifying the callback: "+a.name),f.remove(a.name),f.add(a);else if("string"==typeof a)if(e.log("modifying the callback: "+a),f.remove(a),""==b.name){var c=new Function("return function "+a+b.toString().slice(8))();f.add(c)}else f.add(b);return f},f.replace=f.mod=f.modify,f.start=function(){return"animationFrame"===d.source&&window.requestAnimationFrame(f.tick),e.log(d.isMaster?"starting the master clock":"starting a clock"),d.isOn!==!0&&(d.isOn=!0,f.tick(),d.isMaster||e.clocks.push(f)),f},f.run=f.play=f.start;var h;return f.tick=function(a){if(d.isOn)if(d.sync||d.isMaster){if(d.sync&&!d.isMaster);else if(d.isMaster)if("webAudio"===d.source){h=actx.createBufferSource(),h.buffer=clockBuf,h.connect(out());var b=d.bpm/60*(d.subDiv/4);h.playbackRate.value=b*clMult,h.playbackRate.value+=h.playbackRate.value*d.random*_.sample([1,-1]),h.playbackRate.value*=f.beat%2==0?(1-d.swing)/.5:d.swing/.5,h.start(now()+1e-7),h.onended=function(){g+=1/b;var a=now()-g;f.tick(a)},_.forEach(f.callbacks,function(a){a(f)}),f.beat=(f.beat+1)%(d.subDiv*f.time[0]/f.time[1])}else"animationFrame"===d.source&&(d.reported=Math.round(a/1e3*d.bpm/60*d.resolution),d.reported!==d.current&&(d.current%d.resolution>d.reported%d.resolution&&(d.beat=Math.round((d.current-d.offset)/d.resolution)),_.forEach(f.callbacks,function(a){a(f)}),d.current=d.reported),d.requestId=window.requestAnimationFrame(f.tick))}else if("webAudio"===d.source){h=actx.createBufferSource(),h.buffer=clockBuf,h.connect(out());var b=d.bpm/60*(d.subDiv/4);h.playbackRate.value=b*clMult,h.playbackRate.value+=h.playbackRate.value*d.random*_.sample([1,-1]),h.playbackRate.value*=f.beat%2==0?(1-d.swing)/.5:d.swing/.5,h.start(now()+1e-7),h.onended=function(){g+=1/b;now()-g;f.tick()},_.forEach(f.callbacks,function(a){a(f)}),f.beat=(f.beat+1)%(d.subDiv*f.time[0]/f.time[1])}else"animationFrame"===d.source&&(d.reported=Math.round(a/1e3*d.bpm/60*d.resolution*d.subDiv/4),d.reported!==d.current&&(d.current%d.resolution>d.reported%d.resolution&&(d.beat=Math.round(d.current/d.resolution),_.forEach(f.callbacks,function(a){a(f)})),d.current=d.reported),window.requestAnimationFrame(f.tick));return f},f.tickSynced=function(){return d.sync&&d.isOn&&("webAudio"===e.master.clock.get("source")?e.master.clock.beat%Math.round(d.resolution/d.subDiv)===0&&_.forEach(f.callbacks,function(a){a(f)}):"animationFrame"===e.master.clock.get("source")&&(e.master.clock.get("cur")%(d.resolution/d.subDiv*4)<d.prev&&(d.beat=Math.round((e.master.clock.get("cur")-d.offset)/d.resolution*d.subDiv/4),_.forEach(f.callbacks,function(a){a(f)}),d.prevBeat=d.beat),d.prev=e.master.clock.get("cur")%(d.resolution/d.subDiv*4))),f},f.stop=function(){return e.log(d.isMaster?"stopping the master clock":"stopping a clock"),d.isOn===!0&&(d.isOn=!1),f},f.clear=function(){return f.callbacks=[],f},f.swing=function(a){return d.swing=a||.5,f},f.shuffle=f.swing,f.randomize=function(a){return d.random=a||0,f},f.random=f.randomize,f.rand=f.randomize,f.reset=function(){return d.offset=d.isMaster?d.current:e.master.clock.get("cur"),d.beat=0,f},f.flush=function(){return f},f.when=function(a,b){return"undefined"!=typeof a&&a.indexOf(f.beat)>-1&&"undefined"!=typeof b&&b(f),f},f.notWhen=function(a,b){return"undefined"!=typeof a&&-1==a.indexOf(f.beat)&&"undefined"!=typeof b&&b(f),f},f.on=function(a){switch(a){case"every":f.callbacks.push(function(a){a.get("beat")%arguments[1]===0&&arguments[2](a)})}return f},f.delayEvent=function(){return f},f.delay=f.delayEvent,d.isMaster||"undefined"==typeof e.master||(e.master.clock.add(f.tickSynced),d.autoStart&&f.start()),f.set(a,b,c),f},e.c=e.clock,e.instr=function(a){var b={name:"default",isPlaying:!1,poly:!1,modDest:[],modList:[],sync:!0,clock:e.clock(!0,8),instrModel:null,callbacks:[],defInstr:function(){var a=b.models.voice,c=b.models.volume.get("next"),d=b.models.dur.get("next"),f=b.models.rhythm.get("next"),g=b.models.pitch.get("next"),h=b.models.scale.get(),i=b.models.transp.get("next"),j=b.models.chord.get(),k=b.models.subdiv.get("next");b.clock.subDiv(k);var l=b.models.wavetable,m=b.models.lpf,n=b.models.comb,o=b.models.delay;b.sync===!1&&b.clock.bpm(b.models.bpm.get("next")),_.forEach(b.callbacks,function(a){a(b.clock)}),f&&_.forEach(j,function(f){l&&a.wt(l.get()),m&&a.lpf(m.get("next"),b.models.res.get("next")),n&&a.comb(.5,b.models.comb.get("next")),o&&a.delay(b.models.delay.get("next")),a.dur(d).decay(d),a.nn(e.val.pq(g+f,h,b.pqRound)+i).amp(c).play()})}},c={type:"dtm.instrument",params:[]};return c.get=function(a){switch(a){case"name":return b.name;case"isplaying":case"isPlaying":return b.isPlaying;case"c":case"clock":return b.clock;case"beat":return b.clock.get("beat");case"m":case"mod":case"model":case"models":case"modList":return c.params;case"param":case"params":}},c.set=function(a,d){switch("number"==typeof d?b.models[a]=e.array(d):d.constructor===Array?b.models[a]=e.array(d):"dtm.array"===d.type?b.models[a]=d.clone():"dtm.model"===d.type||"dtm.synth"===d.type&&(b.models[a]=d),a){case"bpm":case"tempo":break;case"div":case"subdiv":case"subDiv":}return c},c.clone=function(){return c},c.model=function(){var a=arguments[0],d="none";if("string"==typeof arguments[1]&&(d=arguments[1]),a.constructor===Array)d?b.models[d]=e.array(a):b.models.none=e.array(a);else if("object"==typeof a)"dtm.model"===a.type?"instr"===a.get("categ")?(e.log('assigning model "'+a.params.name+'" to category "'+d+'"'),b.models[d]=a,b.modDest.push(a)):a.get("categ")?(e.log('assigning model "'+a.params.name+'" to category "'+a.params.categ+'"'),b.models[a.params.categ]=a,b.modDest.push(a)):d&&(e.log('assigning model "'+a.params.name+'" to category "'+d+'"'),b.models[d]=a,b.modDest.push(a)):"dtm.array"===a.type&&(b.models[d]=a);else if("string"==typeof a){var f=_.find(e.modelColl,{params:{name:a}});"undefined"!=typeof f&&(d||(d=f.params.categ),e.log('assigning model "'+f.params.name+'" to category "'+d+'"'),b.models[d]=f,b.modDest.push(f))}return c},c.map=function(a,d){return a.constructor===Array?b.models[d]=e.array(a).normalize():"dtm.array"===a.type?b.models[d]=a.normalize():"dtm.model"===a.type,c},c.play=function(){return b.isPlaying!==!0?(b.isPlaying=!0,e.log("playing instr: "+b.name),!b.instrModel,b.instrModel&&"instr"===b.instrModel.get("categ")&&b.instrModel.output&&b.clock.add(b.instrModel.output).start(),e.master.activeInstrs.push(c)):e.log("instrument "+b.name+" is already playing!"),c},c.start=c.print=c.run=c.play,c.stop=function(){return b.isPlaying===!0&&(b.isPlaying=!1,e.log("stopping: "+b.name),b.instrModel&&"instr"===b.instrModel.params.categ&&b.instrModel.stop(),b.clock.stop(),b.clock.clear(),b.callbacks=[]),c},c.mod=function(a,b,d){var e="";return"string"==typeof a?e=a:"number"==typeof a&&(e=c.params[a]),c[e](b,d),c},c.modulate=c.mod,c.load=function(a){var d;return"string"==typeof a?d=e.modelCallers[a]():"dtm.model"===a.type&&(d=a),"undefined"!=typeof d&&(d.parent=c,d.map(c),b.instrModel=d),c},a=a||"default",c.load(a),c},e.i=e.instrument=e.instr,e.voice=e.instr,e.model=function(a,c){var d={name:null,categ:"none",categories:[],output:null},f={type:"dtm.model",parent:{},mod:{},param:{},params:{},models:{},modes:{literal:["literal","lit","l"],adapt:["adapt","adapted","adaptive","a"],preserve:["preserve","preserved","p"]}};return f.get=function(a){switch(a){case"name":return d.name;case"category":case"categ":return d.categ;default:return d.output}},f.set=function(a,b){return d.value=b,f},f.categ=function(a){return d.categ=a,f},f.load=function(a){if("string"==typeof a){var b=_.find(e.modelColl,{params:{name:a}});"undefined"!=typeof b?(e.log("overriding an existing model: "+a),f=b):("string"==typeof c&&(d.categ=c),e.log("registering a new model: "+a),d.name=a,e.modelColl.push(f))}return f},f.start=function(){return f},f.stop=function(){return f},f.morphArrays=function(){return f},f.clone=function(){return b(f)},f.assignMethods=function(a){return _.forEach(f.mod,function(b,c){a[c]=b,a.params.push(c)}),_.forEach(f.param,function(b,c){a[c]=b,a.params.push(c)}),f},f.map=f.assignMethods,f.register=function(){return e.modelCallers[f.get("name")]=arguments.callee.caller,f},f.load(a),f},e.m=e.model,e.synth=function(a,b){var c={type:"sine",note:{delay:0,duration:1},output:{gain:.5},buffer:null,amp:{gain:.5,adsr:[.001,.2,0,.001]},pitch:{freq:440,noteNum:69},wt:{isOn:!1,wt:null},lpf:{isOn:!1,cof:4e3,res:1},detune:{isOn:!1,amount:0,spread:0},delay:{isOn:!1,amount:0,time:.3,sync:!1,note:6,feedback:.3,stereo:!1},verb:{isOn:!1,amount:0},comb:{isOn:!1,amount:0,nn:69}},d=null;e.wa.isOn&&(d=e.wa.makeNoise(8192));var f={type:"dtm.synth",promise:null};return f.get=function(a){var b=null;switch(a){case"amp":b=c.amp.gain;break;case"volume":case"gain":b=c.output.gain;break;case"frequency":case"freq":case"cps":b=c.pitch.freq;break;case"noteNum":case"notenum":case"note":case"nn":b=c.pitch.noteNum;break;case"buffer":b=c.buffer}return b},f.set=function(a){switch(a){case"sin":case"sine":c.type="sine";break;case"saw":case"sawtooth":c.type="saw";break;case"sq":case"square":c.type="square";break;case"tri":case"triangle":c.type="triangle";break;case"wn":case"noise":case"rand":case"random":c.type="noise";break;case"click":case"impulse":c.type="click";break;case"wt":case"wavetable":c.type="wavetable",f.wt(arguments[1]);break;case"sampler":c.type="sampler"}return f},f.wt=function(a){c.wt.isOn=!0,"undefined"==typeof a&&(a=[0]);for(var b=[0,1],d=0;d<a.length;d++)b.push(a[d]);var g=new Float32Array(b),h=g;return c.wt.wt=e.wa.actx.createPeriodicWave(g,h),f},f.adsr=function(){return"undefeined"!=typeof arguments&&(c.amp.adsr[0]=arguments[0]||.001,c.amp.adsr[1]=arguments[1]||.001,c.amp.adsr[2]=arguments[2],c.amp.adsr[3]=arguments[3]||.001),f},f.load=function(a,b){var d=e.wa.actx;if(c.type="sampler","AudioBuffer"===a.constructor.name)return c.buffer=a,f;var g=new Promise(function(g){if("string"==typeof a){var h=new XMLHttpRequest;h.open("GET",a,!0),h.responseType="arraybuffer",h.onreadystatechange=function(){4==h.readyState&&200==h.status&&d.decodeAudioData(h.response,function(a){c.buffer=a,g(f),"undefined"!=typeof b&&b(a)})},h.send()}else if("ArrayBuffer"===a.constructor.name)d.decodeAudioData(a,function(a){c.buffer=a,g(f),"undefined"!=typeof b&&b(f)});else if(a.constructor===Array){var i=d.createBuffer(1,a.length,e.wa.actx.sampleRate),j=i.getChannelData(0);_.forEach(j,function(b,c){j[c]=a[c]}),c.buffer=i,g(f),"undefined"!=typeof b&&b(f)}});return g.play=function(){g.then(function(a){a.play()})},f.promise=g,g},f.play=function(a,b){var g=e.wa.actx,h=e.wa.now,i=e.wa.out;a=a||0,b=b||c.note.duration;var j,k=h()+a;if("noise"===c.type)j=g.createBufferSource(),d||(d=e.wa.makeNoise(8192)),j.buffer=d,j.loop=!0;else if("sampler"===c.type)j=g.createBufferSource(),j.buffer=c.buffer,j.playbackRate=1,j.loop=!1;else if("click"===c.type){j=g.createBufferSource();var l=g.createBuffer(1,2,e.sr),m=l.getChannelData(0);m[1]=1,j.buffer=l,j.playbackRate=1,j.loop=!1}else j=g.createOscillator(),j.frequency.setValueAtTime(c.pitch.freq,k);switch(c.type){case"sine":j.type="sine";break;case"saw":j.type="sawtooth";break;case"square":j.type="square";break;case"triange":j.type="triangle"}c.wt.isOn&&j.setPeriodicWave(c.wt.wt);var n=g.createGain();if(c.lpf.isOn){var o=g.createBiquadFilter();o.type="lowpass",o.frequency.setValueAtTime(c.lpf.cof,k),o.Q.setValueAtTime(c.lpf.res,k),j.connect(o),o.connect(n)}else j.connect(n);if(c.comb.isOn){var p=g.createDelay();p.delayTime.setValueAtTime(1/e.val.mtof(c.comb.nn),k);var q=g.createGain();q.gain.setValueAtTime(c.comb.amount,k);var r=g.createGain();r.gain.setValueAtTime(.95,k),n.connect(p),p.connect(q),p.connect(r),r.connect(p),q.connect(i())}if(c.delay.isOn){var s=g.createDelay();s.delayTime.setValueAtTime(c.delay.time,k);var t=g.createGain();t.gain.setValueAtTime(c.delay.amount,k);var u=g.createGain();u.gain.setValueAtTime(c.delay.feedback,k),n.connect(s),s.connect(t),s.connect(u),u.connect(s),t.connect(i())}if(c.verb.isOn){var v=g.createConvolver();v.buffer=e.wa.buffs.verbIr;var w=g.createGain();w.gain.setValueAtTime(c.verb.amount,k),n.connect(v),v.connect(w),w.connect(i())}var x=g.createGain();x.gain.setValueAtTime(c.output.gain,k),n.connect(x),x.connect(i());var y=c.amp.adsr[2]*c.amp.gain;n.gain.setValueAtTime(0,h()),n.gain.setTargetAtTime(c.amp.gain,k,c.amp.adsr[0]),n.gain.setTargetAtTime(y,k+c.amp.adsr[0],c.amp.adsr[1]);var z=k+c.amp.adsr[0]+c.amp.adsr[1]+b;return n.gain.setTargetAtTime(0,z,c.amp.adsr[3]),j.start(k),j.stop(z+c.amp.adsr[3]+.3),f},f.run=function(){return f},f.stop=function(a){return a=a||0,f},f.nn=function(a){return a=a||69,c.pitch.noteNum=a,c.pitch.freq=e.value.mtof(a),f},f.freq=function(a){return c.pitch.freq=a,f},f.amp=function(a){return c.amp.gain=a,f},f.dur=function(a){return c.note.duration=a,f},f.attr=function(a){var b=_.keys(a);return _.forEach(b,function(b){"undefined"!=typeof f[b]&&(f[b]=a[b])}),f},f.attack=function(a){return c.amp.adsr[0]=a,f},f.decay=function(a){return c.amp.adsr[1]=a,f},f.sustain=function(a){return c.amp.adsr[2]=a,f},f.release=function(a){return c.amp.adsr[3]=a,f},f.atk=f.attack,f.dcy=f.decay,f.sus=f.sustain,f.rel=f.release,f.lpf=function(a,b){return c.lpf.isOn=!0,c.lpf.cof=a||4e3,c.lpf.res=b||1,f},f.verb=function(a){return c.verb.isOn=!0,c.verb.amount=a,f},f.reverb=f.verb,f.delay=function(a,b,d,e){return c.delay.isOn=!0,c.delay.amount=a||0,c.delay.time=b||.3,c.delay.feedback=d||.3,c.delay.stereo=e||!1,f},f.comb=function(a,b){return c.comb.isOn=!0,c.comb.amount=a||0,c.comb.nn=b||69,f},f.set(a,b),f},e.s=e.syn=e.synth,e.stream=function(){var b={type:"dtm.stream"};return b.query=function(b,c){a(b,function(a){c(),console.log(a)
})},b.connect=function(){return b},b.disconnect=function(){return b},b},e.str=e.stream,e.master={type:"dtm.master",params:{data:null,index:0,level:.5,mute:!1,tempo:120,time:[4,4],beat:0,measure:0,section:0,scale:[0,1,2,3,4,5,6,7,8,9,10,11],cummulatedRhythm:null,transposition:0,chord:null,tonalFunc:null,numSynthVoices:0},totalComplexity:0,complexityLimit:10,numActiveModels:0,activeInstrs:[],voices:[],numVoices:0,models:[],clock:e.clock(120,480).sync(!1),start:function(){return e.master},stop:function(){_.forEach(e.clocks,function(a){a.stop(),a.clear()}),_.forEach(e.master.activeInstrs,function(a){a.stop()}),e.clocks=[],e.master.voices=[],e.master.activeInstrs=[]},transpose:function(a){return e.master.transposition=a,e.master},pq:function(){var a;return a=0===arguments.length?_.range(12):"array"==typeof arguments[0]?arguments[0]:"string"==typeof arguments[0]?e.scales[arguments[0].toLowerCase()]:arguments,e.master.scale=a,e.master},data:function(a){return"undefined"!=typeof a&&(e.master.params.data=a),e.master},form:function(){},model:function(){return e.master},get:function(a){switch(a){case"index":return e.master.params.index;case"clock":return e.master.clock;default:return null}},set:function(){return e.master},state:null,reset:null},e.master.clock.setMaster(!0),e.master.clock.start(),e.guido={pitchClass:{"-1":"_",r:"_",0:"c",1:"d&",2:"d",3:"e&",4:"e",5:"f",6:"f#",7:"g",8:"a&",9:"a",10:"b&",11:"b"},diatonic:{c:0,d:2,e:4,f:5,g:7,a:9,b:11,_:null},nnToPitch:function(a){var b=e.guido.pitchClass[e.val.mod(a,12)],c=(a-e.val.mod(a,12))/12-4;return b+c.toString()},pitchToNn:function(a){var b=a.split(""),c=0,d=0,f=e.guido.diatonic[b[0]];return 2===b.length?d=12*(parseInt(b[1])+4):b.length>2&&("#"==b[1]?c=1:"&"==b[1]&&(c=-1),3===b.length?d="-"==b[1]?12*(parseInt(b[1]+b[2])+4):12*(parseInt(b[2])+4):4===b.length&&(d=12*(parseInt(b[2]+b[3])+4))),f+c+d}},e.inscore=function(){var a={type:"dtm.inscore",oscPort:{}};return a.setup=function(){return a.oscPort=new osc.WebSocketPort({url:"ws://localhost:8081"}),a.oscPort.open(),a},a.test=function(b){for(var c=[],d=[],f=0;f<b.length;f++){if(0===e.value.mod(f,2)){var g,h;g=b[f]}else switch(h=b[f],d=[g,h].join(", ")){case"1, 0":c.push("a/4");break;case"1, 1":c.push("a/8"),c.push("a/8");break;case"0, 0":c.push("_/4");break;case"0, 1":c.push("_/8"),c.push("a/8")}}return c=c.join(" "),a.oscPort.send({address:"/ITL/scene/score",args:["write",c]}),a},a.write=function(b){return a.oscPort.send({address:"/ITL/scene/score",args:["write",b]}),a},a},function(){function a(a,b){"number"==typeof a?c.modules[b]=e.array(a):"string"==typeof a?c.modules[b]=e.array("str",a).classify():a.constructor===Array?c.modules[b]=e.array(a):"dtm.array"===a.type?c.modules[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(c.modules[b]=a)}var b=e.model("clave","instr").register(),c={modules:{voice:e.synth(),base:e.array([3,3,4,2,4]).itob(),target:e.array([2,1,2,1]).itob(),res:e.array([3,3,4,2,4]).itob(),morph:e.array(0)}};return b.output=function(a){a.div(16);var b=c.modules.voice,d=(c.modules.morph.get("next"),c.modules.res.get("next"));d&&b.play()},b.mod.morph=function(d,e){a(d,"morph"),b.modes.literal.indexOf(e)>-1||(b.modes.preserve.indexOf(e)>-1?c.modules.morph.normalize(0,1):c.modules.morph.normalize())},b.mod.target=function(c,d){a(c,"target"),b.modes.literal.indexOf(d)>-1||b.modes.preserve.indexOf(d)>-1},b}(),function(){function a(a,b){"number"==typeof a?c.modules[b]=e.array(a):"string"==typeof a?c.modules[b]=e.array("str",a).classify():a.constructor===Array?c.modules[b]=e.array(a):"dtm.array"===a.type?c.modules[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(c.modules[b]=a)}var b=e.model("default","instr").register(),c={clock:e.clock(!0,8),sync:!0,callbacks:[],modules:{voice:e.synth(),wavetable:null,volume:e.array(1),scale:e.array().fill("seq",12),rhythm:e.array(1),pitch:e.array(69),transp:e.array(0),chord:e.array(0),bpm:e.array(120),subdiv:e.array(8),repeats:null,step:null,atk:null,dur:e.array(.25),lpf:null,res:e.array(0),comb:null,delay:null},pqRound:!1};return b.output=function(a){var b=c.modules.voice,d=c.modules.volume.get("next"),f=c.modules.dur.get("next"),g=c.modules.rhythm.get("next"),h=c.modules.pitch.get("next"),i=c.modules.scale.get(),j=c.modules.transp.get("next"),k=c.modules.chord.get(),l=c.modules.subdiv.get("next");a.subDiv(l);var m=c.modules.wavetable,n=c.modules.lpf,o=c.modules.comb,p=c.modules.delay;c.sync===!1&&a.bpm(c.modules.bpm.get("next")),_.forEach(c.callbacks,function(a){a(c.clock)}),g&&_.forEach(k,function(a){m&&b.wt(m.get()),n&&b.lpf(n.get("next"),c.modules.res.get("next")),o&&b.comb(.5,c.modules.comb.get("next")),p&&b.delay(c.modules.delay.get("next")),b.dur(f).decay(f),b.nn(e.val.pq(h+a,i,c.pqRound)+j).amp(d).play()})},b.param.voice=function(a){return"string"==typeof a?c.modules.voice.set(a):"dtm.synth"===a.type&&(c.modules.voice=a),b.parent},b.mod.syn=b.mod.synth=b.mod.voice,b.mod.wt=function(d,e){return a(d,"wavetable"),b.modes.literal.indexOf(e)>-1||(b.modes.preserve.indexOf(e)>-1?c.modules.wavetable.range(0,1,0,1):c.modules.wavetable.normalize()),b.parent},b.mod.wf=b.mod.wavetable=b.mod.wt,b.mod.at=function(c){return a(c,"at"),b.parent},b.mod.rhythm=function(d,e){return a(d,"rhythm"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.rhythm.normalize().round(),b.parent},b.mod.beats=b.mod.rhythm,b.mod.volume=function(d,e){return a(d,"volume"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.volume.logCurve(5,0,1).rescale(.1,1),b.parent},b.mod.amp=b.mod.level=b.mod.vol=b.mod.volume,b.mod.pitch=function(d,e,f){return a(d,"pitch"),b.modes.literal.indexOf(e)>-1||(b.modes.preserve.indexOf(e)>-1?c.modules.pitch.rescale(60,90,0,1):c.modules.pitch.rescale(60,90)),f&&c.modules.pitch.round(),b.parent},b.mod.nn=b.mod.noteNum=b.mod.pitch,b.mod.transpose=function(d,e,f){return a(d,"transp"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.transp.normalize().scale(-12,12),f&&c.modules.transp.round(),b.parent},b.mod.tr=b.mod.transp=b.mod.transpose,b.mod.scale=function(d,e,f){return c.pqRound="undefined"==typeof f?!1:f,a(d,"scale"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.scale.normalize().scale(0,11).round().unique().sort(),b.parent},b.mod.pq=b.mod.scale,b.mod.chord=function(d,e){return a(d,"chord"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||(c.modules.chord.normalize().scale(0,12).round().unique().sort(),c.modules.chord.get("len")>4&&c.modules.chord.fit(4).round().unique().sort()),b.parent},b.param.clock=function(a,c){return b.parent.get("clock").bpm(a),b.parent.get("clock").subDiv(c),b.parent},b.mod.bpm=function(d,e){return c.sync=!1,a(d,"bpm"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.bpm.normalize().scale(60,180),b.parent},b.mod.tempo=b.mod.bpm,b.mod.subDiv=function(d,e){return a(d,"subdiv"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.subdiv.normalize().scale(1,5).round().powof(2),b.parent},b.mod.len=b.mod.note=b.mod.div=b.mod.subdiv=b.mod.subDiv,b.param.sync=function(a){return"undefined"==typeof a&&(a=!0),c.clock.sync(a),c.sync=a,b.parent},b.mod.lpf=function(d,e){return a(d,"lpf"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.lpf.normalize().exp(3,0,1).scale(500,5e3),b.parent},b.mod.res=function(d,e){return a(d,"res"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.res.normalize().scale(0,50),b.parent},b.mod.comb=function(d,e){return a("comb",d),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.comb.normalize().rescale(60,90),b.parent},b.mod.delay=function(d,e){return a(d,"delay"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.delay.normalize(),b.parent},b.mod.dur=function(d,e){return a(d,"dur"),b.modes.literal.indexOf(e)>-1||b.modes.preserve.indexOf(e)>-1||c.modules.dur.normalize().exp(10,0,1).scale(.01,.5),b.parent},b.mod.on=function(a){switch(a){case"note":c.callbacks.push(arguments[1]);break;case"every":case"beat":var d=arguments[1],e=arguments[2];c.callbacks.push(function(a){a.get("beat")%d===0&&e(a)});break;case"subDiv":case"subdiv":case"div":}return b.parent},b.mod.when=b.mod.on,b}(),function(){var a=e.model("testInstr","instr").register();return a.mod.doThis=function(){return console.log("doing this"),a.parent},a.mod.testSetter=function(b,c){return console.log("testing"),"undefined"==typeof c&&(c=!0),a.parent},a}(),function(){function a(a,c){"number"==typeof c?b.modules[a]=e.array(c):"string"==typeof c?b.modules[a]=e.array(c).classify():c.constructor===Array?b.modules[a]=e.array(c):"dtm.array"===c.type?b.modules[a]="string"===c.get("type")?c.clone().classify():c.clone():"dtm.model"===c.type||"dtm.synth"===c.type&&(b.modules[a]=c)}var b={clock:e.clock(!0,16),sync:!0,callbacks:[],measures:4,time:"4/4",modules:{voice:e.synth(),wavetable:null,volume:e.array(1),scale:e.array().fill("seq",12),rhythm:e.array(1),pitch:e.array().fill("line",8,60,72).round(),transp:e.array(0),chord:e.array(0),repeats:null,step:null,dur:e.array().fill("consts",8,16),bpm:e.array(120),subdiv:e.array(16)}},c=e.model("testNotation","instr").register(),d=e.guido,f=e.osc;return c.output=function(){f.start();for(var a=b.time.split("/"),g=(a[0]/a[1]*b.measures,[]),h=[],i=[],j=b.modules.subdiv.get(),k=b.modules.pitch.get(),l=b.modules.dur.get(),m=0;8>m;m++)h[m]=d.pitchClass[e.val.mod(k[m],12)],i[m]=(k[m]-e.val.mod(k[m],12))/12-4,g[m]=h[m]+i[m].toString()+"*"+l[m]+"/"+j[0];return g=g.join(" "),f.send('[\\instr<"Flute", dx=-1.65cm, dy=-0.5cm>\\meter<"4/4"> \\clef<"f"> '+g+"]"),c.parent},c.param.measures=function(a){return b.measures=a,c.parent},c.mod.pitch=function(d,e){return a("pitch",d),e?b.modules.pitch.round():b.modules.pitch.normalize().rescale(60,90).round(),c.parent},c.mod.subDiv=function(d,e){return a("subdiv",d),e?b.modules.subdiv.round():b.modules.subdiv.normalize().scale(1,5).round().powof(2),c.parent},c.mod.dur=function(d,e){return a("dur",d),e?b.modules.dur.round():(b.modules.dur.normalize(),b.modules.dur.mult(b.measures*b.modules.subdiv.get(0)/b.modules.dur.get("sum")).round()),c.parent},c.mod.len=c.mod.note=c.mod.div=c.mod.subdiv=c.mod.subDiv,c}(),function(){function a(a,b){"number"==typeof a?f[b]=e.array(a):"string"==typeof a?f[b]=e.array("str",a).classify():a.constructor===Array?f[b]=e.array(a):"dtm.array"===a.type?f[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(f[b]=a)}function b(a,b,c){for(var d=0;d<a.length;d++)if(a[d].indexOf("*")>-1&&-1===a[d].indexOf("_")){var f=e.guido.pitchToNn(a[d].split("*")[0]);a[d]="{"+a[d];for(var g=0;g<b.length;g++)if(0!==b[g]){var h=f+b[g];c&&(h=e.val.pq(h,c,!0)),a[d]+=", ",a[d]+=e.guido.nnToPitch(h)}a[d]+="}"}return a}var c=e.model("decatur","instr").register(),d={name:"Flute",score:!0,midi:!0,staves:1,clef:"g",durFx:["rest","stacc","half","normal","tenuto","slur"],dynFx:["pp","p","mp","mf","f","ff"],bpm:e.master.clock.get("bpm"),voice:"mono",measures:4,time:"4/4",div:16,update:1,repeat:2,repMap:[2,3,3,3,4,5,5,6,6,6,7,7,8,9],divMap:[16,8,16,8,16],range:{Flute:[60,75,91],Cello:[36,48,72],Piano:[60,72,84],PianoL:[36,48,60],Pad:[36,54,72],Bass:[48,54,60]},scale:[[0,2,7,9],[2,5,7],[0,2,5,7,10],[0,2,5,7],[0,2,4,7,9],[0,2,4,6,7],[2,4,6,7,9]],celloFx:["arc","pizz"],callbacks:[]},f={pitch:e.array().fill("random",8,60,72).round(),range:e.array(.3),scale:e.array(d.scale[d.scale.length-1]),scaleSel:e.array(2),transp:e.array(0),chord:e.array(0),pos:e.array(0),div:e.a(Math.round(d.divMap.length/2)),repeat:e.array(1),note:e.array().fill("ones",8),dur:e.array().fill("ones",8),dyn:e.array().fill("zeros",8),activity:e.array(0)},g=(e.guido,e.osc);return c.output=function(a){a.div(d.div);var h=d.repeat,i=d.div*d.measures;a.get("beat")%(i*d.update)===0&&_.forEach(d.callbacks,function(b){b(a)});var j=f.scale.get(),k=f.chord.get(),l=Math.round(i/h),m=f.pitch.clone().fit(l,"linear").log(10).round(),n=f.note.clone().scale(.1,1).fit(l,"linear").fitSum(l,!0),o=f.activity.clone().fit(l,"linear").round(),p=f.transp.clone().fit(l,"linear").round();if(d.score&&("Flute"===d.name||"Piano"===d.name||"PianoL"===d.name||"Cello"===d.name)&&a.get("beat")%(i*d.update)===0){var q,r,s=[],t=!1,u=0,v=0,w=!1,x=f.dur.clone().fit(l,"step").scale(0,5).round(),y=f.dyn.clone().fit(l,"step");d.durFx[2]=d.div<=16?"stacc":"half";for(var z=0;i>z;z++){s[z]="";var A=m.get("next"),B=n.get("next"),C=x.get("next"),D=(y.get("current"),y.get("next"),o.get("next")),E=p.get("next");B>1&&B+u%4>4&&(w=!0,r=(B+u)%4,0==r&&(r=4),q=B-r),u+=B,z==i-1&&(v=i-u,w?r+=v:B+=v),0==r&&(B=q,w=!1);var F="";F+=e.guido.nnToPitch(e.val.pq(A+E,j,!0)),("rest"==d.durFx[C]||0===D)&&(F="_",t&&(s[z-1]+=" \\slurEnd",t=!1)),"slur"==d.durFx[C]&&0!==D&&(t||z===i-1||(s[z]+="\\slurBegin ",t=!0)),"half"==d.durFx[C]&&0!==D?w?(s[z]+=F+"*"+q+"/"+2*d.div+"_*"+q+"/"+2*d.div,s[z]+=",",s[z]+=F+"*"+r+"/"+2*d.div+"_*"+r+"/"+2*d.div):0!==B&&(s[z]+=F+"*"+B+"/"+2*d.div+"_*"+B+"/"+2*d.div):w&&"rest"!=d.durFx[C]&&0!==D?(s[z]+="\\tieBegin \\space<4> "+F+"*"+q+"/"+d.div,s[z]+=" , ",s[z]+=F+"*"+r+"/"+d.div+" \\tieEnd"):0!==B&&(s[z]+=F+"*"+B+"/"+d.div),0!==D&&!t&&d.div>=4&&""!=s[z]&&"PianoL"!==d.name&&("stacc"==d.durFx[C]?s[z]="\\stacc( "+s[z]+" )":"tenuto"==d.durFx[C]&&(s[z]="\\ten( "+s[z]+" )")),"rest"!==d.durFx[C]&&"stacc"!==d.durFx[C]&&"tenuto"!==d.durFx[C]&&2===D&&1===k.length&&""!=s[z]&&"PianoL"!==d.name&&(s[z]="\\accent( "+s[z]+" )"),("slur"!=d.durFx[C]&&t||z==i-1&&t)&&(s[z]+=" \\slurEnd",t=!1),w=!1}for(var z=s.length-1;z>=0;z--)""===s[z]&&s.splice(z,1);for(var z=s.length-1;z>0;z--)s[z].indexOf("_")>-1&&s[z-1].indexOf("_")>-1&&(s[z-1]="_*"+(parseInt(s[z].substr(s[z].indexOf("*")+1,s[z].indexOf("/")-s[z].indexOf("*")-1))+parseInt(s[z-1].substr(s[z-1].indexOf("*")+1,s[z-1].indexOf("/")-s[z-1].indexOf("*")-1)))+"/"+d.div,s[z]="");for(var z=0;z<s.length;z++)if(s[z].indexOf(",")>-1){var G=s[z].split(",");s[z]=G[0],s.splice(z+1,0,G[1])}for(var z=s.length-1;z>0;z--)""===s[z]&&s.splice(z,1);for(var z=0;z<s.length;z++)if(s[z].indexOf(" ")>-1)for(var G=s[z].split(" "),H=0;H<G.length-1;H++)s[z+H]=G[H],s.splice(z+1+H,0,G[H+1]);f.chord.get("len")>1&&(s=b(s,k,j));var I='\\staffFormat<"5-line",';I+=1===s.length?"size=1.3pt>":s.length<50?"size=1.3pt>":s.length<100?"size=2pt>":"size=3pt>";var J="\\staff<";switch(d.name){case"Flute":J+="1";break;case"Cello":J+="2";break;case"Piano":J+="3";break;case"PianoL":J+="4"}if(1===s.length)J+=",5mm>";else switch(d.name){case"Flute":J+=",14mm>";break;case"Cello":J+=",14mm>";break;case"Piano":J+=",10mm>";break;case"PianoL":J+=",10mm>"}s=s.join(" ");var K="";"Flute"===d.name||"Cello"===d.name?K+='\\instr<"'+d.name+'", dx=-1.65cm, dy=-0.5cm>':"Piano"===d.name&&(K+='\\instr<"'+d.name+'", dx=-1.65cm, dy=-1.3cm>');var L='\\clef<"'+d.clef+'">';"PianoL"===d.name&&(L="");var M='\\meter<"'+d.time+'">',N="",O="";"Flute"===d.name&&(N='\\set<autoSystemBreak="off">',O="\\pageFormat<30cm, 10cm, 2cm, 5cm, 2cm, 5cm>"),g.send("/decatur/score",[d.name,"["+O+N+K+L+M+s+" \\space<6> \\repeatEnd]"])}if(d.midi&&a.get("beat")%(i*d.update)===0){d.bpm=e.master.clock.get("bpm");for(var P=[],Q=60/d.bpm*4/d.div,C=f.dur.clone().fit(l,"step").scale(0,5).round().normalize(),R=0,H=0;H<d.update;H++){m.index(l-1),n.index(l-1),C.index(l-1),o.index(l-1),R=i*H;for(var z=0;i>z;z++){var S=n.get("next"),A=m.get("next"),T=C.get("next"),D=o.get("next"),E=p.get("next");if(0!==S){if(0!==T&&0!==D){var U=R*Q+e.val.rand(0,.01),V=S*T*Q*.95;if(f.chord.get("len")>1)for(var W=0;W<k.length;W++){var X=e.val.pq(A+E,j,!0);P.push([U,V,e.val.pq(X+k[W],j,!0)])}else P.push([U,V,e.val.pq(A+E,j,!0)])}R+=S}}}for(var z=0;z<P.length;z++)"undefined"!=typeof P[z]&&e.osc.send("/decatur/midi",[d.name].concat(P[z]))}return c.parent},c.param.get=function(a){switch(a){case"score":break;case"midi":break;case"a":case"array":return f[arguments[1]]}return c.parent},c.param.score=function(a){return d.score=a,c.parent},c.param.midi=function(a){return d.midi=a,c.parent},c.param.name=function(a){switch(d.name=a,d.name){case"Flute":d.clef="g";break;case"Cello":d.clef="f";break;case"Piano":d.clef="g";break;case"PianoL":d.clef="f"}return c.parent},c.param.measures=function(a){return d.measures=a,c.parent},c.param.update=function(a){return d.update=a,c.parent},c.param.clef=function(a){return d.clef=a,c.parent},c.param.staves=function(a){return d.staves=a,c.parent},c.param.onUpdate=function(a){return d.callbacks.push(a),c.parent},c.mod.pitch=function(b,e){return a(b,"pitch"),c.modes.literal.indexOf(e)>-1?f.pitch.round():c.modes.preserve.indexOf(e)>-1?"Flute"===d.name?f.pitch.rescale(60,96,0,1).round():"Cello"===d.name?f.pitch.rescale(36,72,0,1).round():"Piano"===d.name?f.pitch.rescale(60,84,0,1).round():"PianoL"===d.name?f.pitch.rescale(36,60,0,1).round():"Bass"===d.name?f.pitch.rescale(48,65,0,1).round():f.pitch.rescale(60,96,0,1).round():"Flute"===d.name?f.pitch.rescale(60,96).round():"Cello"===d.name?f.pitch.rescale(36,72).round():"Piano"===d.name?f.pitch.rescale(60,84).round():"PianoL"===d.name?f.pitch.rescale(36,60).round():"Bass"===d.name?f.pitch.rescale(48,65).round():f.pitch.rescale(60,96).round(),c.parent},c.mod.range=function(b,d){return a(b,"range"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1||f.range.exp(2,0,1).scale(.2,.8),c.parent},c.mod.transpose=function(b,d){return a(b,"transp"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1,c.parent},c.mod.tr=c.mod.transp=c.mod.transpose,c.mod.scale=function(b,e){return c.modes.literal.indexOf(e)>-1?a(b,"scale"):c.modes.preserve.indexOf(e)>-1?(a(b,"scaleSel"),f.scaleSel.rescale(0,d.scale.length-1,0,1).round(),f.scale.set(d.scale[f.scaleSel.get("mode")])):(a(b,"scaleSel"),f.scaleSel.rescale(0,d.scale.length-1).round(),f.scale.set(d.scale[f.scaleSel.get("mode")])),c.parent},c.mod.chord=function(b,d){return a(b,"chord"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1,c.parent},c.mod.pq=c.mod.scale,c.mod.div=function(b,e){return a(b,"div"),c.modes.literal.indexOf(e)>-1?d.div=f.div.round().get("mode"):c.modes.preserve.indexOf(e)>-1||(f.div.range(0,d.divMap.length-1).round(),d.div=d.divMap[f.div.get("mode")]),c.parent},c.mod.activity=function(b,d){return a(b,"activity"),c.modes.literal.indexOf(d)>-1||(c.modes.preserve.indexOf(d)>-1?f.activity.scale(0,2,0,1).round():f.activity.scale(0,2).round()),c.parent},c.mod.ac=c.mod.activity,c.mod.note=function(b,d){return a(b,"note"),c.modes.literal.indexOf(d)>-1?f.note.round():c.modes.preserve.indexOf(d)>-1,c.parent},c.mod.dur=function(b,d){return a(b,"dur"),c.modes.literal.indexOf(d)>-1||(c.modes.preserve.indexOf(d)>-1?f.dur.normalize(0,1):f.dur.normalize()),c.parent},c.mod.dyn=function(b,d){return a(b,"dyn"),c.modes.literal.indexOf(d)>-1||(c.modes.preserve.indexOf(d)>-1?f.dyn.scale(0,5,0,1).round():f.dyn.scale(0,5).round()),c.parent},c.mod.density=function(b,d){return a(b,"density"),c.modes.literal.indexOf(d)>-1||c.modes.preserve.indexOf(d)>-1||f.density.scale(1,32).exp(5,0,1),c.parent},c.mod.repeat=function(b,e){return a(b,"repeat"),c.modes.literal.indexOf(e)>-1?d.repeat=b:c.modes.preserve.indexOf(e)>-1?(f.repeat.rescale(0,d.repMap.length-1,0,1).round(),d.repeat=d.repMap[f.repeat.get("mode")]):(f.repeat.rescale(0,d.repMap.length-1).round(),d.repeat=d.repMap[f.repeat.get("mode")]),c.parent},c.mod.rep=c.mod.repeat,c}(),function(){function a(a,b){"number"==typeof a?c[b]=e.array(a):"string"==typeof a?c[b]=e.array(a).classify():a.constructor===Array?c[b]=e.array(a):"dtm.array"===a.type?c[b]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(c[b]=a)}var b=e.model("csd","instr").register(),c={pitch:e.a(60),div:e.a(8)},d=null;return"undefined"!=typeof csound&&(d=csound),b.output=function(a){var e=c.pitch.get("next");return a.div(c.div.get("next")),d.Event("i1 0 0.2 "+e),b.parent},b.mod.pitch=function(d,e){return a(d,"pitch"),e||c.pitch.normalize().scale(60,90),b.parent},b.mod.div=function(d,e){return a(d,"div"),e||c.div.normalize().scale(0,5).round().powof(2),b.parent},b.mod.file=function(){return b.parent},b}(),function(){function a(a,c){"number"==typeof a?b.modules[c]=e.array(a):"string"==typeof a?b.modules[c]=e.array(a).classify():a.constructor===Array?b.modules[c]=e.array(a):"dtm.array"===a.type?b.modules[c]="string"===a.get("type")?a.clone().classify():a.clone():"dtm.model"===a.type||"dtm.synth"===a.type&&(b.modules[c]=a)}var b=e.model("csd-osc","instr").register(),c={iNum:1};return b.modules={pitch:e.a(72),div:e.a(16)},b.output=function(a){var d=b.modules.pitch.get("next"),f=b.modules.div.get("next");a.div(f);var g=c.iNum;return g="number"==typeof g?"i".concat(g):'i\\"'+g+'\\"',e.osc.send("/csd/event",[g,0,.1,d]),b.parent},b.mod.pitch=function(c,d){return a(c,"pitch"),d||b.modules.pitch.normalize().rescale(60,90).round(),b.parent},b.mod.div=function(c,d){return a(c,"div"),d||b.modules.div.normalize().scale(1,5).round().powof(2),b.parent},b.param.name=function(a){return c.iNum=a,b.parent},b}()}();