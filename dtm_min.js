(function(){function a(a,b,c){c=(c||0)-1;for(var d=a?a.length:0;++c<d;)if(a[c]===b)return c;return-1}function b(b,c){var d=typeof c;if(b=b.l,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:r+c;return b=(b=b[d])&&b[e],"object"==d?b&&-1<a(b,c)?0:-1:b?0:-1}function c(a){var b=this.l,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:r+a,b=b[c]||(b[c]={});"object"==c?(b[d]||(b[d]=[])).push(a):b[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){for(var c=a.m,d=b.m,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.n-b.n}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;for(e=i(),e["false"]=e["null"]=e["true"]=e.undefined=!1,f=i(),f.k=a,f.l=e,f.push=c;++b<d;)f.push(a[b]);return f}function g(a){return"\\"+U[a]}function h(){return o.pop()||[]}function i(){return p.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,o:null}}function j(a){a.length=0,o.length<t&&o.push(a)}function k(a){var b=a.l;b&&k(b),a.k=a.l=a.m=a.object=a.number=a.string=a.o=null,p.length<t&&p.push(a)}function l(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);var d=-1;c=c-b||0;for(var e=Array(0>c?0:c);++d<c;)e[d]=a[b+d];return e}function m(c){function o(a,b,c){if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(var d=-1,e=T[typeof a]&&Kc(a),f=e?e.length:0;++d<f&&(c=e[d],!1!==b(a[c],c,a)););return a}function p(a,b,c){var d;if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(d in a)if(!1===b(a[d],d,a))break;return a}function t(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if((e=g[h])&&T[typeof e])for(var j=-1,k=T[typeof e]&&Kc(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f}function U(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=bb(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if((e=g[h])&&T[typeof e])for(var k=-1,l=T[typeof e]&&Kc(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f}function W(a){var b,c=[];if(!a||!T[typeof a])return c;for(b in a)rc.call(a,b)&&c.push(b);return c}function X(a){return a&&"object"==typeof a&&!Jc(a)&&rc.call(a,"__wrapped__")?a:new Y(a)}function Y(a,b){this.__chain__=!!b,this.__wrapped__=a}function Z(a){function b(){if(d){var a=l(d);sc.apply(a,arguments)}if(this instanceof b){var f=ab(c.prototype),a=c.apply(f,a||arguments);return vb(a)?a:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Ic(b,a),b}function _(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}if(!vb(a))return a;var g=kc.call(a);if(!Q[g])return a;var i=Gc[g];switch(g){case J:case K:return new i(+a);case M:case P:return new i(a);case O:return f=i(a.source,z.exec(a)),f.lastIndex=a.lastIndex,f}if(g=Jc(a),b){var k=!d;d||(d=h()),e||(e=h());for(var m=d.length;m--;)if(d[m]==a)return e[m];f=g?i(a.length):{}}else f=g?l(a):U({},a);return g&&(rc.call(a,"index")&&(f.index=a.index),rc.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(g?Db:o)(a,function(a,g){f[g]=_(a,b,c,d,e)}),k&&(j(d),j(e)),f):f}function ab(a){return vb(a)?xc(a):{}}function bb(a,b,c){if("function"!=typeof a)return Ub;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Hc.funcNames&&(d=!a.name),d=d||!Hc.funcDecomp,!d)){var e=pc.call(a);Hc.funcNames||(d=!A.test(e)),d||(d=E.test(e),Ic(a,d))}if(!1===d||!0!==d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Sb(a,b)}function cb(a){function b(){var a=i?g:this;if(e){var o=l(e);sc.apply(o,arguments)}return(f||k)&&(o||(o=l(arguments)),f&&sc.apply(o,f),k&&o.length<h)?(d|=16,cb([c,m?d:-4&d,o,null,g,h])):(o||(o=arguments),j&&(c=a[n]),this instanceof b?(a=ab(c.prototype),o=c.apply(a,o),vb(o)?o:a):c.apply(a,o))}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,m=8&d,n=c;return Ic(b,a),b}function db(c,d){var e=-1,g=mb(),h=c?c.length:0,i=h>=s&&g===a,j=[];if(i){var l=f(d);l?(g=b,d=l):i=!1}for(;++e<h;)l=c[e],0>g(d,l)&&j.push(l);return i&&k(d),j}function eb(a,b,c,d){d=(d||0)-1;for(var e=a?a.length:0,f=[];++d<e;){var g=a[d];if(g&&"object"==typeof g&&"number"==typeof g.length&&(Jc(g)||qb(g))){b||(g=eb(g,b,c));var h=-1,i=g.length,j=f.length;for(f.length+=i;++h<i;)f[j++]=g[h]}else c||f.push(g)}return f}function fb(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;if(a===a&&!(a&&T[typeof a]||b&&T[typeof b]))return!1;if(null==a||null==b)return a===b;var i=kc.call(a),k=kc.call(b);if(i==H&&(i=N),k==H&&(k=N),i!=k)return!1;switch(i){case J:case K:return+a==+b;case M:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case O:case P:return a==fc(b)}if(k=i==I,!k){var l=rc.call(a,"__wrapped__"),m=rc.call(b,"__wrapped__");if(l||m)return fb(l?a.__wrapped__:a,m?b.__wrapped__:b,c,d,e,f);if(i!=N)return!1;if(i=a.constructor,l=b.constructor,i!=l&&!(ub(i)&&i instanceof i&&ub(l)&&l instanceof l)&&"constructor"in a&&"constructor"in b)return!1}for(i=!e,e||(e=h()),f||(f=h()),l=e.length;l--;)if(e[l]==a)return f[l]==b;var n=0,g=!0;if(e.push(a),f.push(b),k){if(l=a.length,n=b.length,(g=n==l)||d)for(;n--;)if(k=l,m=b[n],d)for(;k--&&!(g=fb(a[k],m,c,d,e,f)););else if(!(g=fb(a[n],m,c,d,e,f)))break}else p(b,function(b,h,i){return rc.call(i,h)?(n++,g=rc.call(a,h)&&fb(a[h],b,c,d,e,f)):void 0}),g&&!d&&p(a,function(a,b,c){return rc.call(c,b)?g=-1<--n:void 0});return e.pop(),f.pop(),i&&(j(e),j(f)),g}function gb(a,b,c,d,e){(Jc(b)?Db:o)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Jc(b))||Pc(b))){for(i=d.length;i--;)if(g=d[i]==b){j=e[i];break}if(!g){var k;c&&(i=c(j,b),k="undefined"!=typeof i)&&(j=i),k||(j=h?Jc(j)?j:[]:Pc(j)?j:{}),d.push(b),e.push(j),k||gb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function hb(a,b){return a+oc(Fc()*(b-a+1))}function ib(c,d,e){var g=-1,i=mb(),l=c?c.length:0,m=[],n=!d&&l>=s&&i===a,o=e||n?h():m;for(n&&(o=f(o),i=b);++g<l;){var p=c[g],q=e?e(p,g,c):p;(d?!g||o[o.length-1]!==q:0>i(o,q))&&((e||n)&&o.push(q),m.push(p))}return n?(j(o.k),k(o)):e&&j(o),m}function jb(a){return function(b,c,d){var e={};c=X.createCallback(c,d,3),d=-1;var f=b?b.length:0;if("number"==typeof f)for(;++d<f;){var g=b[d];a(e,g,c(g,d,b),b)}else o(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function kb(a,b,c,d,e,f){var g=1&b,h=4&b,i=16&b,j=32&b;if(!(2&b||ub(a)))throw new gc;i&&!c.length&&(b&=-17,i=c=!1),j&&!d.length&&(b&=-33,j=d=!1);var k=a&&a.__bindData__;return k&&!0!==k?(k=l(k),k[2]&&(k[2]=l(k[2])),k[3]&&(k[3]=l(k[3])),!g||1&k[1]||(k[4]=e),!g&&1&k[1]&&(b|=8),!h||4&k[1]||(k[5]=f),i&&sc.apply(k[2]||(k[2]=[]),c),j&&vc.apply(k[3]||(k[3]=[]),d),k[1]|=b,kb.apply(null,k)):(1==b||17===b?Z:cb)([a,b,c,d,e,f])}function lb(a){return Lc[a]}function mb(){var b=(b=X.indexOf)===Mb?a:b;return b}function nb(a){return"function"==typeof a&&lc.test(a)}function ob(a){var b,c;return a&&kc.call(a)==N&&(b=a.constructor,!ub(b)||b instanceof b)?(p(a,function(a,b){c=b}),"undefined"==typeof c||rc.call(a,c)):!1}function pb(a){return Mc[a]}function qb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==H||!1}function rb(a,b,c){var d=Kc(a),e=d.length;for(b=bb(b,c,3);e--&&(c=d[e],!1!==b(a[c],c,a)););return a}function sb(a){var b=[];return p(a,function(a,c){ub(a)&&b.push(c)}),b.sort()}function tb(a){for(var b=-1,c=Kc(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function ub(a){return"function"==typeof a}function vb(a){return!(!a||!T[typeof a])}function wb(a){return"number"==typeof a||a&&"object"==typeof a&&kc.call(a)==M||!1}function xb(a){return"string"==typeof a||a&&"object"==typeof a&&kc.call(a)==P||!1}function yb(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;)e[b]=a[c[b]];return e}function zb(a,b,c){var d=-1,e=mb(),f=a?a.length:0,g=!1;return c=(0>c?Cc(0,f+c):c)||0,Jc(a)?g=-1<e(a,b,c):"number"==typeof f?g=-1<(xb(a)?a.indexOf(b,c):e(a,b,c)):o(a,function(a){return++d<c?void 0:!(g=a===b)}),g}function Ab(a,b,c){var d=!0;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&(d=!!b(a[c],c,a)););else o(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Bb(a,b,c){var d=[];b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e;){var f=a[c];b(f,c,a)&&d.push(f)}else o(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Cb(a,b,c){b=X.createCallback(b,c,3),c=-1;var d=a?a.length:0;if("number"!=typeof d){var e;return o(a,function(a,c,d){return b(a,c,d)?(e=a,!1):void 0}),e}for(;++c<d;){var f=a[c];if(b(f,c,a))return f}}function Db(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof e)for(;++d<e&&!1!==b(a[d],d,a););else o(a,b);return a}function Eb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof d)for(;d--&&!1!==b(a[d],d,a););else{var e=Kc(a),d=e.length;o(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function Fb(a,b,c){var d=-1,e=a?a.length:0;if(b=X.createCallback(b,c,3),"number"==typeof e)for(var f=Zb(e);++d<e;)f[d]=b(a[d],d,a);else f=[],o(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Gb(a,b,c){var e=-1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];h>f&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),c>e&&(e=c,f=a)});return f}function Hb(a,b,c,d){if(!a)return c;var e=3>arguments.length;b=X.createCallback(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else o(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function Ib(a,b,c,d){var e=3>arguments.length;return b=X.createCallback(b,d,4),Eb(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function Jb(a){var b=-1,c=a?a.length:0,d=Zb("number"==typeof c?c:0);return Db(a,function(a){var c=hb(0,++b);d[b]=d[c],d[c]=a}),d}function Kb(a,b,c){var d;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&!(d=b(a[c],c,a)););else o(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function Lb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=X.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:n;return l(a,0,Dc(Cc(0,d),e))}function Mb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Cc(0,e+d):d||0}else if(d)return d=Ob(b,c),b[d]===c?d:-1;return a(b,c,d)}function Nb(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=X.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Cc(0,b);return l(a,d)}function Ob(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?X.createCallback(c,d,1):Ub,b=c(b);f>e;)d=e+f>>>1,c(a[d])<b?e=d+1:f=d;return e}function Pb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=X.createCallback(c,d,3)),ib(a,b,c)}function Qb(){for(var a=1<arguments.length?arguments:arguments[0],b=-1,c=a?Gb(Tc(a,"length")):0,d=Zb(0>c?0:c);++b<c;)d[b]=Tc(a,b);return d}function Rb(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Jc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Sb(a,b){return 2<arguments.length?kb(a,17,l(arguments,2),null,b):kb(a,1,null,null,b)}function Tb(a,b,c){function d(){k&&nc(k),g=k=l=n,(p||o!==b)&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null))}function e(){var c=b-(Uc()-i);c>0?k=tc(e,c):(g&&nc(g),c=l,g=k=l=n,c&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null)))}var f,g,h,i,j,k,l,m=0,o=!1,p=!0;if(!ub(a))throw new gc;if(b=Cc(0,b)||0,!0===c)var q=!0,p=!1;else vb(c)&&(q=c.leading,o="maxWait"in c&&(Cc(b,c.maxWait)||0),p="trailing"in c?c.trailing:p);return function(){if(f=arguments,i=Uc(),j=this,l=p&&(k||!q),!1===o)var c=q&&!k;else{g||q||(m=i);var n=o-(i-m),r=0>=n;r?(g&&(g=nc(g)),m=i,h=a.apply(j,f)):g||(g=tc(d,n))}return r&&k?k=nc(k):k||b===o||(k=tc(e,b)),c&&(r=!0,h=a.apply(j,f)),!r||k||g||(f=j=null),h}}function Ub(a){return a}function Vb(a,b,c){var d=!0,e=b&&sb(b);b&&(c||e.length)||(null==c&&(c=b),f=Y,b=a,a=X,e=sb(b)),!1===c?d=!1:vb(c)&&"chain"in c&&(d=c.chain);var f=a,g=ub(f);Db(e,function(c){var e=a[c]=b[c];g&&(f.prototype[c]=function(){var b=this.__chain__,c=this.__wrapped__,g=[c];if(sc.apply(g,arguments),g=e.apply(a,g),d||b){if(c===g&&vb(g))return this;g=new f(g),g.__chain__=b}return g})})}function Wb(){}function Xb(a){return function(b){return b[a]}}function Yb(){return this.__wrapped__}c=c?$.defaults(V.Object(),c,$.pick(V,G)):V;var Zb=c.Array,$b=c.Boolean,_b=c.Date,ac=c.Function,bc=c.Math,cc=c.Number,dc=c.Object,ec=c.RegExp,fc=c.String,gc=c.TypeError,hc=[],ic=dc.prototype,jc=c._,kc=ic.toString,lc=ec("^"+fc(kc).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),mc=bc.ceil,nc=c.clearTimeout,oc=bc.floor,pc=ac.prototype.toString,qc=nb(qc=dc.getPrototypeOf)&&qc,rc=ic.hasOwnProperty,sc=hc.push,tc=c.setTimeout,uc=hc.splice,vc=hc.unshift,wc=function(){try{var a={},b=nb(b=dc.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),xc=nb(xc=dc.create)&&xc,yc=nb(yc=Zb.isArray)&&yc,zc=c.isFinite,Ac=c.isNaN,Bc=nb(Bc=dc.keys)&&Bc,Cc=bc.max,Dc=bc.min,Ec=c.parseInt,Fc=bc.random,Gc={};Gc[I]=Zb,Gc[J]=$b,Gc[K]=_b,Gc[L]=ac,Gc[N]=dc,Gc[M]=cc,Gc[O]=ec,Gc[P]=fc,Y.prototype=X.prototype;var Hc=X.support={};Hc.funcDecomp=!nb(c.a)&&E.test(m),Hc.funcNames="string"==typeof ac.name,X.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:B,variable:"",imports:{_:X}},xc||(ab=function(){function a(){}return function(b){if(vb(b)){a.prototype=b;var d=new a;a.prototype=null}return d||c.Object()}}());var Ic=wc?function(a,b){S.value=b,wc(a,"__bindData__",S)}:Wb,Jc=yc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==I||!1},Kc=Bc?function(a){return vb(a)?Bc(a):[]}:W,Lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Mc=tb(Lc),Nc=ec("("+Kc(Mc).join("|")+")","g"),Oc=ec("["+Kc(Lc).join("")+"]","g"),Pc=qc?function(a){if(!a||kc.call(a)!=N)return!1;var b=a.valueOf,c=nb(b)&&(c=qc(b))&&qc(c);return c?a==c||qc(a)==c:ob(a)}:ob,Qc=jb(function(a,b,c){rc.call(a,c)?a[c]++:a[c]=1}),Rc=jb(function(a,b,c){(rc.call(a,c)?a[c]:a[c]=[]).push(b)}),Sc=jb(function(a,b,c){a[c]=b}),Tc=Fb,Uc=nb(Uc=_b.now)&&Uc||function(){return(new _b).getTime()},Vc=8==Ec(u+"08")?Ec:function(a,b){return Ec(xb(a)?a.replace(C,""):a,b||0)};return X.after=function(a,b){if(!ub(b))throw new gc;return function(){return 1>--a?b.apply(this,arguments):void 0}},X.assign=U,X.at=function(a){for(var b=arguments,c=-1,d=eb(b,!0,!1,1),b=b[2]&&b[2][b[1]]===a?1:d.length,e=Zb(b);++c<b;)e[c]=a[d[c]];return e},X.bind=Sb,X.bindAll=function(a){for(var b=1<arguments.length?eb(arguments,!0,!1,1):sb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=kb(a[e],1,null,null,a)}return a},X.bindKey=function(a,b){return 2<arguments.length?kb(b,19,l(arguments,2),null,a):kb(b,3,null,null,a)},X.chain=function(a){return a=new Y(a),a.__chain__=!0,a},X.compact=function(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d},X.compose=function(){for(var a=arguments,b=a.length;b--;)if(!ub(a[b]))throw new gc;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}},X.constant=function(a){return function(){return a}},X.countBy=Qc,X.create=function(a,b){var c=ab(a);return b?U(c,b):c},X.createCallback=function(a,b,c){var d=typeof a;if(null==a||"function"==d)return bb(a,b,c);if("object"!=d)return Xb(a);var e=Kc(a),f=e[0],g=a[f];return 1!=e.length||g!==g||vb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=fb(b[e[c]],a[e[c]],null,!0)););return d}:function(a){return a=a[f],g===a&&(0!==g||1/g==1/a)}},X.curry=function(a,b){return b="number"==typeof b?b:+b||a.length,kb(a,4,null,null,null,b)},X.debounce=Tb,X.defaults=t,X.defer=function(a){if(!ub(a))throw new gc;var b=l(arguments,1);return tc(function(){a.apply(n,b)},1)},X.delay=function(a,b){if(!ub(a))throw new gc;var c=l(arguments,2);return tc(function(){a.apply(n,c)},b)},X.difference=function(a){return db(a,eb(arguments,!0,!0,1))},X.filter=Bb,X.flatten=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=Fb(a,c,d)),eb(a,b)},X.forEach=Db,X.forEachRight=Eb,X.forIn=p,X.forInRight=function(a,b,c){var d=[];p(a,function(a,b){d.push(b,a)});var e=d.length;for(b=bb(b,c,3);e--&&!1!==b(d[e--],d[e],a););return a},X.forOwn=o,X.forOwnRight=rb,X.functions=sb,X.groupBy=Rc,X.indexBy=Sc,X.initial=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return l(a,0,Dc(Cc(0,e-d),e))},X.intersection=function(){for(var c=[],d=-1,e=arguments.length,g=h(),i=mb(),l=i===a,m=h();++d<e;){var n=arguments[d];(Jc(n)||qb(n))&&(c.push(n),g.push(l&&n.length>=s&&f(d?c[d]:m)))}var l=c[0],o=-1,p=l?l.length:0,q=[];a:for(;++o<p;){var r=g[0],n=l[o];if(0>(r?b(r,n):i(m,n))){for(d=e,(r||m).push(n);--d;)if(r=g[d],0>(r?b(r,n):i(c[d],n)))continue a;q.push(n)}}for(;e--;)(r=g[e])&&k(r);return j(g),j(m),q},X.invert=tb,X.invoke=function(a,b){var c=l(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Zb("number"==typeof f?f:0);return Db(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g},X.keys=Kc,X.map=Fb,X.mapValues=function(a,b,c){var d={};return b=X.createCallback(b,c,3),o(a,function(a,c,e){d[c]=b(a,c,e)}),d},X.max=Gb,X.memoize=function(a,b){function c(){var d=c.cache,e=b?b.apply(this,arguments):r+arguments[0];return rc.call(d,e)?d[e]:d[e]=a.apply(this,arguments)}if(!ub(a))throw new gc;return c.cache={},c},X.merge=function(a){var b=arguments,c=2;if(!vb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=bb(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var b=l(arguments,1,c),e=-1,f=h(),g=h();++e<c;)gb(a,b[e],d,f,g);return j(f),j(g),a},X.min=function(a,b,c){var e=1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];f>h&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),e>c&&(e=c,f=a)});return f},X.omit=function(a,b,c){var d={};if("function"!=typeof b){var e=[];p(a,function(a,b){e.push(b)});for(var e=db(e,eb(arguments,!0,!1,1)),f=-1,g=e.length;++f<g;){var h=e[f];d[h]=a[h]}}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)||(d[c]=a)});return d},X.once=function(a){var b,c;if(!ub(a))throw new gc;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},X.pairs=function(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e},X.partial=function(a){return kb(a,16,l(arguments,1))},X.partialRight=function(a){return kb(a,32,null,l(arguments,1))},X.pick=function(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=eb(arguments,!0,!1,1),g=vb(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d},X.pluck=Tc,X.property=Xb,X.pull=function(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(uc.call(a,f--,1),e--);return a},X.range=function(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);var d=-1;b=Cc(0,mc((b-a)/(c||1)));for(var e=Zb(b);++d<b;)e[d]=a,a+=c;return e},X.reject=function(a,b,c){return b=X.createCallback(b,c,3),Bb(a,function(a,c,d){return!b(a,c,d)})},X.remove=function(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=X.createCallback(b,c,3);++d<e;)c=a[d],b(c,d,a)&&(f.push(c),uc.call(a,d--,1),e--);return f},X.rest=Nb,X.shuffle=Jb,X.sortBy=function(a,b,c){var d=-1,f=Jc(b),g=a?a.length:0,l=Zb("number"==typeof g?g:0);for(f||(b=X.createCallback(b,c,3)),Db(a,function(a,c,e){var g=l[++d]=i();f?g.m=Fb(b,function(b){return a[b]}):(g.m=h())[0]=b(a,c,e),g.n=d,g.o=a}),g=l.length,l.sort(e);g--;)a=l[g],l[g]=a.o,f||j(a.m),k(a);return l},X.tap=function(a,b){return b(a),a},X.throttle=function(a,b,c){var d=!0,e=!0;if(!ub(a))throw new gc;return!1===c?d=!1:vb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),R.leading=d,R.maxWait=b,R.trailing=e,Tb(a,b,R)},X.times=function(a,b,c){a=-1<(a=+a)?a:0;var d=-1,e=Zb(a);for(b=bb(b,c,1);++d<a;)e[d]=b(d);return e},X.toArray=function(a){return a&&"number"==typeof a.length?l(a):yb(a)},X.transform=function(a,b,c,d){var e=Jc(a);if(null==c)if(e)c=[];else{var f=a&&a.constructor;c=ab(f&&f.prototype)}return b&&(b=X.createCallback(b,d,4),(e?Db:o)(a,function(a,d,e){return b(c,a,d,e)})),c},X.union=function(){return ib(eb(arguments,!0,!0))},X.uniq=Pb,X.values=yb,X.where=Bb,X.without=function(a){return db(a,l(arguments,1))},X.wrap=function(a,b){return kb(b,16,[a])},X.xor=function(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Jc(c)||qb(c))var d=d?ib(db(d,c).concat(db(c,d))):c}return d||[]},X.zip=Qb,X.zipObject=Rb,X.collect=Fb,X.drop=Nb,X.each=Db,X.eachRight=Eb,X.extend=U,X.methods=sb,X.object=Rb,X.select=Bb,X.tail=Nb,X.unique=Pb,X.unzip=Qb,Vb(X),X.clone=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),_(a,b,"function"==typeof c&&bb(c,d,1))},X.cloneDeep=function(a,b,c){return _(a,!0,"function"==typeof b&&bb(b,c,1))},X.contains=zb,X.escape=function(a){return null==a?"":fc(a).replace(Oc,lb)},X.every=Ab,X.find=Cb,X.findIndex=function(a,b,c){var d=-1,e=a?a.length:0;for(b=X.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1},X.findKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),o(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.findLast=function(a,b,c){var d;return b=X.createCallback(b,c,3),Eb(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d},X.findLastIndex=function(a,b,c){var d=a?a.length:0;for(b=X.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1},X.findLastKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),rb(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.has=function(a,b){return a?rc.call(a,b):!1},X.identity=Ub,X.indexOf=Mb,X.isArguments=qb,X.isArray=Jc,X.isBoolean=function(a){return!0===a||!1===a||a&&"object"==typeof a&&kc.call(a)==J||!1},X.isDate=function(a){return a&&"object"==typeof a&&kc.call(a)==K||!1},X.isElement=function(a){return a&&1===a.nodeType||!1},X.isEmpty=function(a){var b=!0;if(!a)return b;var c=kc.call(a),d=a.length;return c==I||c==P||c==H||c==N&&"number"==typeof d&&ub(a.splice)?!d:(o(a,function(){return b=!1}),b)},X.isEqual=function(a,b,c,d){return fb(a,b,"function"==typeof c&&bb(c,d,2))},X.isFinite=function(a){return zc(a)&&!Ac(parseFloat(a))},X.isFunction=ub,X.isNaN=function(a){return wb(a)&&a!=+a},X.isNull=function(a){return null===a},X.isNumber=wb,X.isObject=vb,X.isPlainObject=Pc,X.isRegExp=function(a){return a&&"object"==typeof a&&kc.call(a)==O||!1},X.isString=xb,X.isUndefined=function(a){return"undefined"==typeof a},X.lastIndexOf=function(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Cc(0,d+c):Dc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1},X.mixin=Vb,X.noConflict=function(){return c._=jc,this},X.noop=Wb,X.now=Uc,X.parseInt=Vc,X.random=function(a,b,c){var d=null==a,e=null==b;return null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1?(c=Fc(),Dc(a+c*(b-a+parseFloat("1e-"+((c+"").length-1))),b)):hb(a,b)},X.reduce=Hb,X.reduceRight=Ib,X.result=function(a,b){if(a){var c=a[b];return ub(c)?a[b]():c}},X.runInContext=m,X.size=function(a){var b=a?a.length:0;return"number"==typeof b?b:Kc(a).length},X.some=Kb,X.sortedIndex=Ob,X.template=function(a,b,c){var d=X.templateSettings;a=fc(a||""),c=t({},c,d);var e,f=t({},c.imports,d.imports),d=Kc(f),f=yb(f),h=0,i=c.interpolate||D,j="__p+='",i=ec((c.escape||D).source+"|"+i.source+"|"+(i===B?y:D).source+"|"+(c.evaluate||D).source+"|$","g");a.replace(i,function(b,c,d,f,i,k){return d||(d=f),j+=a.slice(h,k).replace(F,g),c&&(j+="'+__e("+c+")+'"),i&&(e=!0,j+="';"+i+";\n__p+='"),d&&(j+="'+((__t=("+d+"))==null?'':__t)+'"),h=k+b.length,b}),j+="';",i=c=c.variable,i||(c="obj",j="with("+c+"){"+j+"}"),j=(e?j.replace(v,""):j).replace(w,"$1").replace(x,"$1;"),j="function("+c+"){"+(i?"":c+"||("+c+"={});")+"var __t,__p='',__e=_.escape"+(e?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+j+"return __p}";try{var k=ac(d,"return "+j).apply(n,f)}catch(l){throw l.source=j,l}return b?k(b):(k.source=j,k)},X.unescape=function(a){return null==a?"":fc(a).replace(Nc,pb)},X.uniqueId=function(a){var b=++q;return fc(null==a?"":a)+b},X.all=Ab,X.any=Kb,X.detect=Cb,X.findWhere=Cb,X.foldl=Hb,X.foldr=Ib,X.include=zb,X.inject=Hb,Vb(function(){var a={};return o(X,function(b,c){X.prototype[c]||(a[c]=b)}),a}(),!1),X.first=Lb,X.last=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:n;return l(a,Cc(0,e-d))},X.sample=function(a,b,c){return a&&"number"!=typeof a.length&&(a=yb(a)),null==b||c?a?a[hb(0,a.length-1)]:n:(a=Jb(a),a.length=Dc(Cc(0,b),a.length),a)},X.take=Lb,X.head=Lb,o(X,function(a,b){var c="sample"!==b;X.prototype[b]||(X.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new Y(f,e):f})}),X.VERSION="2.4.1",X.prototype.chain=function(){return this.__chain__=!0,this},X.prototype.toString=function(){return fc(this.__wrapped__)},X.prototype.value=Yb,X.prototype.valueOf=Yb,Db(["join","pop","shift"],function(a){var b=hc[a];X.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new Y(c,a):c}}),Db(["push","reverse","sort","unshift"],function(a){var b=hc[a];X.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Db(["concat","slice","splice"],function(a){var b=hc[a];X.prototype[a]=function(){return new Y(b.apply(this.__wrapped__,arguments),this.__chain__)}}),X}var n,o=[],p=[],q=0,r=+new Date+"",s=75,t=40,u=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",v=/\b__p\+='';/g,w=/\b(__p\+=)''\+/g,x=/(__e\(.*?\)|\b__t\))\+'';/g,y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,z=/\w*$/,A=/^\s*function[ \n\r\t]+\w/,B=/<%=([\s\S]+?)%>/g,C=RegExp("^["+u+"]*0+(?=.$)"),D=/($^)/,E=/\bthis\b/,F=/['\n\r\t\u2028\u2029\\]/g,G="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),H="[object Arguments]",I="[object Array]",J="[object Boolean]",K="[object Date]",L="[object Function]",M="[object Number]",N="[object Object]",O="[object RegExp]",P="[object String]",Q={};Q[L]=!1,Q[H]=Q[I]=Q[J]=Q[K]=Q[M]=Q[N]=Q[O]=Q[P]=!0;var R={leading:!1,maxWait:0,trailing:!1},S={configurable:!1,enumerable:!1,value:null,writable:!1},T={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},V=T[typeof window]&&window||this,W=T[typeof exports]&&exports&&!exports.nodeType&&exports,X=T[typeof module]&&module&&!module.nodeType&&module,Y=X&&X.exports===W&&W,Z=T[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(V=Z);var $=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(V._=$,define(function(){return $})):W&&X?Y?(X.exports=$)._=$:W._=$:V._=$}).call(this),function(){function isEmpty(a){return"undefined"==typeof a?!0:null===a?!0:"number"==typeof a&&isNaN(a)?!0:!1}function isNumber(a){return!("number"!=typeof a||isNaN(a))}function isString(a){return"string"==typeof a}function isBoolean(a){return"boolean"==typeof a}function isArray(a){return Array.isArray(a)}function isFloat32Array(a){var b=!1;return isEmpty(a)||(b="Float32Array"===a.constructor.name),b}function isNumArray(a){var b=!1;return isArray(a)&&(b=a.every(function(a){return isNumber(a)})),b}function isSingleVal(a){return!(isArray(a)||isEmpty(a))}function isDtmObj(a){return"object"==typeof a||"function"==typeof a?a.hasOwnProperty("meta"):!1}function isStringArray(a){var b=!1;return isArray(a)&&(b=a.every(function(a){return"string"==typeof a})),b}function hasMissingValues(){}function argsToArray(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b}function argIsSingleArray(a){return!(1!==a.length||!isArray(a[0]))}function argsAreSingleVals(a){var b=!1;if(!argIsSingleArray(a)){var c=argsToArray(a);b=c.every(function(a){return isSingleVal(a)})}return b}function append(){}function appendNoDupes(){}function objForEach(a,b){var c=[];if("object"==typeof a){for(var d in a)a.hasOwnProperty(d)&&"function"==typeof b&&c.push(b(a[d],d));return c}}function loadBuffer(a){var b={};return actx.decodeAudioData(a,function(a){b=a}),b}function clone(a){var b;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,d=a.length;d>c;c++)b[c]=clone(a[c]);return b}if(a instanceof Object){if("dtm.array"==a.type)return a.clone();b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")}function jsonp(a){var b="jsonp_callback_"+Math.round(1e5*Math.random());window[b]=function(a){delete window[b],document.body.removeChild(c);var d=_.keys(a);_.forEach(d,function(b){"response"!==b&&console.log(a[b])})};var c=document.createElement("script");c.src=a+(a.indexOf("?")>=0?"&":"?")+"callback="+b,document.body.appendChild(c)}function ajaxGet(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.setRequestHeader("Accept","text/xml"),b.setRequestHeader("Content-Type","application/html"),b.setRequestHeader("Access-Control-Allow-Origin","*"),b.setRequestHeader("Access-Control-Allow-Methods","GET, POST, PUT"),b.setRequestHeader("Access-Control-Allow-Headers","X-Requested-With");var c=a.split(".").pop();switch(c){case"txt":case"csv":break;case"json":break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":b.responseType="arraybuffer";break;case"html":b.responseType="document";break;default:b.responseType="blob"}b.onreadystatechange=function(){4==b.readyState&&200==b.status&&console.log(b.response)},b.send()}function Float32Concat(a,b){var c=a.length,d=new Float32Array(c+b.length);return d.set(a),d.set(b,c),d}function morphFixed(a,b,c){isNumber(c)||(c=.5);var d=[];return _.forEach(a,function(a,e){d[e]=(b[e]-a)*c+a}),d}function runningAvg(){}function capture(){}var params={isLogging:!1},dtm={version:"0.0.4",log:function(a){params.isLogging&&console.log(arguments.callee.caller.name?arguments.callee.caller.name+": "+a:a)},modelColl:[],modelCallers:{},clocks:[],params:{},get:function(a){switch(a){case"models":return dtm.modelColl;case"modelNames":var b=[];return _.forEach(dtm.modelColl,function(a){b.push(a.get("name"))}),b;default:return null}},wa:{isOn:!0},startWebAudio:function(){dtm.wa.isOn=!0,dtm.wa.actx=new(window.AudioContext||window.webkitAudioContext),dtm.wa.now=function(){return dtm.wa.actx.currentTime},dtm.wa.out=function(){return dtm.wa.actx.destination},dtm.wa.clMult=.01,dtm.wa.clockBuf=dtm.wa.actx.createBuffer(1,Math.round(dtm.wa.actx.sampleRate*dtm.wa.clMult),dtm.wa.actx.sampleRate),dtm.wa.makeNoise=function(a){var b=dtm.wa.actx;a=a||4192;var c=b.createBuffer(1,a,dtm.wa.actx.sampleRate),d=c.getChannelData(0);return _.forEach(_.range(a),function(a){d[a]=_.random(-1,1,!0)}),c},dtm.wa.makeIr=function(a){var b=dtm.wa.actx,c=Math.round(a*dtm.wa.actx.sampleRate)||dtm.wa.actx.sampleRate,d=b.createBuffer(2,c,dtm.wa.actx.sampleRate),e=d.getChannelData(0),f=d.getChannelData(1),g=10;return _.forEach(_.range(c),function(a){e[a]=dtm.val.rescale(dtm.val.expCurve(_.random(0,1,!0)*(c-a)/c,g),-1,1),f[a]=dtm.val.rescale(dtm.val.expCurve(_.random(0,1,!0)*(c-a)/c,g),-1,1)}),d},dtm.wa.buffs={verbIr:dtm.wa.makeIr(2)}},oscParams:{isOpen:!1,port:null},startOsc:function(){dtm.osc.isOn=!0,dtm.osc.start()
}};this.dtm=dtm,dtm.loadData=function(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.open("GET",a,!0);var f=a.split(".").pop();switch(f){case"txt":case"csv":break;case"json":e.responseType="json";break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":e.responseType="arraybuffer";break;default:e.responseType="blob"}e.onreadystatechange=function(){4==e.readyState&&200==e.status?("undefined"!=typeof b&&b(e.response),c(e.response)):d(e.status)},e.send()})},dtm.loadAudio=function(a,b){return new Promise(function(c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onreadystatechange=function(){4==d.readyState&&200==d.status&&actx.decodeAudioData(d.response,function(a){c(a),"undefined"!=typeof b&&b(a)})},d.send()})},dtm.osc={type:"dtm.osc",oscPort:null,isOn:!1,isOpen:!1,callbacks:[],start:function(){return"undefined"==typeof osc||dtm.osc.isOpen?dtm.osc.isOpen&&dtm.log("OSC port is already open"):(dtm.osc.isOpen=!0,dtm.log("opening OSC port"),dtm.osc.oscPort=new osc.WebSocketPort({url:"ws://localhost:8081"}),dtm.osc.oscPort.open(),dtm.osc.oscPort.listen(),dtm.osc.oscPort.on("ready",function(){dtm.osc.oscPort.on("message",function(a){switch(a.address){case"/test":}}),dtm.osc.oscPort.on("error",function(a){throw new Error(a)})})),dtm.osc},stop:function(){return dtm.osc.oscPort&&dtm.osc.oscPort.close(1e3),dtm.osc.isOpen=!1,dtm.osc},on:function(a,b){return dtm.osc.oscPort.on("message",function(c){"/"!==a[0]&&(a="/".concat(a)),c.address==a&&b(c.args)}),dtm.osc},send:function(a,b){return"/"!==a[0]&&a.unshift("/"),b.constructor!==Array&&(b=[b]),dtm.osc.oscPort.send({address:a,args:b}),dtm.osc},clear:function(){dtm.osc.callbacks=[]}},dtm.osc.close=dtm.osc.stop,dtm.analyzer={type:"dtm.analyzer",checkType:function(a){var b=_.reduce(a,function(a,b){return a+b});return isNaN(b)||"string"==typeof b?"string":b.toString().indexOf(".")>-1?"float":"int"},min:function(a){return"string"===dtm.analyzer.checkType(a)?(dtm.log("cannot get the min value of a string array"),null):_.min(a)},max:function(a){return"string"===dtm.analyzer.checkType(a)?(dtm.log("cannot get the max value of a string array"),null):_.max(a)},mean:function(a){var b=dtm.anal.checkType(a);if("string"===b)return dtm.log("cannot get the mean value of a string array"),null;var c=_.reduce(a,function(a,b){return a+b});return c/_.size(a)},mode:function(a){var b=_.uniq(a),c=0,d=0,e=null,f=_.countBy(a);return _.forEach(b,function(a){d=f[a],d>c&&(e=a,c=d)}),e},median:function(a){var b=a.sort(),c=a.length;return c%2===0?(b[c/2-1]+b[c/2])/2:b[Math.floor(c/2)]},midrange:function(a){var b=dtm.analyzer.max(a),c=dtm.analyzer.min(a);return(b+c)/2},sum:function(a){return _.reduce(a,function(a,b){return a+b})},"var":function(a){var b=dtm.analyzer.mean(a),c=[];return _.forEach(a,function(a,d){c[d]=Math.pow(b-a,2)}),dtm.analyzer.sum(c)/(a.length-1)},std:function(a){return Math.sqrt(dtm.analyzer["var"](a))},pvar:function(a){var b=dtm.analyzer.mean(a),c=[];return _.forEach(a,function(a,d){c[d]=Math.pow(b-a,2)}),dtm.analyzer.mean(c)},pstd:function(a){return Math.sqrt(dtm.analyzer.pvar(a))},rms:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=Math.pow(a,2)}),Math.sqrt(dtm.analyzer.mean(b))},histo:function(a){var b=[],c=_.clone(a),d=_.countBy(a);return _.forEach(c,function(a,c){b[c]=d[a]}),b},classes:function(a){return _.uniq(a).sort()},uniformity:function(a){return dtm.analyzer.classes(a).length/a.length},intersection:function(a,b){return a.filter(function(a){return-1!==b.indexOf(a)})},autoCorr:null},dtm.anal=dtm.analyzer,dtm.generator=function(){function a(a){return f[a].indexOf(e.type)>-1}function b(){function b(a,b,c){for(var d=new Float32Array(a),e=(c-b)/(a-1),f=0;a>f;f++)d[f]=b+e*f;return d}function c(a,b,c,d,e,f){for(var g=new Array(a),h=0;a>h;h++){var i=dtm.value.mod(h/(a-1)+f,1),j=Math.sin(2*Math.PI*i*e)*d;j=(j+1)/2*(c-b)+b,g[h]=j}return g}function d(a,b,c,d,e,f){for(var g=new Array(a),h=0;a>h;h++){var i=dtm.value.mod(h/(a-1)+f,1),j=Math.cos(2*Math.PI*i*e)*d;j=(j+1)/2*(c-b)+b,g[h]=j}return g}function f(a,b,c,d,e){for(var f=new Array(a),g=0;a>g;g++){var h=Math.random()*(c-b)+b;f[g]=e?Math.round(h)*d:h*d}return f}function g(a,b,c){for(var d=Math.abs(Math.round(b)-Math.round(a))+1,c=(b-a)/(d-1),e=new Array(d),f=0;d>f;f++)e[f]=Math.round(a)+f*c;return e}function h(a){var b=new Array(a);if(b[0]=1,a>1){b[1]=1;for(var c=2;a>c;c++)b[c]=b[c-1]+b[c-2]}return b}e.value=[];var i;switch(a("noMinMaxDir")&&(i=dtm.transform.sort([e.min,e.max])),e.type){case"line":case"saw":e.value=b(e.length,e.min,e.max);break;case"rise":e.value=b(e.length,i[0],i[1]);break;case"decay":case"fall":e.value=b(e.length,i[1],i[0]);break;case"sin":case"sine":e.value=c(e.length,e.min,e.max,e.amp,e.cycle,0);break;case"cos":case"cosine":e.value=d(e.length,e.min,e.max,e.amp,e.cycle,0);break;case"rand":case"random":e.value=f(e.length,i[0],i[1],1,!1);break;case"noise":e.value=f(e.length,i[0],i[1],e.amp,!1);break;case"randi":e.value=f(e.length,i[0],i[1],1,!0);break;case"range":e.value=g(e.min,e.max,e.interval);break;case"fibonacci":e.value=h(e.length);break;case"string":case"str":case"s":case"characters":case"character":case"chars":case"char":case"c":e.value=e.string.split("")}}var c={type:null,length:8,min:0,max:1,amp:1,cycle:1,phase:0,"const":0,interval:1,string:"",value:[],pack:!1,typed:!0},d=dtm.array(),e=d.meta.getParams();objForEach(c,function(a,b){e[b]=a}),d.meta={type:"dtm.generator"};var f={all:["line","saw","rise","decay","fall","invSaw","seq","sequence","series","range","fibonacci","noise","random","rand","randi","gauss","gaussian","gaussCurve","normal","sin","sine","cos","cosine","tri","triangle","zeros","zeroes","ones","constant","constants","const","consts","repeat","string","str","s","character","characters","chars","char","c"],oscil:["sin","sine","cos","cosine","tri","triangle","saw","invSaw","noise","square","sq"],linish:["line","saw","rise","decay","fall","invSaw"],noLength:["string","str","s","character","characters","chars","char","c","range"],noMinMax:[],noMinMaxDir:["rise","decay","fall","noise","random","rand","randi"],string:["string","str","s","character","characters","chars","char","c"]};d.type=function(a){return isString(a)&&f.all.indexOf(a)>-1&&(e.type=a),b(),d},d.len=function(a){var c=parseInt(a);return!isNaN(c)&&c>0&&(e.length=c),b(),d},d.size=d.len,d.min=function(a){var c=parseFloat(a);return isNaN(c)||(e.min=c),b(),d},d.max=function(a){var c=parseFloat(a);return isNaN(c)||(e.max=c),b(),d},d.range=function(a,c){return d.min(a),d.max(c),b(),d},d.amp=function(a){var c=parseFloat(a);return isNaN(c)||(e.amp=c),b(),d},d.cycle=function(a){var c=parseFloat(a);return isNaN(c)||(e.cycle=c),b(),d},d.freq=d.cycles=d.cycle,d["const"]=function(){return d};var g;if(arguments.length>=1){if("object"==typeof arguments[0]){if(!Array.isArray(arguments[0]))for(g in arguments[0])arguments[0].hasOwnProperty(g)&&e.hasOwnProperty(g)&&(e[g]=arguments[0][g])}else d.type(arguments[0]);if("object"==typeof arguments[1]&&!Array.isArray(arguments[1]))for(g in arguments[1])arguments[1].hasOwnProperty(g)&&e.hasOwnProperty(g)&&(e[g]=arguments[1][g])}return arguments.length<=2&&(a("oscil")?(d.min(-1),d.max(1)):(d.min(0),d.max(1))),arguments.length>=2&&(a("noLength")?a("string")?"string"==typeof arguments[1]?(e.string=arguments[1],e.typed=!1):e.string=String(arguments[1]):"range"===e.type&&(Array.isArray(arguments[1])?1===arguments[1].length?d.max(arguments[1][0]):2===arguments[1].length&&(d.min(arguments[1][0]),d.max(arguments[1][1])):3===arguments.length&&(d.min(arguments[1]),d.max(arguments[2]))):(d.len(arguments[1]),a("oscil")?(arguments.length>=3&&(Array.isArray(arguments[2])?1===arguments[2].length?d.amp(arguments[2][0]):2===arguments[2].length&&(d.min(arguments[2][0]),d.max(arguments[2][1])):d.amp(arguments[2])),3===arguments.length&&(d.min(-1),d.max(1),d.amp(arguments[2])),4===arguments.length&&(Array.isArray(arguments[3])?2===arguments[3].length&&(d.min(arguments[3][0]),d.max(arguments[3][1])):(d.min(-1),d.max(1),d.cycle(arguments[3])))):arguments.length>=3&&(Array.isArray(arguments[2])?1===arguments[2].length?d.max(arguments[2][0]):2===arguments[2].length&&(d.min(arguments[2][0]),d.max(arguments[2][1])):(3===arguments.length&&(d.min(0),d.max(arguments[2]),d.amp(1)),arguments.length>=4&&(d.min(arguments[2]),d.max(arguments[3])))))),b(),d},dtm.gen=dtm.generator;var generators=["line","rise","decay","fall","seq","sequence","series","range","noise","random","rand","randi","gaussian","gaussCurve","gauss","normal","zeros","zeroes","ones","constant","constants","const","consts","repeat","string","str","sin","sine","cos","cosine","tri","triangle","saw","fibonacci"];generators.forEach(function(a){dtm[a]=function(){var a=argsToArray(arguments);return dtm.generator.apply(this,a)}}),dtm.transform={type:"dtm.transform",generator:function(){var a,b,c,d,e,f={type:"",len:8,min:-1,max:1,cycle:1};if("string"==typeof arguments[0])a=arguments[0];else if("object"==typeof arguments[0])for(var g in arguments[0])arguments[0].hasOwnProperty(g)&&(f[g]=arguments[0][g]);void 0===arguments[1]?b=8:"number"==typeof arguments[1]&&(b=arguments[1]);var h=["sin","sine","cos","cosine","tri","triangle","saw"];c="number"!=typeof arguments[2]?h.indexOf(a)>-1?-1:0:arguments[2],d="number"!=typeof arguments[3]?1:arguments[3],e=arguments[2];var i=[],j=0,k=0,l=0,m=[];switch(a){case"rise":case"decay":case"fall":case"noise":case"random":case"rand":case"randi":m=dtm.transform.sort([c,d]),d=m[1],c=m[0]}switch(a){case"line":case"saw":for(j=(d-c)/(b-1),l=0;b>l;l++)i[l]=c+j*l;break;case"rise":for(j=(d-c)/(b-1),l=0;b>l;l++)i[l]=c+j*l;break;case"decay":case"fall":for(j=(d-c)/(b-1),l=0;b>l;l++)i[l]=c+j*(b-1-l);break;case"seq":case"sequence":case"series":for(d=d||1,l=0;b>l;l++)i[l]=l*d+c;break;case"range":for(c=Math.round(c),d=Math.round(d),l=0;d-c>l;l++)i[l]=l+c;break;case"noise":case"random":case"rand":for(l=0;b>l;l++)i[l]=_.random(c,d,!0);break;case"randi":for(l=0;b>l;l++)i[l]=_.random(c,d);break;case"gaussian":case"gauss":case"gaussCurve":case"normal":for(l=0;b>l;l++){var n=-Math.PI+2*Math.PI/b*l;i[l]=Math.pow(Math.E,-.5*Math.pow(n,2))/Math.sqrt(2*Math.PI)/.4*(d-c)+c}break;case"sin":case"sine":for(l=0;b>l;l++)j=2*Math.PI/(b-1),k=Math.sin(j*l),k=(k+1)/2*(d-c)+c,i[l]=k;break;case"cos":case"cosine":for(l=0;b>l;l++)j=2*Math.PI/(b-1),k=Math.cos(j*l),k=(k+1)/2*(d-c)+c,i[l]=k;break;case"tri":break;case"zeros":case"zeroes":for(l=0;b>l;l++)i[l]=0;break;case"ones":for(l=0;b>l;l++)i[l]=1;break;case"constant":case"constants":case"const":case"consts":for(l=0;b>l;l++)i[l]=c;break;case"repeat":for(l=0;b>l;l++)i[l]=arguments[2];break;case"string":case"str":case"s":case"characters":case"character":case"chars":case"char":case"c":i=arguments[1].split("")}return i},normalize:function(a,b,c){isNumber(b)||(b=_.min(a)),isNumber(c)||(c=_.max(a));var d=1;return c===b?b>0&&1>=b?b=0:b>1&&(b-=1):d=c-b,_.map(a,function(a){return(a-b)/d})},rescale:function(a,b,c,d,e){var f=dtm.transform.normalize(a,d,e),g=[];return _.forEach(f,function(a,d){g[d]=dtm.value.rescale(a,b,c)}),g},expCurve:function(a,b){b=b||1;var c=[];return _.forEach(a,function(a,d){c[d]=dtm.value.expCurve(a,b)}),c},logCurve:function(a,b){b=b||1;var c=[];return _.forEach(a,function(a,d){c[d]=dtm.value.logCurve(a,b)}),c},fit:function(a,b,c){c=c||"linear",b=1>b?1:Math.round(b);var d=null;a.constructor===Array?d=new Array(b):a.constructor===Float32Array&&(d=new Float32Array(b));var e=0,f=b/a.length;switch(c){default:case"linear":var g=a.length-1,h=b-1,i=g*h+1,j=null;a.constructor===Array?j=new Array(i):a.constructor===Float32Array&&(j=new Float32Array(i));for(var k=0,l=0;g>l;l++)for(e=0;h>e;e++)j[k]=a[l]+(a[l+1]-a[l])*(e/h),k++;j[k]=a[l];for(var m=0;h>m;m++)d[m]=j[m*g];d[m]=j[i-1];break;case"step":case"hold":for(e=0;b>e;e++)d[e]=a[Math.floor(e/f)];break;case"zeros":case"zeroes":var n=-1;for(e=0;b>e;e++)n!==Math.floor(e/f)?(n=Math.floor(e/f),d[e]=a[n]):d[e]=0;break;case"decay":break;case"cos":case"cosine":if(a.length>=b)d=dtm.transform.fit(a,b,"linear");else for(var e=0,o=0;o<a.length-1;o++)for(var p=o*Math.ceil(b/(a.length-1)),q=a[o],r=(o+1)*Math.ceil(b/(a.length-1)),s=a[o+1],m=p;r>m;m++){var t=(m-p)/(r-1-p),u=(1-Math.cos(t*Math.PI))/2;d[e]=q*(1-u)+s*u,e++}break;case"cubic":if(a.length>b)d=dtm.transform.fit(a,b,"linear");else for(var e=0,o=0;o<a.length-1;o++){var p=o*Math.ceil(b/(a.length-1)),q=a[o],r=(o+1)*Math.ceil(b/(a.length-1)),s=a[o+1],v=0,w=q,x=s,y=0;0===o?(v=a[a.length-1],y=a[o+2]):o===a.length-2?(v=a[o-1],y=a[0]):(v=a[o-1],y=a[o+2]);for(var z=y-x-v+w,A=v-w-z,B=x-v,C=w,m=p;r>m;m++){var D=(m-p)/(r-1-p),u=D*D;d[e]=z*D*u+A*u+B*D+C,e++}}break;case"pad":}return d},stretch:function(a,b,c){c=c||"linear";var d=Math.round(a.length*b);return 0==d&&(d=1),dtm.transform.fit(a,d,c)},ola:function(a,b,c,d,e){isNumber(b)?0>b&&(b=1):b=1,isNumber(c)&&(c=Math.round(c),c>a.length?c=a.length:1>c&&(c=1)),isNumber(d)?(d=Math.round(d),1>d&&(d=1)):d=c,"string"!=typeof e&&(e="hamming");for(var f=(dtm.transform.generator("zeros",Math.round(a.length*b)),0);f<(a.length-c)/d;f++);},limit:function(a,b,c){var d=[];return _.forEach(a,function(a,e){var f=a;b>f&&(f=b),f>c&&(f=c),d[e]=f}),d},fitSum:function(a,b,c){"undefined"==typeof c&&(c=!1);var d=dtm.analyzer.sum(a);0===d&&(a=dtm.transform.add(a,1e-6),d=dtm.analyzer.sum(a)),c&&(b=Math.round(b));var e=dtm.transform.mult(a,1/d*b);if(c&&(e=dtm.transform.round(e),dtm.analyzer.sum(e)!==b)){var f=1,g=dtm.analyzer.sum(e)-b,h=0>g;if(h)for(;0>g;)e[dtm.val.mod(a.length-f,a.length)]++,g++,f++;else for(;g>0;)e[a.length-f]>0?(e[dtm.val.mod(a.length-f,a.length)]--,g--,f++):f++}return e},add:function(a,b,c){var d=null;if(a.constructor===Array?d=new Array(a.length):a.constructor===Float32Array&&(d=new Float32Array(a.length)),isNumber(b))_.forEach(a,function(a,c){d[c]=a+b});else if(isArray(b)){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=a[e]+b[e]}return d},mult:function(a,b,c){var d=null;if(a.constructor===Array?d=new Array(a.length):a.constructor===Float32Array&&(d=new Float32Array(a.length)),isNumber(b))_.forEach(a,function(a,c){d[c]=a*b});else if(isArray(b)){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=a[e]*b[e]}return d},pow:function(a,b,c){var d=null;if(a.constructor===Array?d=new Array(a.length):a.constructor===Float32Array&&(d=new Float32Array(a.length)),isNumber(b))_.forEach(a,function(a,c){d[c]=Math.pow(a,b)});else if(isArray(b)){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=Math.pow(a[e],b[e])}return d},powof:function(a,b,c){var d=null;if(a.constructor===Array?d=new Array(a.length):a.constructor===Float32Array&&(d=new Float32Array(a.length)),isNumber(b))_.forEach(a,function(a,c){d[c]=Math.pow(b,a)});else if(isArray(b)){a.length!==b.length&&(b=dtm.transform.fit(b,a.length,c));for(var e=0;e<a.length;e++)d[e]=Math.pow(b[e],a[e])}return d},round:function(a,b){var c=null;return a.constructor===Array?c=new Array(a.length):a.constructor===Float32Array&&(c=new Float32Array(a.length)),a.forEach(isNumber(b)?function(a,d){c[d]=Math.round(a/b)*b}:function(a,b){c[b]=Math.round(a)}),c},floor:function(a){var b=null;return a.constructor===Array?b=new Array(a.length):a.constructor===Float32Array&&(b=new Float32Array(a.length)),_.forEach(a,function(a,c){b[c]=Math.floor(a)}),b},ceil:function(a){var b=null;return a.constructor===Array?b=new Array(a.length):a.constructor===Float32Array&&(b=new Float32Array(a.length)),_.forEach(a,function(a,c){b[c]=Math.floor(a)}),b},hwr:function(a){var b=null;return a.constructor===Array?b=new Array(a.length):a.constructor===Float32Array&&(b=new Float32Array(a.length)),_.forEach(a,function(a,c){b[c]=0>a?0:a}),b},fwr:function(a){var b=null;return a.constructor===Array?b=new Array(a.length):a.constructor===Float32Array&&(b=new Float32Array(a.length)),_.forEach(a,function(a,c){b[c]=0>a?Math.abs(a):a}),b},removeZeros:function(a){for(var b=[],c=0;c<a.length;c++)0!==a[c]&&b.push(a[c]);return a.constructor===Array?b:a.constructor===Float32Array?new Float32Array(b):void 0},diff:function(a){for(var b=[],c=1;c<a.length;c++)b.push(a[c]-a[c-1]);return a.constructor===Array?b:a.constructor===Float32Array?new Float32Array(b):void 0},reverse:function(a){for(var b=[],c=a.length-1;c>=0;--c)b.push(a[c]);return a.constructor===Array?b:a.constructor===Float32Array?new Float32Array(b):void 0},invert:function(a,b){"undefined"==typeof b&&(b=dtm.analyzer.mean(a));var c=[];return _.forEach(a,function(a,d){c[d]=b-(a-b)}),a.constructor===Array?c:a.constructor===Float32Array?new Float32Array(c):void 0},shuffle:function(a){return _.shuffle(a)},sort:function(a){return _.sortBy(a,function(a){return a})},repeat:function(a,b){var c=[];b||(b=1);for(var d=0;b>d;d++)a.constructor===Array?c=c.concat(a):a.constructor===Float32Array&&a.forEach(function(a){c=c.concat(a)});return a.constructor===Array?c:a.constructor===Float32Array?new Float32Array(c):void 0},truncate:function(a,b,c){var d=[];if("undefined"!=typeof c)for(var e=0;e<a.length-(b+c);e++)d[e]=a[b+e];else for(var f=0;f<a.length-b;f++)d[f]=a[f];return d},getBlock:function(a,b,c){for(var d=[],e=0,f=0;c>f;f++)e=dtm.val.mod(f+b,a.length),d[f]=a[e];return d},window:function(a,b){var c=0,d=null;a.constructor===Array?d=new Array(a.length):a.constructor===Float32Array&&(d=new Float32Array(a.length));for(var e=0;e<a.length;e++)switch(c=e/(a.length-1),b){case"tri":case"triangle":case"triangular":d[e]=a[e]*(1-Math.abs(2*c-1));break;case"hamm":case"hamming":var f=.54,g=.46;d[e]=a[e]*(f-g*Math.cos(2*Math.PI*c));break;case"rect":case"rectangle":case"rectangular":default:d[e]=a[e]}return d},shift:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=dtm.value.mod(d+b,a.length);c[d]=a[e]}return c},morph:function(a,b,c,d){"undefined"==typeof c&&(c=.5);var e=a.length,f=b.length,g=Math.round((f-e)*c+e);return morphFixed(dtm.transform.fit(a,g,d),dtm.transform.fit(b,g),c)},interleave:function(){},notesToBeats:function(a,b){var c=[],d=0;return _.forEach(a,function(a){for(var e=b/a,f=0;e>f;f++)c[d]=0===f?1:0,d++}),c},beatsToNotes:function(a,b){for(var c=[],d=1,e=0;e<a.length-1;e++)0!==a[e+1]?(c.push(b/d),d=1):d++;return c.push(b/d),c},intervalsToBeats:function(a){var b=[],c=0;return _.forEach(a,function(a){for(var d=0;a>d;d++)b[c]=0===d?1:0,c++}),b},beatsToIntervals:function(a){for(var b=[],c=1,d=0;d<a.length-1;d++)0!==a[d+1]?(b.push(c),c=1):c++;return b.push(c),b},beatsToIndices:function(a){for(var b=[],c=0;c<a.length;c++)0!==a[c]&&b.push(c);return b},indicesToBeats:function(a,b){if(a=dtm.transform.sort(a),"undefined"==typeof b)for(var c=0,d=1;a[a.length-1]>=d;)d=Math.pow(2,++c);else d=b;for(var e=e=dtm.transform.generator("zeros",d),f=0;f<a.length&&!(a[f]>=b);f++)e[a[f]]=1;return e},calcBeatsOffset:function(a,b){for(var c=[],d=0,e=!1,f=!1,g=0;g<a.length;g++)1!==a[g]||f?1!==b[g]||e||(f=!0):e=!0,e?1===b[g]?(c.push(d),e=f=!1,d=0):d++:f&&(1===a[g]?(c.push(d),e=f=!1,d=0):d--);return c},applyOffsetToBeats:function(a,b){for(var c=dtm.array().fill("zeroes",a.length).get(),d=0,e=0;e<a.length;e++)1===a[e]&&(c[e+b[d]]=1,d++);return c},lreModulation:function(a,b){for(var c=[],d=0,e=0,f=0;f<a.length;f++)c[f]=0,0!==a[f]&&d++;for(var g=a.length/d,h=[],i=0;i<a.length;i++)if(0!==a[i]){var j=i-g*e;h.push(Math.round(g*e+j*(b-.5)*2)),e++}for(var k=0;k<h.length;k++){var l=h[k];0>l?l=0:l>=a.length&&(l=a.length-1),c[l]=1}return c},pq:function(a,b,c){var d=[];return _.forEach(a,function(a,e){d[e]=dtm.value.pq(a,b,c)}),d},unique:function(a){return _.uniq(a)},classId:function(a){var b=[],c=dtm.analyzer.classes(a).sort(),d={};return _.forEach(c,function(a,b){d[a]=b}),_.forEach(a,function(a,c){b[c]=d[a]}),b},stringify:function(a){var b=[];return _.forEach(a,function(a,c){b[c]=a.toString()}),b},tonumber:function(a){var b=[];return a.forEach(function(a,c){b[c]="string"==typeof a?parseFloat(a):"boolean"==typeof a?a?1:0:0/0}),b},mtof:function(a){var b=[];return a.forEach(function(a,c){b[c]=dtm.value.mtof(a)}),b},split:function(a,b){isEmpty(b)&&(b="");var c=[];return isEmpty(a)||isArray(a)&&a.forEach(function(a){"number"==typeof a&&(a=a.toString()),c=c.concat(a.split(b))}),c}},dtm.transform.ntob=dtm.transform.notesToBeats,dtm.transform.bton=dtm.transform.beatsToNotes,dtm.transform.itob=dtm.transform.intervalsToBeats,dtm.transform.btoi=dtm.transform.beatsToIntervals,dtm.transform.fill=dtm.transform.generator,dtm.transform.abs=dtm.transform.fwr,dtm.transform.randomize=dtm.transform.shuffle,dtm.tr=dtm.transform,dtm.array=function(){function a(){}function b(a){c.type=isNumber(a[0])?typeof a[0]:"object"==typeof a[0]?"collection":typeof a[0]}var c={name:"",type:null,length:null,min:null,max:null,mean:null,std:null,mode:null,value:[],original:[],normalized:[],classes:null,histogram:null,numClasses:null,index:0,step:1,parent:null,hash:"",processed:0},d={type:"dtm.array"};return d.meta={type:"dtm.array",getParams:function(){return c},addParams:function(a){objForEach(a,function(a,b){c[b]=a})}},d.get=function(a){if(isNumber(a))return 0>a||a>=c.length?(dtm.log("Index out of range"),c.value[dtm.value.mod(a,c.length)]):c.value[a];if(!isString(a))return c.value;switch(a){case"getters":case"help":case"?":return"name|key, type, len|length, min|minimum, max|maximum, extent|minmax|range, mean|avg|average, mode, median, midrange, std, pstd, var|variance, pvar, rms, cur|current|now, next, pver|previous, rand|random, idx|index, hop|step|stepSize, loc|location|relative, block (with 1|2 following numbers), blockNext, original, normal|normalize|normalized, sort|sorted, uniq|unique|uniques, classes, classID, string|stringify, numClasses|numUniques, unif|uniformity, histo|histogram".split(", ");case"methods":case"functions":return Object.keys(d);case"name":case"key":return c.name;case"type":return c.type;case"len":case"length":return c.length;case"hash":return c.hash;case"processed":return c.processed;case"minimum":case"min":return dtm.analyzer.min(c.value);case"maximum":case"max":return dtm.analyzer.max(c.value);case"extent":case"minmax":case"range":return[dtm.analyzer.min(c.value),dtm.analyzer.max(c.value)];case"mean":case"average":case"avg":return dtm.analyzer.mean(c.value);case"mode":return dtm.analyzer.mode(c.value);case"median":return dtm.analyzer.median(c.value);case"midrange":return dtm.analyzer.midrange(c.value);case"standardDeviation":case"std":return dtm.analyzer.std(c.value);case"pstd":return dtm.analyzer.pstd(c.value);case"variance":case"var":return dtm.analyzer["var"](c.value);case"populationVariance":case"pvar":return dtm.analyzer.pvar(c.value);case"sumAll":case"sum":return dtm.analyzer.sum(c.value);case"rms":return dtm.analyzer.rms(c.value);case"pdf":break;case"current":case"curr":case"cur":case"now":case"moment":return c.value[c.index];case"next":return void 0===arguments[1]?(c.index=dtm.value.mod(c.index+c.step,c.length),c.value[c.index]):"number"==typeof arguments[1]&&arguments[1]>=1?(c.index=dtm.value.mod(c.index+c.step,c.length),f=dtm.transform.getBlock(c.value,c.index,arguments[1]),dtm.array(f)):d;case"prev":case"previous":return c.index=dtm.value.mod(c.index-c.step,c.length),c.value[c.index];case"palindrome":break;case"rand":case"random":return c.index=_.random(0,c.length-1),c.value[c.index];case"urn":break;case"index":case"idx":return c.index;case"hop":case"hopSize":case"step":case"stepSize":return c.step;case"relative":case"location":case"loc":break;case"block":var b,e,f;return arguments[1].constructor===Array?(b=arguments[1][0],e=arguments[1][1],f=dtm.transform.getBlock(c.value,b,e),dtm.array(f)):"number"==typeof arguments[1]&&"number"==typeof arguments[2]?(b=arguments[1],e=arguments[2],f=dtm.transform.getBlock(c.value,b,e),dtm.array(f)):c.value;case"blockNext":return c.index=dtm.value.mod(c.index+c.step,c.length),f=dtm.transform.getBlock(c.value,c.index,arguments[1]),dtm.array(f);case"original":return c.original;case"normal":case"normalize":case"normalized":return dtm.transform.normalize(c.value);case"sorted":case"sort":return dtm.transform.sort(c.value);case"uniques":case"unique":case"uniq":return dtm.transform.unique(c.value);case"classes":return dtm.analyzer.classes(c.value);case"classID":case"classId":return dtm.transform.classId(c.value);case"string":case"stringify":return dtm.transform.stringify(c.value);case"numClasses":case"numUniques":case"numUniqs":return dtm.analyzer.classes(c.value).length;case"unif":case"uniformity":return dtm.analyzer.uniformity(c.value);case"histogram":case"histo":return dtm.analyzer.histo(c.value);default:return c.hasOwnProperty(a)?c[a]:c.value}},d.set=function(){return 1===arguments.length?(isEmpty(arguments[0])?c.value=[]:isNumber(arguments[0])?c.value=[arguments[0]]:arguments[0].constructor===Array?c.value=arguments[0]:arguments[0].constructor===Float32Array?c.value=arguments[0]:"dtm.array"===arguments[0].type?c.value=arguments[0].get():isDtmObj(arguments[0])?c.value=arguments[0].get():isString(arguments[0])&&(c.value=[arguments[0]],b(c.value)),0===c.original.length?(c.original=c.value,b(c.value)):c.processed++,a(c.value),c.length=c.value.length,c.index=c.length-1):arguments.length>1&&(c.value=argsToArray(arguments)),d},d.name=function(a){return isEmpty(a)&&(a=""),c.name=a.toString(),d},d.setType=function(a){return c.type=a.toString(),d},d.set.apply(this,arguments),d.step=function(a){return isNumber(a)&&(c.step=Math.round(a)),d},d.stepSize=d.step,d.index=function(a){return c.index=dtm.value.mod(Math.round(a),c.length),d},d.setIndex=d.index,d.fill=function(){return c.value=dtm.transform.generator.apply(this,arguments),d.set(c.value),d},d.gen=d.generator=d.fill,d.clone=function(){var a=dtm.array(c.value).name(c.name);return a.index(c.index),a.step(c.step),"string"===c.type&&(a.classes=c.classes,a.histogram=_.clone(c.histogram),a.setType("string")),a},d.d=d.dup=d.dupe=d.duplicate=d.c=d.copy=d.clone,d.parent=function(a){return isBoolean(a)||(a=!0),null!==c.parent?a?d.parent.clone():d.parent:d},d.morph=function(a,b,e){return isArray(a)||"dtm.array"===a.type&&(a=a.get()),isNumber(b)||(b=.5),c.value=dtm.transform.morph(c.value,a,b,e),d.set(c.value),d},d.reset=function(){return d.set(c.original),d},d.original=d.r=d.reset,d.flush=function(){return d.set([])},d.clear=d.flush,d.normalize=function(a,b){return void 0!==a&&a.constructor===Array&&(b=a[1],a=a[0]),c.value=dtm.transform.normalize(c.value,a,b),d.set(c.value),d},d.nml=d.normal=d.normalize,d.rescale=function(a,b,e,f){var g,h,i,j;if(isNumber(a))g=a;else{if(!isNumArray(a))return d;a.length>=2&&(g=a[0],h=a[1]),4===a.length&&(i=a[2],j=a[3])}return isNumber(b)?h=b:isNumArray(b)&&2===b.length&&(i=b[0],j=b[1]),isNumber(e)?i=e:isNumArray(e)&&2===e.length&&(i=e[0],j=e[1]),isNumber(f)&&(j=f),c.value=dtm.transform.rescale(c.value,g,h,i,j),d.set(c.value),d},d.sc=d.scale=d.rescale,d.limit=function(a,b){return"number"===c.type?(a=a||0,b=b||1,d.set(dtm.transform.limit(d.get(),a,b))):d},d.clip=d.limit,d.expCurve=function(a,b,c){isEmpty(b)&&(b=d.get("min")),isEmpty(c)&&(c=d.get("max"));var e=dtm.transform.expCurve(d.get("normalized"),a);return d.set(dtm.transform.rescale(e,b,c)),d},d.exp=d.expon=d.expCurve,d.logCurve=function(a,b,c){isEmpty(b)&&(b=d.get("min")),isEmpty(c)&&(c=d.get("max"));var e=dtm.transform.logCurve(d.get("normalized"),a);return d.set(dtm.transform.rescale(e,b,c)),d},d.log=d.logCurve,d.fit=function(a,b){return c.value=dtm.transform.fit(c.value,a,b),d.set(c.value),d},d.fitLen=d.fit,d.stretch=function(a,b){return c.value=dtm.transform.stretch(c.value,a,b),d.set(c.value),d},d.str=d.stretch,d.summarize=function(){return d},d.fitSum=function(a,b){return d.set(dtm.transform.fitSum(c.value,a,b))},d.fitsum=d.fitSum,d.add=function(a,b){return"dtm.array"===a.type&&(a=a.get()),d.set(dtm.transform.add(c.value,a,b)),d},d.mult=function(a,b){return"dtm.array"===a.type&&(a=a.get()),d.set(dtm.transform.mult(c.value,a,b)),d},d.dot=d.mult,d.pow=function(a,b){return"dtm.array"===a.type&&(a=a.get()),d.set(dtm.transform.pow(c.value,a,b)),d},d.powof=function(a,b){return"dtm.array"===a.type&&(a=a.get()),d.set(dtm.transform.powof(c.value,a,b))},d.map=function(a){return d.set(c.value.map(a)),d},d.sort=function(){return c.value=dtm.transform.sort(c.value),d.set(c.value),d},d.concat=function(a){isEmpty(a)&&(a=[]);var b=c.value;return isFloat32Array(c.value)||isFloat32Array(a)?b=Float32Concat(c.value,a):isArray(a)||isNumber(a)?b=b.concat(a):"dtm.array"===a.meta.type&&(b=b.concat(a.get())),d.set(b),d},d.append=d.cat=d.concat,d.repeat=function(a){return c.value=dtm.transform.repeat(c.value,a),d.set(c.value),d},d.rep=d.repeat,d.fitrep=function(a){return c.value=dtm.transform.fit(dtm.transform.repeat(c.value,a),c.length),d.set(c.value),d},d.pad=function(a,b){for(var c=[],e=0;b>e;e++)c.push(a);return d.concat(c)},d.truncate=function(a,b){return c.value=dtm.transform.truncate(c.value,a,b),d.set(c.value),d},d.slice=d.truncate,d.block=function(a,b,e){"boolean"!==e&&(e=!0);var f;if(isArray(a))f=dtm.transform.getBlock(c.value,a[0],a[1]);else{if(!isNumber(a)||!isNumber(b))return d;f=dtm.transform.getBlock(c.value,a,b)}return e?d.clone().set(f):d.set(f)},d.window=function(a){return c.value=dtm.transform.window(c.value,a),d.set(c.value),d},d.shift=function(a){return c.value=dtm.transform.shift(c.value,a),d.set(c.value),d},d.mirror=function(){return d.concat(dtm.transform.reverse(c.value)),d},d.reverse=function(){return c.value=dtm.transform.reverse(c.value),d.set(c.value),d},d.rev=d.reverse,d.invert=function(a){return c.value=dtm.transform.invert(c.value,a),d.set(c.value),d},d.flip=d.inv=d.invert,d.shuffle=function(){return c.value=dtm.transform.shuffle(c.value),d.set(c.value),d},d.rand=d.random=d.randomize=d.shuffle,d.blockShuffle=function(){return d},d.queue=function(a){return isNumber(a)?(c.value.push(a),c.value.shift()):isArray(a)?(c.value=c.value.concat(a),c.value=c.value.splice(a.length)):isDtmObj(a)&&"dtm.array"===a.meta.type&&(c.value=c.value.concat(a.get()),c.value=c.value.splice(a.get("len"))),d.set(c.value)},d.fifo=d.queue,d.round=function(a){return c.value=dtm.transform.round(c.value,a),d.set(c.value),d},d.floor=function(){return d.set(dtm.transform.floor(c.value))},d.ceil=function(){return d.set(dtm.transform.ceil(c.value))},d.hwr=function(){return d.set(dtm.transform.hwr(c.value)),d},d.fwr=function(){return d.set(dtm.transform.fwr(c.value)),d},d.abs=d.fwr,d.diff=function(){return d.set(dtm.transform.diff(c.value))},d.removeZeros=function(){return d.set(dtm.transform.removeZeros(c.value))},d.histo=function(){return d.set(dtm.analyzer.histo(c.value)),c.type="string",d},d.histogram=d.hist=d.histo,d.unique=function(){return d.set(dtm.transform.unique(c.value)),d},d.uniq=d.unique,d.classId=function(){return d.set(dtm.transform.classId(c.value))},d["class"]=d.classify=d.classId,d.stringify=function(){return d.set(dtm.transform.stringify(c.value))},d.tostring=d.stringify,d.tonumber=function(){return d.set(dtm.transform.tonumber(c.value))},d.toNum=d.tonum=d.toNumber=d.tonumber,d.toFloat32=function(){var a=new Float32Array(d.get("len"));return d.set(a)},d.morethan=function(){return d},d.mt=d.morethan,d.lessthan=function(){return d},d.lt=d.lessthan,d.split=function(a){return d.set(dtm.transform.split(c.value,a))},d.pq=function(a,b){var e={major:[0,4,7],minor:[0,3,7],maj7:[0,4,7,11],"-7":[0,3,7,10],7:[0,4,7,10],"7sus4":[0,5,7,10]};return 0===arguments.length?a=_.range(12):a.constructor===Array||isString(a)&&(a=e[a.toLowerCase()]),d.set(dtm.transform.pq(c.value,a,b))},d.pitchScale=d.pitchQuantize=d.pq,d.mtof=function(){return d.set(dtm.transform.mtof(c.value))},d.ftom=function(){return synth},d.notesToBeats=function(a){return a=a||4,c.value=dtm.transform.notesToBeats(c.value,a),d.set(c.value),d},d.ntob=d.notesToBeats,d.beatsToNotes=function(a){return a=a||4,c.value=dtm.transform.beatsToNotes(c.value,a),d.set(c.value),d},d.bton=d.beatsToNotes,d.intervalsToBeats=function(){return c.value=dtm.transform.intervalsToBeats(c.value),d.set(c.value),d},d.itob=d.intervalsToBeats,d.beatsToIntervals=function(){return c.value=dtm.transform.beatsToIntervals(c.value),d.set(c.value),d},d.btoi=d.beatsToIntervals,d.beatsToIndices=function(){return c.value=dtm.transform.beatsToIndices(c.value),d.set(c.value),d
},d.btoid=d.beatsToIndices,d.indicesToBeats=function(a){return d.set(dtm.transform.indicesToBeats(c.value,a))},d.idtob=d.indicesToBeats,d},dtm.a=dtm.arr=dtm.array,dtm.collection=function(){var a={type:"dtm.collection"};return a.get=function(){var a=null;return a},a.set=function(){return a},a.update=function(){return a},a.map=function(){return a},a},dtm.coll=dtm.collection,dtm.value={type:"dtm.value",rescale:function(a,b,c,d){d=d||!1;var e=a*(c-b)+b;return d&&(e=Math.round(e)),e},expCurve:function(a,b){return b=1>=b?1.000001:b,(Math.exp(a*Math.log(b))-1)/(b-1)},logCurve:function(a,b){return b=1>=b?1.000001:b,Math.log(a*(b-1)+1)/Math.log(b)},mtof:function(a){return 440*Math.pow(2,(a-69)/12)},pq:function(a,b,c){isNumArray(b)||(b=[0,1,2,3,4,5,6,7,8,9,10,11]),"undefined"==typeof c&&(c=!1);var d=a%12,e=a-d,f=Math.floor(d/12*b.length),g=0;return c||(g=a%1),e+b[f]+g},mod:function(a,b){return(a%b+b)%b},incr:function(){},randi:function(a,b){return _.random(a,b)},random:function(a,b){return"undefined"==typeof a&&"undefined"==typeof b&&(a=0,b=1),_.random(a,b,!0)}},dtm.value.rand=dtm.value.random,dtm.v=dtm.val=dtm.value,dtm.iterator=function(a){var b={type:"dtm.iterator",array:null,idx:0,len:0,order:null,range:{},modIdx:[]};return b.set=function(a){return"undefined"!=typeof a&&(b.len=a.length,b.array="dtm.array"===a.type?a:dtm.array(a)),b},b.set(a),b.next=function(a){"undefined"==typeof a&&(a="value");var c=b.array[a][b.idx];return b.idx=dtm.value.mod(b.idx+1,b.array.length),c},b.prev=function(a){"undefined"==typeof a&&(a="value");var c=b.array[a][b.idx];return b.idx=dtm.value.mod(b.idx-1,b.array.length),c},b.jump=function(a,c){"undefined"==typeof c&&(c="value");var d=b.array[c][b.idx];return b.idx=dtm.value.mod(a,b.array.length),d},b.random=function(a){return"undefined"==typeof a&&(a="value"),b.idx=Math.floor(Math.random()*b.array.length),b.array[a][b.idx]},b.urn=function(){var a=_.range(b.array.length-1);b.modIdx=dtm.transform.shuffle(a)},b.drunk=function(a,c,d){"undefined"==typeof a&&(a=1),"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d="value");var e=1;c&&(e=0);var f=_.random(e,a);return _.random(0,1)&&(f=-f),b.idx=dtm.value.mod(b.idx+f,b.array.length),b.array[d][b.idx]},b.setRange=function(){},b.previous=b.prev,b},dtm.it=dtm.iter=dtm.iterator,dtm.parser={type:"dtm.parser",parseCsv:function(){return parser},csvToJson:function(a){for(var b=a.split("\n"),c=[],d=b[0].split(","),e=1;e<b.length;e++){var f={},g=b[e].split(",");if(g.length>1){for(var h=0;h<d.length;h++){var i=g[h];isNaN(i)||(i=Number.parseFloat(i)),f[d[h]]=i}c.push(f)}}return c},csvToCols:function(a){var b=a.split("\n"),c=b[0].split(","),d={};c.forEach(function(a,b){c[b]=a.trim(),d[c[b]]=[]});for(var e=1;e<b.length;e++){var f=b[e].split(",");if(f.length>1)for(var g=0;g<c.length;g++){var h=f[g];h=isNaN(h)?h.trim():parseFloat(h),d[c[g]].push(h)}}return d},valueTypes:function(a){var b=[];return _.forEach(a,function(a){var c=parseFloat(a);b.push(isNaN(c)?"string":a.indexOf(".")>-1?"float":"int")}),b},getSize:function(a){var b=_.size(a[0]),c=_.size(a);return[b,c]}},dtm.data=function(arg,cb,type){function setArrays(){_.forEach(params.keys,function(a){params.arrays[a]=dtm.array(_.pluck(params.coll,a)).name(a)})}function setTypes(){_.forEach(params.keys,function(a){params.types[a]=params.arrays[a].get("type")})}function setSize(){params.size.col=params.keys.length,params.size.row=params.coll.length}var params={arrays:{},coll:[],keys:[],types:{},size:{}},data={type:"dtm.data",name:"dtm.data",promise:null,callback:null};return data.get=function(a,b){if("string"!=typeof a)return"number"==typeof a?a>=0&&a<params.size.col?params.arrays[params.keys[a]].clone():(dtm.log("data.get(): index out of range"),data):data;switch(a){case"a":case"arr":case"array":case"arrays":case"c":case"column":case"ch":case"channel":return"number"==typeof b?b>=0&&b<params.size.col?params.arrays[params.keys[b]].clone():(dtm.log("data.get(): index out of range"),data):"string"==typeof b?params.keys.indexOf(b)>-1?params.arrays[b].clone():(dtm.log("data.get(): key does not exist"),data):(dtm.log("data.get(): please specify array with index or name"),params.arrays);case"col":case"coll":case"collection":return params.coll;case"row":case"r":return params.coll[b];case"size":case"dim":case"dimension":return params.size;case"len":case"length":case"cardinality":case"card":return params.size.row;case"k":case"key":case"keys":case"name":case"names":case"list":return params.keys.slice();case"t":case"type":case"types":return params.types;default:return data}},data.set=function(a){return params.coll=a,params.keys=_.keys(params.coll[0]),setArrays(),setTypes(),setSize(),data},data.setCols=function(a){return params.keys=[],objForEach(a,function(a,b){params.keys.push(b)}),params.keys.forEach(function(b){params.arrays[b]=dtm.array(a[b]).name(b)}),params.size.col=params.keys.length,params.size.row=params.arrays[params.keys[0]].length,data},data.load=function(url,cb){return"undefined"!=typeof cb&&(data.callback=cb),data.promise=new Promise(function(resolve){var ext=url.split(".").pop();if("jsonp"===ext){var cbName="jsonp_callback_"+Math.round(1e5*Math.random());window[cbName]=function(a){delete window[cbName],document.body.removeChild(script);var b=_.keys(a);_.forEach(b,function(b){"response"!==b&&(params.coll=a[b],params.keys=_.keys(params.coll[0]),setArrays(),setTypes(),setSize(),resolve(data))}),"undefined"!=typeof cb&&cb(data)};var script=document.createElement("script");script.src=url+(url.indexOf("?")>=0?"&":"?")+"callback="+cbName,document.body.appendChild(script)}else{var xhr=new XMLHttpRequest;switch(xhr.open("GET",url,!0),ext){case"txt":case"csv":break;case"json":break;case"wav":case"aif":case"aiff":case"ogg":case"mp3":xhr.responseType="arraybuffer";break;case"png":case"jpg":case"jpeg":xhr.responseType="blob"}xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status)if("arraybuffer"===xhr.responseType)dtm.wa.isOn&&dtm.wa.actx.decodeAudioData(xhr.response,function(a){for(var b=0;b<a.numberOfChannels;b++){var c=a.getChannelData(b);params.arrays["ch_"+b]=dtm.array(Array.prototype.slice.call(c)).name("ch_"+b),params.keys.push("ch_"+b)}params.size.col=a.numberOfChannels,params.size.row=params.arrays.ch_0.get("length"),"undefined"!=typeof cb&&cb(data),resolve(data)});else if("blob"===xhr.responseType){var img=new Image;img.onload=function(){params.size.col=img.width,params.size.row=img.height;for(var a=0;a<img.width;a++)for(var b=0;b<img.height;b++);},img.src=window.URL.createObjectURL(xhr.response)}else{var keys=[];if("csv"===ext)params.coll=dtm.parser.csvToJson(xhr.response),keys=_.keys(params.coll[0]);else if("json"===ext){var res=xhr.responseText;try{res=JSON.parse(res)}catch(e){try{res=eval(res)}catch(e){console.log("Could not parse the JSON file. Maybe the format is not right.")}}if(url.indexOf("wunderground")>-1){var obj=JSON.parse(xhr.response);params.coll=obj[Object.keys(obj)[1]],params.coll.constructor===Array?keys=Object.keys(params.coll[0]):(keys=Object.keys(params.coll),params.coll=[params.coll])}else{var second=res[Object.keys(res)[0]];keys=Object.keys(second.constructor===Array?second[0]:second),params.coll=res}}else params.coll=second;params.keys=keys,setArrays(),setTypes(),setSize(),"undefined"!=typeof cb&&cb(data),resolve(data)}},xhr.send()}}),data.then=data.promise.then,data.promise.get=function(a){data.promise.then(function(b){return data=b,b.get(a)})},"dtm.data"===data.name?data:"dtm.load"===data.name?data.promise:void 0},data.clone=function(){return dtm.clone(data)},data.map=function(){return data},data.init=function(a){var b=0;if(1===arguments.length){if("number"==typeof a)for(b=0;a>b;b++)params.arrays[b]=dtm.array(),params.keys[b]=b.toString(),params.size.col=a,params.size.row=0;else if("object"==typeof a)for(b=0;b<a.num;b++)params.arrays[b]=dtm.array().fill("zeros",a.len),params.keys[b]=b.toString(),params.size.col=a.num,params.size.row=a.len}else if(2===arguments.length)for(b=0;b<arguments[0];b++)params.arrays[b]=dtm.array().fill("zeros",arguments[1]),params.keys[b]=b.toString(),params.size.col=arguments[0],params.size.row=arguments[1];else if(3===arguments.length)for(b=0;b<arguments[0];b++)params.arrays[arguments[2][b]]=dtm.array().fill("zeros",arguments[1]).name(arguments[2][b]),params.keys[b]=arguments[2][b],params.size.col=arguments[0],params.size.row=arguments[1];return data},data.append=function(a){if(a.constructor===Array){for(var b=0;b<a.length;b++)"undefined"!=typeof params.arrays[params.keys[b]]&&params.arrays[params.keys[b]].append(a[b]);params.size.row++}return data},data.queue=function(a){if(a.constructor===Array)for(var b=0;b<a.length;b++)"undefined"!=typeof params.arrays[params.keys[b]]&&params.arrays[params.keys[b]].queue(a[b]);return data},data.flush=function(){return _.forEach(params.arrays,function(a){a.flush()}),params.size.row=0,data},"undefined"==typeof arg?data:"string"==typeof arg?data.load(arg,cb):void 0},dtm.load=function(a){var b=null,c=new FileReader;return a[0].name.match(/.+\.json/gi)?b="json":a[0].name.match(/.+\.csv/gi)&&(b="csv"),c.readAsText(a[0]),new Promise(function(a){c.onload=function(c){"json"===b?a(JSON.parse(c.target.result)):"csv"===b&&a(dtm.data().setCols(dtm.parser.csvToCols(c.target.result)))}})},dtm.clock=function(a,b,c){function d(){return f.sync?1/(dtm.master.get("clock").get("bpm")/60*f.subDiv/4):1/(f.bpm/60*f.subDiv/4)}function e(){return f.sync?dtm.master.get("clock").get("bpm")/60*f.subDiv/4:f.bpm/60*f.subDiv/4}var f={source:"animationFrame",name:null,isOn:!1,sync:!0,isMaster:!1,bpm:120,subDiv:2,random:0,swing:.5,current:0,previous:0,reported:0,resolution:480,beat:0,prevBeat:-1,lookahead:.1,offset:0,requestId:null,autoStart:!0,time:[4,4]},g={type:"dtm.clock",interval:1,beat:0,list:[],prev:0,callbacks:[]},h=0,i=null,j=null;g.get=function(a){switch(a){case"bpm":case"tempo":return f.sync?dtm.master.get("clock").get("bpm"):f.bpm;case"subdiv":case"subDiv":case"div":return f.subDiv;case"dur":case"interval":return d();case"freq":return e();case"sync":case"synced":return f.sync;case"lookahead":case"la":return f.lookahead;case"isOn":case"isPlaying":return f.isOn;case"source":return f.source;case"beat":return f.beat;case"cur":case"current":return f.current;case"prev":case"previous":return f.previous;case"rep":case"reported":return f.reported;default:return g}},g.set=function(a,b,c){return"function"==typeof a?g.callback(a):g.bpm(a),isEmpty(b)||g.subDiv(b),isBoolean(c)&&(f.autoStart=c),g},g.sync=function(a){return isBoolean(a)||(a=!0),f.sync=a,g},g.bpm=function(a){return isNumber(a)?(f.bpm=a,f.sync=!1):"boolean"==typeof a?f.sync=a:"sync"==a&&(f.sync=!0),g},g.tempo=g.bpm,g.subDiv=function(a){if(isNumber(a))f.subDiv=a;else if("string"==typeof a){a=a.split("/");try{a=Math.round(parseFloat(a[1])/parseFloat(a[0]))}catch(b){return g}f.subDiv=a}return g},g.div=g.subdiv=g.subDiv,g.time=function(a){return isNumber(a)&&0!==a&&(f.subDiv=1/a),g},g.setTime=function(a){return isArray(a)?g.params.time=a:"string"==typeof a&&(g.params.time=a.split("/")),g},g.meter=g.setTime,g.setMaster=function(a){return f.isMaster=a,g},g.lookahead=function(a){return isNumber(a)&&a>=0&&(f.lookahead=a),g},g.la=g.lookahead,g.add=function(a,b){var c=!1;return"string"==typeof b?(_.forEach(g.callbacks,function(a){a.name==b&&(dtm.log("clock.add(): identical function exists in the callback list"),c=!0)}),c||(dtm.log("adding a new callback function to clock"),g.callbacks.push(a))):(_.forEach(g.callbacks,function(b){_.isEqual(b,a)&&(dtm.log("clock.add(): identical function exists in the callback list"),c=!0)}),c||(dtm.log("adding a new callback function to clock"),g.callbacks.push(a))),g},g.cb=g.callback=g.call=g.register=g.reg=g.add,g.remove=function(a){return"function"==typeof a?(dtm.log("removing a calblack function"),_.remove(g.callbacks,function(b){return _.isEqual(b,a)})):"string"==typeof a&&(dtm.log("removing a calblack function: "+a),_.remove(g.callbacks,function(b){return b.name==a})),g},g.del=g["delete"]=g.rem=g.remove,g.modify=function(a,b){if("function"==typeof a)dtm.log("modifying the callback: "+a.name),g.remove(a.name),g.add(a);else if("string"==typeof a)if(dtm.log("modifying the callback: "+a),g.remove(a),""==b.name){var c=new Function("return function "+a+b.toString().slice(8))();g.add(c)}else g.add(b);return g},g.replace=g.mod=g.modify,g.start=function(){return"animationFrame"===f.source&&window.requestAnimationFrame(g.tick),dtm.log(f.isMaster?"starting the master clock":"starting a clock"),f.isOn!==!0&&(f.isOn=!0,g.tick(),f.isMaster||dtm.clocks.push(g)),g},g.run=g.play=g.start;var k;return g.tick=function(a){if(!f.isOn)return g;var b=1;return f.sync||f.isMaster?f.sync&&!f.isMaster||f.isMaster&&("webAudio"===f.source?(i=dtm.wa.actx,k=i.createBufferSource(),j=dtm.wa.clockBuf,k.buffer=j,k.connect(out()),b=f.bpm/60*(f.subDiv/4),k.playbackRate.value=b*clMult,k.playbackRate.value+=k.playbackRate.value*f.random*_.sample([1,-1]),k.playbackRate.value*=g.beat%2==0?(1-f.swing)/.5:f.swing/.5,k.start(now()+1e-7),k.onended=function(){h+=1/b;var a=now()-h;g.tick(a)},_.forEach(g.callbacks,function(a){a(g)}),g.beat=(g.beat+1)%(f.subDiv*g.params.time[0]/g.params.time[1])):"animationFrame"===f.source&&(f.reported=Math.round(a/1e3*f.bpm/60*f.resolution),f.reported!==f.current&&(f.current%f.resolution>f.reported%f.resolution&&(f.beat=Math.round((f.current-f.offset)/f.resolution)),_.forEach(g.callbacks,function(a){a(g)}),f.current=f.reported),f.requestId=window.requestAnimationFrame(g.tick))):"webAudio"===f.source?(i=dtm.wa.actx,k=i.createBufferSource(),j=dtm.wa.clockBuf,k.buffer=j,k.connect(out()),b=f.bpm/60*(f.subDiv/4),k.playbackRate.value=b*clMult,k.playbackRate.value+=k.playbackRate.value*f.random*_.sample([1,-1]),k.playbackRate.value*=g.beat%2==0?(1-f.swing)/.5:f.swing/.5,k.start(now()+1e-7),k.onended=function(){h+=1/b,g.tick()},_.forEach(g.callbacks,function(a){a(g)}),g.beat=(g.beat+1)%(f.subDiv*g.params.time[0]/g.params.time[1])):"animationFrame"===f.source&&(f.reported=Math.round(a/1e3*f.bpm/60*f.resolution*f.subDiv/4),f.reported!==f.current&&(f.current%f.resolution>f.reported%f.resolution&&(f.beat=Math.round(f.current/f.resolution),_.forEach(g.callbacks,function(a){a(g)})),f.current=f.reported),window.requestAnimationFrame(g.tick)),g},g.tickSynced=function(){return f.isOn&&f.sync?("webAudio"===dtm.master.clock.get("source")?dtm.master.clock.beat%Math.round(f.resolution/f.subDiv)===0&&_.forEach(g.callbacks,function(a){a(g)}):"animationFrame"===dtm.master.clock.get("source")&&(dtm.master.clock.get("cur")%(f.resolution/f.subDiv*4)<f.prev&&(f.beat=Math.round((dtm.master.clock.get("cur")-f.offset)/f.resolution*f.subDiv/4),_.forEach(g.callbacks,function(a){a(g)}),f.prevBeat=f.beat),f.prev=dtm.master.clock.get("cur")%(f.resolution/f.subDiv*4)),g):g},g.stop=function(){return dtm.log(f.isMaster?"stopping the master clock":"stopping a clock"),f.isOn===!0&&(f.isOn=!1),g},g.clear=function(){return g.callbacks=[],g},g.swing=function(a){return f.swing=a||.5,g},g.shuffle=g.swing,g.randomize=function(a){return f.random=a||0,g},g.random=g.randomize,g.rand=g.randomize,g.reset=function(){return f.offset=f.isMaster?f.current:dtm.master.clock.get("cur"),f.beat=0,g},g.flush=function(){return g},g.when=function(a,b){return isArray(a)&&a.indexOf(g.beat)>-1&&"undefined"!=typeof b&&b(g),g},g.notWhen=function(a,b){return isArray(a)&&-1==a.indexOf(g.beat)&&"undefined"!=typeof b&&b(g),g},g.on=function(a){switch(a){case"every":var b=function(a,b){return function(c){c.get("beat")%a===0&&b(c)}}(arguments[1],arguments[2]);g.callbacks.push(b)}return g},g.seq=function(){var a=function(a,b,c){return function(d){void 0===c&&(c=d.get("subDiv")),b.indexOf(d.get("beat")%c)>-1&&a(d)}}(arguments[0],arguments[1],arguments[2]);return g.callbacks.push(a),g},g.delayEvent=function(){return g},g.delay=g.delayEvent,f.isMaster||"undefined"==typeof dtm.master||(dtm.master.clock.add(g.tickSynced),f.autoStart&&g.start()),g.set(a,b,c),g},dtm.c=dtm.clock,dtm.instr=function(a){var b={name:"default",isPlaying:!1,poly:!1,modDest:[],modList:[],sync:!0,clock:dtm.clock(!0,8),instrModel:null,callbacks:[],defInstr:function(){var a=b.models.voice,c=b.models.volume.get("next"),d=b.models.dur.get("next"),e=b.models.rhythm.get("next"),f=b.models.pitch.get("next"),g=b.models.scale.get(),h=b.models.transp.get("next"),i=b.models.chord.get(),j=b.models.subdiv.get("next");b.clock.subDiv(j);var k=b.models.wavetable,l=b.models.lpf,m=b.models.comb,n=b.models.delay;b.sync===!1&&b.clock.bpm(b.models.bpm.get("next")),_.forEach(b.callbacks,function(a){a(b.clock)}),e&&_.forEach(i,function(e){k&&a.wt(k.get()),l&&a.lpf(l.get("next"),b.models.res.get("next")),m&&a.comb(.5,b.models.comb.get("next")),n&&a.delay(b.models.delay.get("next")),a.dur(d).decay(d),a.nn(dtm.val.pq(f+e,g,b.pqRound)+h).amp(c).play()})}},c={type:"dtm.instrument",params:[]};return c.get=function(a){switch(a){case"name":return b.name;case"isplaying":case"isPlaying":return b.isPlaying;case"c":case"clock":return b.clock;case"beat":return b.clock.get("beat");case"m":case"mod":case"model":case"models":case"modList":return c.params;case"param":case"params":}},c.set=function(a,d){switch("number"==typeof d?b.models[a]=dtm.array(d):d.constructor===Array?b.models[a]=dtm.array(d):"dtm.array"===d.type?b.models[a]=d.clone():"dtm.model"===d.type||"dtm.synth"===d.type&&(b.models[a]=d),a){case"bpm":case"tempo":break;case"div":case"subdiv":case"subDiv":}return c},c.clone=function(){return c},c.model=function(){var a=arguments[0],d="none";if("string"==typeof arguments[1]&&(d=arguments[1]),a.constructor===Array)d?b.models[d]=dtm.array(a):b.models.none=dtm.array(a);else if("object"==typeof a)"dtm.model"===a.type?"instr"===a.get("categ")?(dtm.log('assigning model "'+a.params.name+'" to category "'+d+'"'),b.models[d]=a,b.modDest.push(a)):a.get("categ")?(dtm.log('assigning model "'+a.params.name+'" to category "'+a.params.categ+'"'),b.models[a.params.categ]=a,b.modDest.push(a)):d&&(dtm.log('assigning model "'+a.params.name+'" to category "'+d+'"'),b.models[d]=a,b.modDest.push(a)):"dtm.array"===a.type&&(b.models[d]=a);else if("string"==typeof a){var e=_.find(dtm.modelColl,{params:{name:a}});"undefined"!=typeof e&&(d||(d=e.params.categ),dtm.log('assigning model "'+e.params.name+'" to category "'+d+'"'),b.models[d]=e,b.modDest.push(e))}return c},c.map=function(a,d){return a.constructor===Array?b.models[d]=dtm.array(a).normalize():"dtm.array"===a.type?b.models[d]=a.normalize():"dtm.model"===a.type,c},c.play=function(){return b.isPlaying!==!0?(b.isPlaying=!0,dtm.log("playing instr: "+b.name),!b.instrModel,b.instrModel&&"instr"===b.instrModel.get("categ")&&b.instrModel.output&&b.clock.add(b.instrModel.output).start(),dtm.master.activeInstrs.push(c)):dtm.log("instrument "+b.name+" is already playing!"),c},c.start=c.print=c.run=c.play,c.stop=function(){return b.isPlaying===!0&&(b.isPlaying=!1,dtm.log("stopping: "+b.name),b.instrModel&&"instr"===b.instrModel.params.categ&&b.instrModel.stop(),b.clock.stop(),b.clock.clear(),b.callbacks=[]),c},c.mod=function(a,b,d){var e="";return"string"==typeof a?e=a:"number"==typeof a&&(e=c.params[a]),c[e](b,d),c},c.modulate=c.mod,c.load=function(a){var d;return"string"==typeof a?d=dtm.modelCallers[a]():"dtm.model"===a.type&&(d=a),"undefined"!=typeof d&&(d.parent=c,d.assignMethods(c),b.instrModel=d),c},a=a||"default",c.load(a),c},dtm.i=dtm.instrument=dtm.instr,dtm.voice=dtm.instr,dtm.model=function(a,b){var c={name:null,categ:"none",categories:[],defaultCb:null,registering:!1,loading:!0,process:[],data:dtm.array(),clock:null,output:[]},d=function(){if("function"==typeof c.defaultCb)return c.defaultCb.apply(this,arguments);if(d.caller.arguments[0]&&"dtm.clock"===d.caller.arguments[0].type&&(c.clock=d.caller.arguments[0]),1===arguments.length){var a=arguments[0];isNumber(a)?c.data.set(a):"string"==typeof a?c.data.set("c",a).histo():"object"==typeof a&&(a.constructor===Array||a.constructor===Float32Array?c.data.set(a):a.hasOwnProperty("type")&&"dtm.array"===a.type&&c.data.set(a))}else arguments.length>1&&c.data.set.apply(this,arguments);c.process.forEach(function(a){a.method.apply(this,a.params)}),c.range?c.domain?c.data.range(c.range,c.domain):c.data.range(c.range):c.domain&&c.data.normalize(c.domain);var b=null;return c.output&&c.output.forEach(function(a){b=c.clock?a.method(c.data,c.clock):a.method(c.data)}),b?b:c.data};if(d.type="dtm.model",d.meta={type:"dtm.model"},d.parent={},d.siblings=[],d.mod={},d.param={},d.set={},d.map={},d.params={},d.models={},d.modes={literal:["literal","lit","l"],adapt:["adapt","adapted","adaptive","a"],preserve:["preserve","preserved","p","n"]},"string"==typeof a&&(c.name=a),"string"==typeof b&&(c.categ=b),d["default"]=function(a){"function"==typeof a&&(c.defaultCb=a)},d.get=function(a){switch(a){case"name":return c.name;case"category":case"categ":return c.categ;default:return c.output}},d.categ=function(a){return"string"==typeof a&&(c.categ=a),d},d.register=function(){var a=!1;for(var b in dtm.modelCallers)b===d.get("name")&&(dtm.log("model already registered: "+d.get("name")),a=!0,c.registering=!1);return a||(dtm.log("registering a new model: "+d.get("name")),dtm.modelCallers[d.get("name")]=d.register.caller,c.registering=!0),d},d.save=function(){return dtm.modelColl[d.get("name")]=d,d},d.toNumeric=function(a){switch(a){case"histo":case"histogram":c.process.push({method:function(){"number"!==c.data.get("type")&&c.data.histo()},params:null});break;case"class":c.process.push({method:function(){"number"!==c.data.get("type")&&c.data["class"]()},params:null});break;case"freq":case"frequency":case"appearance":}return d},d.domain=function(){if(1===arguments.length){var a=arguments[0];"object"==typeof a?a.constructor===Array?c.domain=a:"dtm.array"===a.type&&(c.domain=2===a.get("len")?a.get():a.get("extent")):"function"==typeof a&&c.process.push({method:function(){c.domain=a(c.data)},params:null})}else 2===arguments.length&&(c.domain=[arguments[0],arguments[1]]);return d},d.range=function(){if(1===arguments.length){var a=arguments[0];"object"==typeof a?a.constructor===Array?c.range=a:"dtm.array"===a.type&&(c.range=2===a.get("len")?a.get():a.get("extent")):"function"==typeof a&&c.process.push({method:function(){c.range=a(c.data)},params:null})}else 2===arguments.length&&(c.range=[arguments[0],arguments[1]]);return d},d.output=function(a){return c.output.push("function"==typeof a?{method:function(b,c){return a(b,c)},params:null}:{method:function(){return a},params:null}),d},d.start=function(){return d},d.stop=function(){return d},d.clone=function(){return clone(d)},d.assignMethods=function(a){return _.forEach(d.mod,function(b,c){a[c]=b,a.params.push(c)}),_.forEach(d.param,function(b,c){a[c]=b,a.params.push(c)}),_.forEach(d.set,function(b,c){a[c]=b,a.params.push(c)}),_.forEach(d.map,function(b,c){a[c]=b,a.params.push(c)}),d},"string"==typeof a){c.loading=arguments.callee.caller.arguments[0];var e,f;for(f in dtm.modelCallers)f===a&&c.loading!==!0&&(dtm.log("found a registered model: "+a),e=dtm.modelCallers[a](!0));if(void 0===e)for(f in dtm.modelColl)f===a&&d.load.caller.arguments[0]!==a&&(e=dtm.modelColl[a].clone());void 0!==e&&(dtm.log("loading a registered / saved model: "+a),d=e)}return d},dtm.model.load=dtm.model,dtm.m=dtm.model,dtm.synth=function(){function a(a){var b=new Float32Array(a.length);return a.forEach(function(a,c){b[c]=a*e.tabLen/e.sr}),b}function b(a,b,c){c.forEach(function(c){var d=.25;e.curve||c.value.length/e.sr>e.dur*d?c.param.setValueCurveAtTime(c.value,a,b):c.value.forEach(function(d,e){c.param.setValueAtTime(d,a+e/c.value.length*b)})})}function c(a){if(isNumber(a))return new Float32Array([a]);if("object"!=typeof a&&"function"!=typeof a)return!1;if(null===a)return!1;if(a.constructor===Float32Array)return a;if(isNumArray(a))return new Float32Array(a);if(isDtmObj(a))if("dtm.array"===a.meta.type||"dtm.generator"===a.meta.type){if(a.get().constructor===Array)return new Float32Array(a.get());if(a.get().constructor===Float32Array)return a.get()}else{if("dtm.synth"===a.meta.type)return a.rendered;if("dtm.model"===a.meta.type)return new Float32Array(a.get())}}var d={type:"dtm.synth",rendered:null,promise:null,meta:{type:"dtm.synth"}},e={sr:44100,kr:4410,dur:1,wavetable:null,rendered:null,tabLen:8192,source:"sine",amp:null,freq:null,pitch:null,pan:null,curve:!1,offline:!1,clock:null,baseTime:0,lookahead:!1,autoDur:!1,voiceId:Math.random(),useOfflineContext:!0,named:[]};d.get=function(a){switch(a){case"clock":return e.clock;case"lookahead":return e.lookahead;case"autoDur":return e.autoDur;case"dur":case"duration":return e.dur;case"source":return e.source;case"tabLen":return e.tabLen;case"wavetable":return e.wavetable;case"id":return e.voiceId;default:return d}};var f={src:null,amp:null,out:null,fx:[{}],pFx:[{}],rtSrc:null};arguments.callee.caller&&arguments.callee.caller.arguments.length>0&&"object"==typeof arguments.callee.caller.arguments[0]&&"dtm.clock"===arguments.callee.caller.arguments[0].type&&(e.clock=arguments.callee.caller.arguments[0],e.lookahead=!0,e.autoDur=!0);var g=dtm.wa.actx;e.sr=g.sampleRate;var h=null,i=function(){"object"==typeof arguments[0]&&arguments[0].hasOwnProperty("type")&&"dtm.clock"===arguments[0].type&&(e.clock=arguments[0],e.lookahead=!0,e.autoDur=!0),e.baseTime=g.currentTime,e.amp=new Float32Array([1]),e.freq=new Float32Array([440]),e.pitch=a(e.freq),e.wavetable=new Float32Array(e.tabLen),e.wavetable.forEach(function(a,b){e.wavetable[b]=Math.sin(2*Math.PI*b/e.tabLen)}),e.pan=new Float32Array([0])};i.apply(this,arguments);var j={Gain:function(a){var c=null,d=isBoolean(a)?d:!1;isString(a)&&(d=!0,c=a),this.mult=new Float32Array([1]),this.run=function(a,f){var i=d?g:h;this["in"]=i.createGain(),this.gain=i.createGain(),this.out=i.createGain(),this["in"].connect(this.gain),this.gain.connect(this.out);var j=[];j.push({param:this.gain.gain,value:this.mult}),b(a,f,j),isEmpty(c)||(e.named[c]=this.gain.gain)}},LPF:function(a){a=isBoolean(a)?a:!1,this.freq=new Float32Array([2e4]),this.q=new Float32Array([1]),this.run=function(c,d){var e=a?g:h;this["in"]=e.createGain(),this.lpf=e.createBiquadFilter(),this.out=e.createGain(),this["in"].connect(this.lpf),this.lpf.connect(this.out);var f=[];f.push({param:this.lpf.frequency,value:this.freq}),f.push({param:this.lpf.Q,value:this.q}),b(c,d,f)}},HPF:function(a){a=isBoolean(a)?a:!1,this.freq=new Float32Array([30]),this.q=new Float32Array([1]),this.run=function(c,d){var e=a?g:h;this["in"]=e.createGain(),this.hpf=e.createBiquadFilter(),this.hpf.type="highpass",this.out=e.createGain(),this["in"].connect(this.hpf),this.hpf.connect(this.out);var f=[];f.push({param:this.hpf.frequency,value:this.freq}),f.push({param:this.hpf.Q,value:this.q}),b(c,d,f)}},BPF:function(a){a=isBoolean(a)?a:!1,this.freq=new Float32Array([30]),this.q=new Float32Array([1]),this.run=function(c,d){var e=a?g:h;this["in"]=e.createGain(),this.bpf=e.createBiquadFilter(),this.bpf.type="bandpass",this.out=e.createGain(),this["in"].connect(this.bpf),this.bpf.connect(this.out);var f=[];f.push({param:this.bpf.frequency,value:this.freq}),f.push({param:this.bpf.Q,value:this.q}),b(c,d,f)}},APF:function(a){a=isBoolean(a)?a:!1,this.freq=new Float32Array([30]),this.q=new Float32Array([1]),this.run=function(c,d){var e=a?g:h;this["in"]=e.createGain(),this.apf=e.createBiquadFilter(),this.apf.type="allpass",this.out=e.createGain(),this["in"].connect(this.apf),this.apf.connect(this.out);var f=[];f.push({param:this.apf.frequency,value:this.freq}),f.push({param:this.apf.Q,value:this.q}),b(c,d,f)}},Delay:function(a){a=isBoolean(a)?a:!1,this.mix=new Float32Array([.5]),this.time=new Float32Array([.3]),this.feedback=new Float32Array([.5]),this.run=function(c,d){var e=a?g:h;this["in"]=e.createGain(),this.delay=e.createDelay(),this.wet=e.createGain(),this.dry=e.createGain(),this.fb=e.createGain(),this.out=e.createGain(),this["in"].connect(this.delay),this.delay.connect(this.fb),this.fb.connect(this.delay),this.delay.connect(this.wet),this.wet.connect(this.out),this["in"].connect(this.dry),this.dry.connect(this.out);var f=[];f.push({param:this.wet.gain,value:this.mix}),f.push({param:this.delay.delayTime,value:this.time}),f.push({param:this.fb.gain,value:this.feedback}),b(c,d,f)}},BitQuantizer:function(){this.bit=new Float32Array([16]);var a=this;this.run=function(b,c){this["in"]=g.createGain(),this.out=g.createGain(),this["in"].connect(this.out);var d=c*e.sr/this.bit.length;this.bit.forEach(function(b,c){b>16?b=16:1>b&&(b=1),a.bit[c]=b}),e.rendered.forEach(function(b,c){var f=Math.floor(c/d);f>a.bit.length-1&&(f=a.bit.length-1);var g=Math.pow(2,a.bit[f]);e.rendered[c]=Math.round(b*g)/g})}},SampleHold:function(){this.samps=new Float32Array([1]);var a=this;this.run=function(b,c){this["in"]=g.createGain(),this.out=g.createGain(),this["in"].connect(this.out);var d=c*e.sr/this.samps.length;this.samps.forEach(function(b,c){b=Math.round(b),1>b&&(b=1),a.samps[c]=b}),e.rendered.forEach(function(b,c){var f=Math.floor(c/d);f>a.samps.length-1&&(f=a.samps.length-1);var g=a.samps[f],h=0;c%g===0&&(h=b),e.rendered[c]=h})}},WaveShaper:function(){}};return d.clock=function(a){return"object"==typeof a&&"dtm.clock"===a.type&&(e.clock=a),d},d.lookahead=function(a){return isBoolean(a)&&(e.lookahead=a),d},d.dur=function(a){return isNumber(a)?a>0&&(e.autoDur=!1,e.dur=a):isBoolean(a)?e.autoDur=a:"auto"===a&&(e.autoDur=!0),d},d.offset=function(){return d},d.play=function(a,c){var i=0;return e.lookahead&&(i=Math.round(500*e.clock.get("lookahead"))),setTimeout(function(){if(isBoolean(a)){if(!a)return d;a=0}else(!isNumber(a)||0>a)&&(a=0);e.autoDur&&(e.dur=e.clock.get("dur")),!isNumber(c)||0>=c?c=e.dur:c>0&&(e.dur=c),dtm.master.addVoice(d),h=new OfflineAudioContext(1,(a+4*c)*e.sr,e.sr),a+=h.currentTime,e.lookahead&&(a+=e.clock.get("lookahead")),f.src=h.createBufferSource(),f.amp=h.createGain(),f.out=h.createGain(),f.fx[0].out=h.createGain(),f.src.connect(f.amp),f.amp.connect(f.fx[0].out),f.out.connect(h.destination);for(var i=1;i<f.fx.length;i++)f.fx[i].run(a,c),f.fx[i-1].out.connect(f.fx[i]["in"]);if(f.fx[i-1].out.connect(f.out),"noise"===e.source){f.src.buffer=h.createBuffer(1,e.sr/2,e.sr);var j=f.src.buffer.getChannelData(0);j.forEach(function(a,b){j[b]=2*Math.random()-1}),f.src.loop=!0}else f.src.buffer=h.createBuffer(1,e.tabLen,e.sr),f.src.buffer.copyToChannel(e.wavetable,0),f.src.loop=!0;var k=[];k.push({param:f.src.playbackRate,value:e.pitch}),k.push({param:f.amp.gain,value:e.amp}),b(a,c,k),f.fx[0].out.gain.value=1,f.out.gain.value=.3,f.src.start(a),f.src.stop(a+c),h.startRendering(),h.oncomplete=function(h){e.rendered=h.renderedBuffer.getChannelData(0),a+=e.baseTime,e.lookahead&&(a+=e.clock.get("lookahead")),f.rtSrc=g.createBufferSource(),f.pFx[0].out=g.createGain();var i=g.createStereoPanner(),j=g.createGain();f.rtSrc.connect(f.pFx[0].out);for(var k=1;k<f.pFx.length;k++)f.pFx[k].run(a,c),f.pFx[k-1].out.connect(f.pFx[k]["in"]);f.pFx[k-1].out.connect(i),i.connect(j),j.connect(g.destination),f.rtSrc.buffer=g.createBuffer(1,e.rendered.length,e.sr),f.rtSrc.buffer.copyToChannel(e.rendered,0),f.rtSrc.loop=!1,f.rtSrc.start(a),f.rtSrc.stop(a+f.rtSrc.buffer.length),b(a,c,[{param:i.pan,value:e.pan}]),j.gain.value=1,f.rtSrc.onended=function(){dtm.master.removeVoice(d)}}},i),d},d.cancel=function(a){return isNumber(a)||(a=0),objForEach(e.named,function(b){b.cancelScheduledValues(g.currentTime+a)}),d},d.render=function(a,c){return(!isNumber(a)||0>a)&&(a=0),e.autoDur&&(e.dur=e.clock.get("dur")),isNumber(c)?e.dur>0&&(e.dur=c):c=e.dur,d.promise=new Promise(function(d){setTimeout(function(){h=new OfflineAudioContext(1,(a+4*c)*e.sr,e.sr),a+=h.currentTime,f.src=h.createBufferSource(),f.amp=h.createGain(),f.out=h.createGain(),f.fx[0].out=h.createGain(),f.src.connect(f.amp),f.amp.connect(f.fx[0].out),f.out.connect(h.destination);for(var g=1;g<f.fx.length;g++)f.fx[g].run(a,c),f.fx[g-1].out.connect(f.fx[g]["in"]);if(f.fx[g-1].out.connect(f.out),"noise"===e.source){f.src.buffer=h.createBuffer(1,e.sr/2,e.sr);var i=f.src.buffer.getChannelData(0);i.forEach(function(a,b){i[b]=2*Math.random()-1
}),f.src.loop=!0}else f.src.buffer=h.createBuffer(1,e.tabLen,e.sr),f.src.buffer.copyToChannel(e.wavetable,0),f.src.loop=!0;var j=[];j.push({param:f.src.playbackRate,value:e.pitch}),j.push({param:f.amp.gain,value:e.amp}),b(a,c,j),f.fx[0].out.gain.value=1,f.out.gain.value=.3,f.src.start(a),f.src.stop(a+c),h.startRendering(),h.oncomplete=function(a){d(a.renderedBuffer.getChannelData(0).slice(0,c*e.sr))}},0)}),d},d.stop=function(a){var b=0;return e.lookahead&&(b=Math.round(500*e.clock.get("lookahead"))),isNumber(a)||(a=0),setTimeout(function(){f.src&&f.src.stop(a),f.rtSrc&&f.rtSrc.stop(a),dtm.master.removeVoice(d)},b),d},d.mod=function(a,b){return isString(a)&&e.named.hasOwnProperty(a)&&setTimeout(function(){e.named[a].cancelScheduledValues(0),e.named[a].setValueAtTime(b,0)},0),d},d.modulate=d.mod,d.freq=function(b,f){if("string"==typeof f)switch(f){case"add":break;case"mult":case"dot":}else b=c(b),b&&(e.freq=b,e.pitch=a(e.freq));return d},d.nn=function(b,f){return"string"==typeof f||(b=c(b),b&&(e.freq=new Float32Array(b.length),b.forEach(function(a,b){e.freq[b]=dtm.value.mtof(a)}),e.pitch=a(e.freq))),d},d.notenum=d.nn,d.pitch=function(){return d},d.amp=function(a,b){if("string"==typeof b){var f=c(a);switch(f.length!==e.amp.length&&(f=dtm.transform.fit(f,e.amp.length,"linear")),b){case"add":e.amp.forEach(function(a,b){e.amp[b]=a+f[b]});break;case"mult":case"dot":e.amp.forEach(function(a,b){e.amp[b]=a*f[b]})}}else a=c(a),a&&(e.amp=a);return d},d.pan=function(a){return a=c(a),a&&(e.pan=a),d},d.ts=function(){return d},d.ps=function(){},d.wt=function(b){return b=c(b),b?(e.wavetable=b,e.tabLen=b.length,e.pitch=a(e.freq)):(e.wavetable=new Float32Array(e.tabLen),e.wavetable.forEach(function(a,b){e.wavetable[b]=Math.sin(2*Math.PI*b/e.tabLen)})),d},d.wavetable=d.wt,d.source=function(a){return"string"==typeof a&&(e.source=a),d},d.gain=function(a,b){var e=new j.Gain(b);return a=c(a),a&&(e.mult=a),b?f.pFx.push(e):f.fx.push(e),d},d.lpf=function(a,b,e){var g=new j.LPF(e);return a=c(a),a&&(g.freq=a),b=c(b),b&&(g.q=b),e?f.pFx.push(g):f.fx.push(g),d},d.hpf=function(a,b,e){var g=new j.HPF(e);return a=c(a),a&&(g.freq=a),b=c(b),b&&(g.q=b),e?f.pFx.push(g):f.fx.push(g),d},d.bpf=function(a,b,e){var g=new j.BPF(e);return a=c(a),a&&(g.freq=a),b=c(b),b&&(g.q=b),e?f.pFx.push(g):f.fx.push(g),d},d.apf=function(a,b,e){var g=new j.APF(e);return a=c(a),a&&(g.freq=a),b=c(b),b&&(g.q=b),e?f.pFx.push(g):f.fx.push(g),d},d.delay=function(a,b,e,g){var h=new j.Delay(g);return a=c(a),a&&(h.mix=a),b=c(b),b&&(h.time=b),e=c(e),e&&(h.feedback=e),g?f.pFx.push(h):f.fx.push(h),d},d.am=function(a){return a=c(a),d},d.fm=function(a){return a=c(a),a&&(a=dtm.transform.fit(a,Math.round(e.tabLen/10),"linear"),e.freq=dtm.transform.fit(e.freq,Math.round(e.tabLen/10),"step"),e.freq.forEach(function(b,c){e.freq[c]=b+a[c]})),d},d.waveshape=function(){return d},d.bq=function(a){var b=new j.BitQuantizer;return a=c(a),a&&(b.bit=a),f.pFx.push(b),d},d.crush=d.bitquantize=d.bq,d.sh=function(a){var b=new j.SampleHold;return a=c(a),a&&(b.samps=a),f.pFx.push(b),d},d.samplehold=d.samphold=d.sh,d.get=function(a){switch(a){case"fx":return f.fx;default:return d}},d},dtm.s=dtm.syn=dtm.synth,dtm.startWebAudio(),dtm.synth2=function(a){function b(a,b,c){c.forEach(function(c){e.curve?c.param.setValueCurveAtTime(c.value,a,b):c.value.forEach(function(d,e){c.param.setValueAtTime(d,a+e/c.value.length*b)})})}function c(a){if("number"==typeof a)return[a];if("object"!=typeof a)return!1;if(null===a)return!1;if(a.constructor===Array)return a;if(a.hasOwnProperty("type")){if("dtm.array"===a.type)return a.get();if("dtm.synth"===a.type)return a.wt}}var d={type:"synth2",rendered:null},e={sr:44100,kr:4410,dur:1,wt:null,tabLen:8192,amp:null,freq:null,curve:!1,offline:!1};e.amp=new Float32Array([1]),e.freq=new Float32Array([440*e.tabLen/e.sr]),e.wt=new Float32Array(e.tabLen),e.wt.forEach(function(a,b){e.wt[b]=Math.sin(2*Math.PI*b/e.tabLen)});var f=null;f=e.offline?new OfflineAudioContext(1,e.dur*e.sr,e.sr):dtm.wa.actx;var g={src:null,amp:null,out:null,fx:[{}]},h={LPF:function(){this.freq=new Float32Array([2e4]),this.q=new Float32Array([1]),this["in"]=f.createGain(),this.lpf=f.createBiquadFilter(),this.out=f.createGain(),this["in"].connect(this.lpf),this.lpf.connect(this.out),this.run=function(a,c){var d=[];d.push({param:this.lpf.frequency,value:this.freq}),d.push({param:this.lpf.Q,value:this.q}),b(a,c,d)}},Delay:function(){this.mix=new Float32Array([.5]),this.time=new Float32Array([.3]),this.feedback=new Float32Array([.5]),this["in"]=f.createGain(),this.delay=f.createDelay(),this.wet=f.createGain(),this.dry=f.createGain(),this.fb=f.createGain(),this.out=f.createGain(),this["in"].connect(this.delay),this.delay.connect(this.fb),this.fb.connect(this.delay),this.delay.connect(this.wet),this.wet.connect(this.out),this["in"].connect(this.dry),this.dry.connect(this.out),this.run=function(a,c){var d=[];d.push({param:this.wet.gain,value:this.mix}),d.push({param:this.delay.delayTime,value:this.time}),d.push({param:this.fb.gain,value:this.feedback}),b(a,c,d)}},BitQuantizer:function(){this.bit=new Float32Array([16]),this["in"]=f.createGain(),this.out=f.createGain(),this["in"].connect(this.out),this.run=function(){e.wt.forEach(function(a,b){e.wt[b]=a})}},WaveShaper:function(){}};return d.play=function(c,h){return setTimeout(function(){"number"!=typeof c&&(c=0),"number"!=typeof h&&(h=e.dur),c+=f.currentTime,g.src=f.createBufferSource(),g.amp=f.createGain(),g.out=f.createGain(),g.fx[0].out=f.createGain(),g.src.connect(g.amp),g.amp.connect(g.fx[0].out),g.out.connect(f.destination);for(var i=1;i<g.fx.length;i++)g.fx[i-1].out.connect(g.fx[i]["in"]),g.fx[i].run(c,h);if(g.fx[i-1].out.connect(g.out),"noise"===a){g.src.buffer=f.createBuffer(1,e.sr/2,e.sr);var j=g.src.buffer.getChannelData(0);j.forEach(function(a,b){j[b]=2*Math.random()-1}),g.src.loop=!0}else g.src.buffer=f.createBuffer(1,e.tabLen,e.sr),g.src.buffer.copyToChannel(e.wt,0),g.src.loop=!0;var k=[];return k.push({param:g.src.playbackRate,value:e.freq}),k.push({param:g.amp.gain,value:e.amp}),b(c,h,k),g.fx[0].out.gain.value=1,g.out.gain.value=.3,g.src.start(c),g.src.stop(c+h),e.offline&&(f.startRendering(),f.oncomplete=function(a){d.rendered=a.renderedBuffer.getChannelData(0)}),d},0),d},d.dur=function(a){return e.dur=a,d},d.freq=function(a,b){if("string"==typeof b)switch(b){case"add":break;case"mult":case"dot":}else e.freq=new Float32Array(c(a)),e.freq.forEach(function(a,b){e.freq[b]=a*e.tabLen/e.sr});return d},d.amp=function(a,b){if("string"==typeof b){var f=c(a);switch(f.length!==e.amp.length&&(f=dtm.transform.fit(f,e.amp.length,"linear")),b){case"add":e.amp.forEach(function(a,b){e.amp[b]=a+f[b]});break;case"mult":case"dot":e.amp.forEach(function(a,b){e.amp[b]=a*f[b]})}}else e.amp=new Float32Array(c(a));return d},d.wt=function(a){return a=c(a),a?(a.length!==e.tabLen&&(a=dtm.transform.fit(a,e.tabLen)),e.wt=new Float32Array(a)):(e.wt=new Float32Array(e.tabLen),e.wt.forEach(function(a,b){e.wt[b]=Math.sin(2*Math.PI*b/e.tabLen)})),d},d.nn=function(a,b){return"string"==typeof b||(a=c(a),a&&(e.freq=new Float32Array(a),e.freq.forEach(function(a,b){e.freq[b]=dtm.value.mtof(a)*e.tabLen/e.sr}))),d},d.lpf=function(a,b){var e=g.fx.length;return g.fx[e]=new h.LPF,a=c(a),a&&(g.fx[e].freq=new Float32Array(a)),b=c(b),b&&(g.fx[e].q=new Float32Array(b)),d},d.delay=function(a,b,e){var f=g.fx.length;return g.fx[f]=new h.Delay,a=c(a),a&&(g.fx[f].mix=new Float32Array(a)),b=c(b),b&&(g.fx[f].time=new Float32Array(b)),e=c(e),e&&(g.fx[f].feedback=new Float32Array(e)),d},d.am=function(a){return a=c(a),d},d.fm=function(a){return a=c(a),a&&(a=dtm.transform.fit(a,Math.round(e.tabLen/10),"linear"),e.freq=dtm.transform.fit(e.freq,Math.round(e.tabLen/10),"step"),e.freq.forEach(function(b,c){e.freq[c]=b+a[c]})),d},d.waveshape=function(){return d},d.bq=function(a){var b=g.fx.length;return g.fx[b]=new h.BitQuantizer,a=c(a),a&&(g.fx[b].bit=new Float32Array(a)),d},d.sh=function(){return d},d.get=function(a){switch(a){case"fx":return g.fx;default:return d}},d},dtm.synth3=function(a,b){var c={type:"sine",note:{delay:0,duration:1},output:{gain:.5,pan:0},isPlaying:!1,buffer:null,mono:!1,amp:{gain:.5,adsr:[.001,.2,0,.001],curve:null,dur:null,loop:!1},pitch:{freq:440,noteNum:69},wt:{isOn:!1,wt:null},lpf:{isOn:!1,cof:4e3,res:1},detune:{isOn:!1,amount:0,spread:0},delay:{isOn:!1,amount:0,time:.3,sync:!1,note:6,feedback:.3,stereo:!1},verb:{isOn:!1,amount:0},comb:{isOn:!1,amount:0,nn:69}},d={src:null,amp:null,out:null},e=null;dtm.wa.isOn&&(e=dtm.wa.makeNoise(8192));var f={type:"dtm.synth"},g=null;return f.get=function(a){switch(a){case"params":return null;case"amp":return c.amp.gain;case"volume":case"gain":return c.output.gain;case"pan":return c.output.pan;case"frequency":case"freq":case"cps":return c.pitch.freq;case"noteNum":case"notenum":case"note":case"nn":return c.pitch.noteNum;case"buffer":return c.buffer;default:return null}},f.set=function(a){if("string"==typeof a&&(a.indexOf(".wav")>-1||a.indexOf(".mp3")>-1))return f.load(a),f;switch(a){case"sin":case"sine":c.type="sine";break;case"saw":case"sawtooth":c.type="saw";break;case"sq":case"square":c.type="square";break;case"tri":case"triangle":c.type="triangle";break;case"wn":case"noise":case"rand":case"random":c.type="noise";break;case"click":case"impulse":c.type="click";break;case"wt":case"wavetable":c.type="wavetable",f.wt(arguments[1]);break;case"sampler":c.type="sampler"}return f},f.init=function(){return d.out=dtm.wa.actx.createGain(),d.out.gain.setValueAtTime(.5,0),d.out.connect(dtm.wa.actx.destination),f},f.wt=function(a){c.wt.isOn=!0,"undefined"==typeof a&&(a=[0]);for(var b=[0,1],d=0;d<a.length;d++)b.push(a[d]);var e=new Float32Array(b);return c.wt.wt=dtm.wa.actx.createPeriodicWave(e,e),f},f.adsr=function(){return"undefeined"!=typeof arguments&&(c.amp.adsr[0]=arguments[0]||.001,c.amp.adsr[1]=arguments[1]||.001,c.amp.adsr[2]=arguments[2],c.amp.adsr[3]=arguments[3]||.001),f},f.load=function(a,b){var d=dtm.wa.actx;return c.type="sampler","AudioBuffer"===a.constructor.name?(c.buffer=a,f):(g=new Promise(function(e){if("string"==typeof a){var g=new XMLHttpRequest;g.open("GET",a,!0),g.responseType="arraybuffer",g.onreadystatechange=function(){4==g.readyState&&200==g.status&&d.decodeAudioData(g.response,function(a){c.buffer=a,e(f),"undefined"!=typeof b&&b(a)})},g.send()}else if("ArrayBuffer"===a.constructor.name)d.decodeAudioData(a,function(a){c.buffer=a,e(f),"undefined"!=typeof b&&b(f)});else if(a.constructor===Array){var h=d.createBuffer(1,a.length,dtm.wa.actx.sampleRate),i=h.getChannelData(0);_.forEach(i,function(b,c){i[c]=a[c]}),c.buffer=h,e(f),"undefined"!=typeof b&&b(f)}}),f)},f.play=function(a,b){function h(a,b){{var f=dtm.wa.actx,g=dtm.wa.now;dtm.wa.out}"number"!=typeof a&&(a=0),"number"!=typeof b&&(b=c.note.duration);var h=g()+a+1e-4;if("noise"===c.type)d.src=f.createBufferSource(),e||(e=dtm.wa.makeNoise(8192)),d.src.buffer=e,d.src.loop=!0;else if("sampler"===c.type)d.src=f.createBufferSource(),d.src.buffer=c.buffer,d.src.playbackRate=1,d.src.loop=!1;else if("click"===c.type){d.src=f.createBufferSource();var i=f.createBuffer(1,2,dtm.sr),j=i.getChannelData(0);j[1]=1,d.src.buffer=i,d.src.playbackRate=1,d.src.loop=!1}else{switch(d.src=f.createOscillator(),d.src.frequency.setValueAtTime(c.pitch.freq,h),c.type){case"sine":d.src.type="sine";break;case"saw":d.src.type="sawtooth";break;case"square":d.src.type="square";break;case"triange":d.src.type="triangle"}c.wt.isOn&&d.src.setPeriodicWave(c.wt.wt)}d.amp=f.createGain();var k=c.amp.adsr[0];c.amp.adsr[0]<.01?d.amp.gain.value=c.amp.gain:(d.amp.gain.value=0,d.amp.gain.setTargetAtTime(c.amp.gain,h,k));var l=c.amp.adsr[1],m=c.amp.adsr[2]*c.amp.gain;d.amp.gain.setTargetAtTime(m,h+k,l);var n=b>k+l?h+b:h+k+l,o=c.amp.adsr[3];if(c.lpf.isOn){var p=f.createBiquadFilter();p.type="lowpass",p.frequency.setValueAtTime(c.lpf.cof,h),p.Q.setValueAtTime(c.lpf.res,h),d.src.connect(p),p.connect(d.amp)}else d.src.connect(d.amp);if(c.comb.isOn){var q=f.createDelay();q.delayTime.setValueAtTime(1/dtm.val.mtof(c.comb.nn),h);var r=f.createGain();r.gain.setValueAtTime(c.comb.amount,h);var s=f.createGain();s.gain.setValueAtTime(.95,h),d.amp.connect(q),q.connect(r),q.connect(s),s.connect(q),r.connect(d.out)}if(c.delay.isOn){var t=f.createDelay();t.delayTime.setValueAtTime(c.delay.time,h);var u=f.createGain();u.gain.setValueAtTime(c.delay.amount,h);var v=f.createGain();v.gain.setValueAtTime(c.delay.feedback,h),d.amp.connect(t),t.connect(u),t.connect(v),v.connect(t),u.connect(d.out)}if(c.verb.isOn){var w=f.createConvolver();w.buffer=dtm.wa.buffs.verbIr;var x=f.createGain();x.gain.setValueAtTime(c.verb.amount,h),d.amp.connect(w),w.connect(x),x.connect(d.out)}var y=f.createStereoPanner();if(y.pan.setValueAtTime(c.output.pan,0),d.amp.connect(y),y.connect(d.out),d.src.start(h),null!==c.amp.curve){d.amp.gain.cancelScheduledValues(h);var z=c.amp.dur||c.note.duration;if(c.amp.loop){var A=c.note.duration;b>0&&(A=b),console.log(A,z,c.amp.dur);for(var B=0;B<Math.ceil(A/z);B++)d.amp.gain.setValueCurveAtTime(c.amp.curve,h+z*B,z)}else d.amp.gain.setValueCurveAtTime(c.amp.curve,h,z)}b>=0&&(d.src.stop(n+c.amp.adsr[3]+.3),d.amp.gain.setTargetAtTime(0,n,o))}return null===d.out&&f.init(),g?g.then(function(){h(a,b)}):h(a,b),f},f.stop=function(a){"number"!=typeof a&&(a=0);var b=dtm.wa.now(),e=c.amp.adsr[3];return d.amp.gain.cancelScheduledValues(b+a),d.amp.gain.setTargetAtTime(0,b+a,e),d.src.stop(b+a+e),f},f.nn=function(a){return"number"!=typeof a?f:(a=0>a?0:a,a=a>127?127:a,c.pitch.noteNum=a,c.pitch.freq=dtm.value.mtof(a),f)},f.freq=function(a){return typeof a!==a?f:(a=1>a?1:a,a=a>dtm.wa.actx.sampleRate?dtm.wa.actx.sampleRate:a,c.pitch.freq=a,f)},f.amp=function(a){if("number"==typeof a)c.amp.gain=a;else if(a.constructor===Array){c.amp.dur=c.note.duration,"number"==typeof arguments[1]&&(c.amp.dur=arguments[1]);c.amp.curve=new Float32Array(a),"boolean"==typeof arguments[2]&&(c.amp.loop=arguments[2])}return f},f.dur=function(a){return c.note.duration=a,f},f.len=f.length=f.duration=f.dur,f.attr=function(a){var b=_.keys(a);return _.forEach(b,function(b){"undefined"!=typeof f[b]&&(f[b]=a[b])}),f},f.attack=function(a){return c.amp.adsr[0]=a,f},f.atk=f.attack,f.decay=function(a){return c.amp.adsr[1]=a,f},f.dcy=f.decay,f.sustain=function(a){return c.amp.adsr[2]=a,f},f.sus=f.sustain,f.release=function(a){return c.amp.adsr[3]=a,f},f.rel=f.release,f.gain=function(a){return"number"!=typeof a?f:(a=0>a?0:a,c.output.gain=a,f)},f.pan=function(a){return"number"!=typeof a?f:(c.output.pan=-1>a?-1:a,c.output.pan=a>1?1:a,f)},f.lpf=function(a,b){return c.lpf.isOn=!0,c.lpf.cof=a||4e3,c.lpf.res=b||1,f},f.verb=function(a){return c.verb.isOn=!0,c.verb.amount=a,f},f.reverb=f.verb,f.delay=function(a,b,d,e){return c.delay.isOn=!0,c.delay.amount=a||0,c.delay.time=b||.3,c.delay.feedback=d||.3,c.delay.stereo=e||!1,f},f.comb=function(a,b){return c.comb.isOn=!0,c.comb.amount=a||0,c.comb.nn=b||69,f},f.fm=function(){return f},f.mono=function(a){return c.mono=void 0===a?!0:a,f},f.set(a,b),f},dtm.stream=function(){var a={type:"dtm.stream"};return a.query=function(a,b){ajaxGet(a,function(a){b(),console.log(a)})},a.connect=function(){return a},a.disconnect=function(){return a},a},dtm.str=dtm.stream,dtm.master={type:"dtm.master",params:{data:null,index:0,level:.5,mute:!1,tempo:120,time:[4,4],beat:0,measure:0,section:0,scale:[0,1,2,3,4,5,6,7,8,9,10,11],cummulatedRhythm:null,transposition:0,chord:null,tonalFunc:null,maxNumVoices:10,voices:[]},totalComplexity:0,complexityLimit:10,numActiveModels:0,activeInstrs:[],voices:[],maxNumVoices:0,models:[],clock:dtm.clock(120,480).sync(!1),start:function(){return dtm.master},stop:function(){_.forEach(dtm.clocks,function(a){a.stop(),a.clear()}),_.forEach(dtm.master.activeInstrs,function(a){a.stop()}),dtm.clocks=[],dtm.master.voices=[],dtm.master.activeInstrs=[]},transpose:function(a){return dtm.master.transposition=a,dtm.master},pq:function(){var a;return a=0===arguments.length?_.range(12):"array"==typeof arguments[0]?arguments[0]:"string"==typeof arguments[0]?dtm.scales[arguments[0].toLowerCase()]:arguments,dtm.master.scale=a,dtm.master},data:function(a){return"undefined"!=typeof a&&(dtm.master.params.data=a),dtm.master},form:function(){},model:function(){return dtm.master},get:function(a){switch(a){case"index":return dtm.master.params.index;case"clock":return dtm.master.clock;default:return null}},set:function(){return dtm.master},setNumVoices:function(a){return typeof a===number&&a>0&&(dtm.master.params.maxNumVoices=a),dtm.master},suppressVoices:function(){return dtm.master.params.voices.length>dtm.master.params.maxNumVoices&&(dtm.master.params.voices[0].stop(),dtm.master.params.voices.splice(0,1),dtm.master.suppressVoices()),dtm.master},addVoice:function(a){return dtm.master.params.voices.push(a),dtm.master.suppressVoices(),dtm.master},removeVoice:function(a){return dtm.master.params.voices.forEach(function(b,c){b.get("id")===a.get("id")&&dtm.master.params.voices.splice(c,1)}),dtm.master},panic:function(){return dtm.master.params.voices.forEach(function(a){a.stop()}),dtm.master.params.voices=[],dtm.master},state:null,reset:null},dtm.master.clock.setMaster(!0),dtm.master.clock.start(),dtm.guido={pitchClass:{"-1":"_",r:"_",0:"c",1:"d&",2:"d",3:"e&",4:"e",5:"f",6:"f#",7:"g",8:"a&",9:"a",10:"b&",11:"b"},diatonic:{c:0,d:2,e:4,f:5,g:7,a:9,b:11,_:null},nnToPitch:function(a){var b=dtm.guido.pitchClass[dtm.val.mod(a,12)],c=(a-dtm.val.mod(a,12))/12-4;return b+c.toString()},pitchToNn:function(a){var b=a.split(""),c=0,d=0,e=dtm.guido.diatonic[b[0]];return 2===b.length?d=12*(parseInt(b[1])+4):b.length>2&&("#"==b[1]?c=1:"&"==b[1]&&(c=-1),3===b.length?d="-"==b[1]?12*(parseInt(b[1]+b[2])+4):12*(parseInt(b[2])+4):4===b.length&&(d=12*(parseInt(b[2]+b[3])+4))),e+c+d}},dtm.inscore=function(){var a={type:"dtm.inscore",oscPort:{}};return a.setup=function(){return a.oscPort=new osc.WebSocketPort({url:"ws://localhost:8081"}),a.oscPort.open(),a},a.test=function(b){for(var c=[],d=[],e=0;e<b.length;e++){if(0===dtm.value.mod(e,2)){var f,g;f=b[e]}else switch(g=b[e],d=[f,g].join(", ")){case"1, 0":c.push("a/4");break;case"1, 1":c.push("a/8"),c.push("a/8");break;case"0, 0":c.push("_/4");break;case"0, 1":c.push("_/8"),c.push("a/8")}}return c=c.join(" "),a.oscPort.send({address:"/ITL/scene/score",args:["write",c]}),a},a.write=function(b){return a.oscPort.send({address:"/ITL/scene/score",args:["write",b]}),a},a},function(){var a,b,c=dtm.model("unipolar").register(),d=dtm.array();return c["default"](function(){if(1===arguments.length){var c=arguments[0];isNumber(c)?d.set(c):"string"==typeof c?d.set(c).split().histo():isArray(c)?isNumArray(c)?d.set(c):d.set(c).split().histo():isDtmObj(c)&&(d.set(c),"number"!==d.get("type")&&d.histo())}else if(arguments.length>1){var e=argsToArray(arguments);isNumArray(e)?d.set(e):isStringArray(e)&&d.set(e).split().histo()}return d.normalize(a,b)}),c.domain=function(){if(argsAreSingleVals(arguments)&&2==arguments.length){var c=argsToArray(arguments);isNumArray(c)&&(a=c[0],b=c[1])}else argIsSingleArray(arguments)&&isNumArray(arguments[0])&&2==arguments[0].length&&(a=arguments[0][0],b=arguments[0][1])},c}(),function(){var a,b,c=dtm.model("bipolar").register(),d=dtm.array();return c["default"](function(){if(1===arguments.length){var c=arguments[0];isNumber(c)?d.set(c):"string"==typeof c?d.set(c).split().histo():"object"==typeof c&&(isArray(c)?isNumArray(c)?d.set(c):d.set(c).split().histo():isDtmObj(c)&&(d.set(c),"number"!==d.get("type")&&d.histo()))}else if(arguments.length>1){var e=argsToArray(arguments);isNumArray(e)?d.set(e):isStringArray(e)&&d.set(e).split().histo()}return d.normalize(a,b).range(-1,1)}),c.domain=function(){if(argsAreSingleVals(arguments)&&2==arguments.length){var c=argsToArray(arguments);isNumArray(c)&&(a=c[0],b=c[1])}else argIsSingleArray(arguments)&&isNumArray(arguments[0])&&2==arguments[0].length&&(a=arguments[0][0],b=arguments[0][1])},c}(),function(){var a=dtm.model("huffman").register();return a.build=function(){return console.log("meow"),a},a}()}();